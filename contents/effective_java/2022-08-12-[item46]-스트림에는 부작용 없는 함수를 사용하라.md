---
date: '2022-08-12'
title: '[item46] 스트림에는 부작용 없는 함수를 사용하라'
categories: ['effective_java']
summary: '스트림을 이해하려면 순수 함수를 이해해야 합니다. 순수 함수란 부수 효과(side-effect)가 없어서 어떤 인자를 주었을 때 항상 같은 값을 반환하는 함수를 의미합니다.'
thumbnail: './effective_java_thumb.png'
---

> **스트림에는 부작용 없는 함수를 사용하라**

스트림을 이해하려면 순수 함수를 이해해야 합니다. 순수 함수란 부수 효과(side-effect)가 없어서 어떤 인자를 주었을 때 항상 같은 값을 반환하는 함수를 의미합니다. 쉽게 **수학에서의 f(x) 함수라고 생각하시면 됩니다.** 수학에서 f(x) 함수에 x값 외에 외부의 어떤 값에도 영향을 받지 않듯이, 순수 함수 역시 외부의 어떤 값에 영향을 받지 않습니다.

이번 장에서 말하는 "**스트림에는 부작용 없는 함수를 사용하라**"에서 부작용이 의미하는 것이 바로 side-effect 입니다.

## side effect
사실 스트림은 변할 수 있는 외부 변수를 내부적으로 사용할 수 없게 되어 있습니다. 아래 코드는 변할 수 있는 외부 변수 `variable`을 사용하고 있는 모습입니다. 실제로 해당 코드를 IDE에 올려보면 컴파일 에러를 일으킵니다.
```java
int variable = 1;
Arrays.stream(new int[]{1, 2, 3, 4})
    .map(i -> i + variable++) // 컴파일 에러!
    .toArray();
```
하지만 람다를 속여서 외부 변수를 사용할 수도 있습니다. 아래와 같이 사용한다면 외부 변수를 람다 내부적으로 외부 변수를 수정하고 있지만 아무런 컴파일 에러도 나지 않습니다. 

```java
static int variable = 1;

public static void main(String[] args) {
  Arrays.stream(new int[]{1, 2, 3, 4})
      .map(i -> print(i))
      .toArray();
}

private static int print(int i) {
  return i + variable++; // 컴파일 에러가 나지 않음!
}
```

위 코드는 스트림으로서 기능을 충분히 활용하고 있고, 결과도 올바르지만 절대 스트림 코드라고 할 수 없습니다. 이는 스트림 코드를 가장한 **반복적 코드**입니다. 스트림은 파이프라인을 통해서만 연산을 수행해야지, 외부 상태를 수정하는 일까지 한다면 유지보수가 급격하게 어려워집니다. 따라서 모든 스트림 함수는 부작용(side-effect)이 없게끔 프로그래밍 해야합니다.