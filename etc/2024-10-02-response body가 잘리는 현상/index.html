<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.9"/><meta data-react-helmet="true" name="description" content="spring boot를 2에서 3으로 올리던 평화로운 어느 날이었습니다."/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1.0"/><meta data-react-helmet="true" http-equiv="Content-Type" content="text/html;charset=UTF-8"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="response body가 잘리는 현상 (feat. brotli)"/><meta data-react-helmet="true" property="og:description" content="spring boot를 2에서 3으로 올리던 평화로운 어느 날이었습니다."/><meta data-react-helmet="true" property="og:image" content="/static/8315cb308b890c7087edfc088043f572/spring-boot-logo.png"/><meta data-react-helmet="true" property="og:url"/><meta data-react-helmet="true" property="og:site_name" content="response body가 잘리는 현상 (feat. brotli)"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="response body가 잘리는 현상 (feat. brotli)"/><meta data-react-helmet="true" name="twitter:description" content="spring boot를 2에서 3으로 올리던 평화로운 어느 날이었습니다."/><meta data-react-helmet="true" name="twitter:image" content="/static/8315cb308b890c7087edfc088043f572/spring-boot-logo.png"/><meta data-react-helmet="true" name="twitter:site" content="@사용자이름"/><meta data-react-helmet="true" name="twitter:creator" content="@사용자이름"/><title data-react-helmet="true">response body가 잘리는 현상 (feat. brotli)</title><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="canonical" href="https://gusah009.github.io/etc/2024-10-02-response%20body가%20잘리는%20현상/" data-baseprotocol="https:" data-basehost="gusah009.github.io"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><main class="flex flex-col h-full"><div><div class="hidden z-40 lg:flex lg:w-64 lg:flex-col lg:fixed lg:inset-y-0"><div class="absolute top-0 right-0 -mr-12 pt-2"><button type="button" class="-ml-[90px] flex items-center justify-center h-8 w-8 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white"><span class="sr-only">Close sidebar</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-6 w-6 text-black"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg></button></div><div class="flex flex-col flex-grow bg-white shadow-lg shadow-slate-200 overflow-y-auto"><div class="w-full flex flex-col items-center px-4 mt-14 "><a href="/"><img class="w-20 h-20 mb-3 rounded-md" src="https://avatars.githubusercontent.com/u/26597702?v=4" alt="profile"/></a><div class=" text-slate-900 text-md font-bold mb-5">gusah009</div><div class="flex space-x-6"><a href="https://devblog-gusah009.notion.site/gusah009-1f41013097914875a99b6af4134bce9e" target="_blank"><svg class="fill-slate-900 hover:fill-slate-500 stroke-slate-900 stroke-0" xmlns="http://www.w3.org/2000/svg" focusable="false" width="32" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M4.459 4.208c.746.606 1.026.56 2.428.466l13.215-.793c.28 0 .047-.28-.046-.326L17.86 1.968c-.42-.326-.981-.7-2.055-.607L3.01 2.295c-.466.046-.56.28-.374.466zm.793 3.08v13.904c0 .747.373 1.027 1.214.98l14.523-.84c.841-.046.935-.56.935-1.167V6.354c0-.606-.233-.933-.748-.887l-15.177.887c-.56.047-.747.327-.747.933zm14.337.745c.093.42 0 .84-.42.888l-.7.14v10.264c-.608.327-1.168.514-1.635.514c-.748 0-.935-.234-1.495-.933l-4.577-7.186v6.952L12.21 19s0 .84-1.168.84l-3.222.186c-.093-.186 0-.653.327-.746l.84-.233V9.854L7.822 9.76c-.094-.42.14-1.026.793-1.073l3.456-.233l4.764 7.279v-6.44l-1.215-.139c-.093-.514.28-.887.747-.933zM1.936 1.035l13.31-.98c1.634-.14 2.055-.047 3.082.7l4.249 2.986c.7.513.934.653.934 1.213v16.378c0 1.026-.373 1.634-1.68 1.726l-15.458.934c-.98.047-1.448-.093-1.962-.747l-3.129-4.06c-.56-.747-.793-1.306-.793-1.96V2.667c0-.839.374-1.54 1.447-1.632z"></path></svg></a><a href="https://github.com/gusah009" target="_blank"><svg class="fill-slate-900 hover:fill-slate-500 stroke-slate-900" stroke-width="0" viewBox="0 0 496 512" height="32" width="32" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="mailto:gusah009@naver.com"><svg class="fill-slate-900 hover:fill-slate-500 stroke-slate-900" stroke-width="0" viewBox="0 0 24 24" height="32" width="32" xmlns="http://www.w3.org/2000/svg"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"></path></svg></a></div></div><div class="w-full px-3 pt-8"><button class="flex mt-1 w-full justify-between ui-not-open:rounded-md ui-open:rounded-t-md px-4 py-2 text-left text-sm font-medium text-slate-900 hover:bg-slate-200" id="headlessui-disclosure-button-:R9l9:" type="button" aria-expanded="false" data-headlessui-state=""><span>JAVA</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class=" h-5 w-5 text-slate-500"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg></button><button type="button" aria-hidden="true" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0"></button><div class="ml-4 border-l-2"></div><button class="flex mt-1 w-full justify-between ui-not-open:rounded-md ui-open:rounded-t-md px-4 py-2 text-left text-sm font-medium text-slate-900 hover:bg-slate-200" id="headlessui-disclosure-button-:Ral9:" type="button" aria-expanded="false" data-headlessui-state=""><span>PROJECTS</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class=" h-5 w-5 text-slate-500"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg></button><button type="button" aria-hidden="true" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0"></button><div class="ml-4 border-l-2"></div><button class="flex mt-1 w-full justify-between ui-not-open:rounded-md ui-open:rounded-t-md px-4 py-2 text-left text-sm font-medium text-slate-900 hover:bg-slate-200" id="headlessui-disclosure-button-:Rbl9:" type="button" aria-expanded="false" data-headlessui-state=""><span>CICD</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class=" h-5 w-5 text-slate-500"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg></button><button type="button" aria-hidden="true" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0"></button><div class="ml-4 border-l-2"></div><button class="flex mt-1 w-full justify-between ui-not-open:rounded-md ui-open:rounded-t-md px-4 py-2 text-left text-sm font-medium text-slate-900 hover:bg-slate-200" id="headlessui-disclosure-button-:Rcl9:" type="button" aria-expanded="false" data-headlessui-state=""><span>ETC</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class=" h-5 w-5 text-slate-500"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg></button><button type="button" aria-hidden="true" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0"></button><div class="ml-4 border-l-2"></div><button class="flex mt-1 w-full justify-between ui-not-open:rounded-md ui-open:rounded-t-md px-4 py-2 text-left text-sm font-medium text-slate-900 hover:bg-slate-200" id="headlessui-disclosure-button-:Rdl9:" type="button" aria-expanded="false" data-headlessui-state=""><span>일상</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class=" h-5 w-5 text-slate-500"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg></button><button type="button" aria-hidden="true" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0"></button><div class="ml-4 border-l-2"></div></div></div></div><div class=" lg:pl-64 flex flex-col flex-1"><div class="sticky top-0 z-10 flex-shrink-0 flex h-12 bg-white shadow"><button type="button" class="px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 lg:hidden"><span class="sr-only">Open sidebar</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h7"></path></svg></button><button type="button" class="px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 hidden "><span class="sr-only">Open sidebar</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h7"></path></svg></button><div class="flex-1 flex"><a class="flex items-center" style="margin-left:0%" href="/etc/2024-10-02-response body가 잘리는 현상/"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained w-8 drop-shadow-md"><div style="max-width:109px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;99.99999999999999&#x27; width=&#x27;109&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADyklEQVQ4y12UbUxbZRTHT7l8YXYtFO86p9PV6JClC02gA1O78lKcvPRFHBjDlBUTSOSLEU0wxJjosg/ug0uWKbBk2RhIF5ORkfoCuuk+bdGgodGETLcuEuvoDKyktfS+PH/z3Aul5dyce2+ePOd3zz3nPH8iIqqocBAA6u0dJputUiDdnjOby19ub38jEQiE4PeHVL//uBII9MLj8V8gImdZmWUn37hjh0mwWHZrHMoHOp2NBputki9V+3zHl/v6hnHnToatroIlEsDyMpBKgV269B06OvrhcrV8xuO4lZc/VlRRUaXD7HYn+XzHNuGeUGgwHo0moKrIqqrKAAUAf3KXkc1ClSRIo6NXeLajomgt5bEOh4tyaTqd9YIoPkEWy67Jc+dmAWBdVdchSTKTZQUsZ2CKIkNRMuzhQyg+X4inaOeMvXufETRgdfVhA5FAe/bs8w8MfHQ3Go2DMagAGLYZJ26ss2wWbHLymtLQEJwgorJc/Q4d8gjFxTvJat03Nj4+zQOyYCpSqTSGhj7AyZOnNJCqqhp0bu4aenr6sLCwoCaTQGvrMZ5lZQ5YW+spMhiMJIpPnQqHL/MYmWewsrqC/fur4HY3a0BF0YGnT58FUQmbmYlozTpy5LU1Ino2B6ypcQsGwyNktdo+nZr6UgNm4sDfC0nU1tTDH+gCU7cyHBs7D3HXk7hy4VsWjwGtbd1pInqa8o1naDLt/mRiIqwB7/6cwOL1fxCbTyCx/C8Yv/T6IZVO4favfyE+n2J//C7hpZZX/+NNNhr1MhYTkVlv+/PnZ2a+0oDvDr6Prs7XcXvxz1wzNj2/R7GYzDo730JV1Qv36uqaD1J9ve/DxsbgFBF9fObMCN+kyLLMYveWcOPGTbwzOIRkci2/w5sNYrzZS0tZ3L8PeXExhbq6JlB//zCmp39CW1sQs7PfawG8ViMjUzhx4iwymfUCWOH46Ldo9DdEIl/D5Wq6Sd3db0srK/pc6ftyc7Z99vJ/W7NUSsWtW79IHs+L10tKHv28oaGlmHp63kMmA1mWM1AU/SRwHs+S+3YYf9P+FjJbW4Pc3t7LZ/Ag78GBA9UCNTcfnQ6Hf+AxEmPZja8DuXNW6BsPWds/Pj4Hr/eVy6WlZpGLhN3uNGjq43R6r4bDP/KKrPPjlCcGyHNNHBiTNNjFi3NwOA6HN6aERPHxopx8EVFJU1PH1a6uAUQi80inwbhUPXhQ6HwtnYbMM8uHGY3mLT00mco1QRWEIpGIXF7v0W+4iHIx9fs1Yd10xteCwTfhdrd9sQUrLRDX/wGSgXZ6erYz6gAAAABJRU5ErkJggg==" alt=""/><picture><source type="image/webp" data-srcset="/static/e9127b8e576402d43e65260030c6fa43/6ad34/ghost.webp 27w,/static/e9127b8e576402d43e65260030c6fa43/b13ee/ghost.webp 55w,/static/e9127b8e576402d43e65260030c6fa43/e1ec8/ghost.webp 109w,/static/e9127b8e576402d43e65260030c6fa43/6cadb/ghost.webp 218w" sizes="(min-width: 109px) 109px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 109px) 109px, 100vw" decoding="async" loading="lazy" data-src="/static/e9127b8e576402d43e65260030c6fa43/0d876/ghost.png" data-srcset="/static/e9127b8e576402d43e65260030c6fa43/d824c/ghost.png 27w,/static/e9127b8e576402d43e65260030c6fa43/fa736/ghost.png 55w,/static/e9127b8e576402d43e65260030c6fa43/0d876/ghost.png 109w,/static/e9127b8e576402d43e65260030c6fa43/8971a/ghost.png 218w" alt="Progress Image"/></picture><noscript><picture><source type="image/webp" srcSet="/static/e9127b8e576402d43e65260030c6fa43/6ad34/ghost.webp 27w,/static/e9127b8e576402d43e65260030c6fa43/b13ee/ghost.webp 55w,/static/e9127b8e576402d43e65260030c6fa43/e1ec8/ghost.webp 109w,/static/e9127b8e576402d43e65260030c6fa43/6cadb/ghost.webp 218w" sizes="(min-width: 109px) 109px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 109px) 109px, 100vw" decoding="async" loading="lazy" src="/static/e9127b8e576402d43e65260030c6fa43/0d876/ghost.png" srcSet="/static/e9127b8e576402d43e65260030c6fa43/d824c/ghost.png 27w,/static/e9127b8e576402d43e65260030c6fa43/fa736/ghost.png 55w,/static/e9127b8e576402d43e65260030c6fa43/0d876/ghost.png 109w,/static/e9127b8e576402d43e65260030c6fa43/8971a/ghost.png 218w" alt="Progress Image"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a></div><a class="h-full flex items-end" href="/"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained w-9 -ml-4 mr-2 drop-shadow-md"><div style="max-width:150px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;171&#x27; width=&#x27;150&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEdklEQVQ4y82US1BbVRjHT8CN7aIL3flc2XFGN7qo2k2nrbTjECDlkcmDgFAShLaUgOWVS3mFQBKEQiAEGyAJhLxDIIYkEGibhmchCYhjbbEu2y50dLQLcrmfcw5QdXRauvPO/Oc7c+fO7/7POd//QwghlJ4uRBcu1iCxpAKJRKWIz5egN15/95hYLB2iKOUftXWKh7V1ikcyqv33vLwLXa++8vb7XO558m1BYRmSFFeiU6fSEXnOnctDEkklys4uYGVm5qPc3JIPeDzxULdm+Mm4JwTzixsQjsSI5hfXweEKgLpD93MOt7A3N7fkHR5PjHg8MSsr63OUkZG7Czx7NpvAAQCVlcmWJrxzEJpb2rHZv6E1vYOMVmdktP1GRtM3xDjdATo0twxOVxCKi7/0G4xutPXgMevo0Q//AkorribhP3A4Iv51vXV7OrSwoxsY2Zn0zsGdtbvM4vIms7TyHYPXLncQvtab6QlvCOStXU9Onsw489GxTxGXW8jCR0eAVL0yuVxaj4TCLywzoSXQD44lgjPzEFvfYsKRGOMa98O4J4C3z8Q3fmQmvLPQ3TOwrRswApst6ExLEyI+X5z81KGMak8qK5MhgbB40B+IgMHooH3+W8xa7D7cno+DecwFFus4LC5vwlrsHrg900yfdjDRpx0GNpsvZ7P5iPcv4GUCHPYHI2AwORKeyRDj9c2Cyz1FYBarB7BT39QNcLr8BKjtJ0AFmy14NtBocibcniBYbR4YGXUQ4JjFDaYRO9gdk2B3ToG2fyih1R4QaDA6El7fDQjfXoPgTIQAMXxmdgHCkSg43QHo7dMf1OE8DBvtialAGKLxLYgsxAnQZp8gZxjfeACmURe0yFUJ3YAJUlN5BwP6/LdgNfoDcUQc2icgsrAO0fUtMJic0NTclhh4MWAYVqP3SEL2HeLUxNa3wDiCge0v6vD/CBT+JzBKWgbf8vOAHI4IIZxhqfRqckVFw9O2GTbsXsqdtbsEMndzhQivo/H7e5eCgUZITeW34aRwued3gSkpmSw8ZfDoEolKB3GWTaOu/SwTKI4b1srq97Cx+ROMmt2kba7rRyEtTdBy4kQanlSslJQsFvrk4zN4ch1GCL2cni40W20+6O7R02bLJARnFgBvfV8453M3V6FPa4Dqmgb6q85+OH2a041Q0pFDh147fPz4Zwi99eZ7R6pr5MGGxo6HMqr9V3lrNzQ1dzIt8mugaNNAq6KHCL+vkylAJlNAVVUTVFbWM1eqGqHsct1vUin1S0nJFQdC6CU8AxdlVDt0XdODumMAVGodo+7Q4Qoqdf+edKBUaYGi2ggQV6q+DShKweDa0KiEi5dqgMMRuVFNbSvt9kwnxiyTCYvVS1ts3h2LjVTaulf31zaHj3a4ArTR5KKVqh5apdbsqNQaWqnSbHd29YNEIn2EqqqbwOX2kT4jk+QZwt84nF4YHDJDbV0zyCj5P5SfX/oYCQSSZbG4PF5UVB4tKiqPPU9icXmsoOBSTCCQ/F1RgUDybU5OQfBPrUkpZaI09W4AAAAASUVORK5CYII=" alt=""/><picture><source type="image/webp" data-srcset="/static/26dc7b21275899ad3a53ee1240a0494e/8c86a/grave.webp 38w,/static/26dc7b21275899ad3a53ee1240a0494e/21236/grave.webp 75w,/static/26dc7b21275899ad3a53ee1240a0494e/2b3c0/grave.webp 150w,/static/26dc7b21275899ad3a53ee1240a0494e/0edb4/grave.webp 300w" sizes="(min-width: 150px) 150px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 150px) 150px, 100vw" decoding="async" loading="lazy" data-src="/static/26dc7b21275899ad3a53ee1240a0494e/faeed/grave.png" data-srcset="/static/26dc7b21275899ad3a53ee1240a0494e/4a48e/grave.png 38w,/static/26dc7b21275899ad3a53ee1240a0494e/000a1/grave.png 75w,/static/26dc7b21275899ad3a53ee1240a0494e/faeed/grave.png 150w,/static/26dc7b21275899ad3a53ee1240a0494e/7abe6/grave.png 300w" alt="Progress Image"/></picture><noscript><picture><source type="image/webp" srcSet="/static/26dc7b21275899ad3a53ee1240a0494e/8c86a/grave.webp 38w,/static/26dc7b21275899ad3a53ee1240a0494e/21236/grave.webp 75w,/static/26dc7b21275899ad3a53ee1240a0494e/2b3c0/grave.webp 150w,/static/26dc7b21275899ad3a53ee1240a0494e/0edb4/grave.webp 300w" sizes="(min-width: 150px) 150px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 150px) 150px, 100vw" decoding="async" loading="lazy" src="/static/26dc7b21275899ad3a53ee1240a0494e/faeed/grave.png" srcSet="/static/26dc7b21275899ad3a53ee1240a0494e/4a48e/grave.png 38w,/static/26dc7b21275899ad3a53ee1240a0494e/000a1/grave.png 75w,/static/26dc7b21275899ad3a53ee1240a0494e/faeed/grave.png 150w,/static/26dc7b21275899ad3a53ee1240a0494e/7abe6/grave.png 300w" alt="Progress Image"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a></div><main><div class="w-full h-72 md:h-96"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained !absolute -z-10 w-full h-72 md:h-96 object-cover brightness-50 bg-white"><div style="max-width:600px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;315&#x27; width=&#x27;600&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3ElEQVQoz12Ty6tPURTHzzkh8kh5R3mUgZT4B74rjwEjIzOKpJTvGihykeIyIHldj0xMLroDlL7rlpSUmYlHBsaiDEhSxIz2/q0fJ7tWZ5211/nstb5rn8bDGpe1FBrK0qrfMpD+P/PI3MB0D5uSsb/7NcEHkNmUzadsAYUZBewD4JzBXolhYX48jQIoLKUwN2NTKSwakrdQ+ErhI2WfKbynsMwDqyjcorCbwmUKxymMUhincITCdQpjFI5ROErhfDPyeGsBvqXwgcIEhfsUvlN4QKFUe4nCbQonKWyg8I6BXR52gMJzCisoPKNwhsLaJumfKJymcI7CtfR/UdhPYS+FCwzcozBCYSeF9RSMwkEPW0xhB4WbFN4U4CsKryncoPCFwjcKJyj8KK3VoUXVbGUOo9ogbg2HT2FTOaxJ+m8Kh7PlK6nXz1Kdh52lsISB1Yw6iHkMbGZgIwOnEtz2p1ycJx5WoJNVj6gHlLbXedgjCncZGGfgKgN3GLjIwAQDY3lDCrArNpzyGgpPKXtB2UsKDynM9LDlVYrAHg/bR+GQh20vlTGwrXTlslnD9uuqF1iWmvS0yQvr6r2Xano5/+/XNSjZWg/rfBJttbCuB2xTozb/qC5hXR/KrPAPFINmy3qE2ZIAAAAASUVORK5CYII=" alt=""/><picture><source type="image/webp" data-srcset="/static/8315cb308b890c7087edfc088043f572/50262/spring-boot-logo.webp 150w,/static/8315cb308b890c7087edfc088043f572/2fedb/spring-boot-logo.webp 300w,/static/8315cb308b890c7087edfc088043f572/4fcbd/spring-boot-logo.webp 600w" sizes="(min-width: 600px) 600px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 600px) 600px, 100vw" decoding="async" loading="lazy" data-src="/static/8315cb308b890c7087edfc088043f572/22925/spring-boot-logo.png" data-srcset="/static/8315cb308b890c7087edfc088043f572/97024/spring-boot-logo.png 150w,/static/8315cb308b890c7087edfc088043f572/387ef/spring-boot-logo.png 300w,/static/8315cb308b890c7087edfc088043f572/22925/spring-boot-logo.png 600w" alt="thumbnail"/></picture><noscript><picture><source type="image/webp" srcSet="/static/8315cb308b890c7087edfc088043f572/50262/spring-boot-logo.webp 150w,/static/8315cb308b890c7087edfc088043f572/2fedb/spring-boot-logo.webp 300w,/static/8315cb308b890c7087edfc088043f572/4fcbd/spring-boot-logo.webp 600w" sizes="(min-width: 600px) 600px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 600px) 600px, 100vw" decoding="async" loading="lazy" src="/static/8315cb308b890c7087edfc088043f572/22925/spring-boot-logo.png" srcSet="/static/8315cb308b890c7087edfc088043f572/97024/spring-boot-logo.png 150w,/static/8315cb308b890c7087edfc088043f572/387ef/spring-boot-logo.png 300w,/static/8315cb308b890c7087edfc088043f572/22925/spring-boot-logo.png 600w" alt="thumbnail"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><div class="flex flex-col w-full md:w-[725px] lg:w-[840px] h-full my-0 mx-auto py-10 px-5 md:py-14 md:px-0 text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class=" grid place-items-center w-7 h-7 md:w-10 md:h-10 text-white cursor-pointer"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z" clip-rule="evenodd"></path></svg><div class=" overflow-hidden break-words mt-auto text-ellipsis whitespace-normal line-clamp-2 text-2xl md:text-5xl font-bold">response body가 잘리는 현상 (feat. brotli)</div><div class="flex justify-between items-start md:items-center mt-4 text-base md:text-lg font-normal md:font-semibold"><div>etc</div><div>2024.10.02.</div></div></div></div><style data-emotion="css q7fpjh">.css-q7fpjh{line-height:1.8;font-size:16px;font-weight:400;}.css-q7fpjh p{padding:3px 0;margin-top:0;margin-bottom:10px;}.css-q7fpjh p,.css-q7fpjh blockquote,.css-q7fpjh ul,.css-q7fpjh ol,.css-q7fpjh dl,.css-q7fpjh table,.css-q7fpjh pre,.css-q7fpjh details{margin-top:0;margin-bottom:8px;}.css-q7fpjh h1,.css-q7fpjh h2,.css-q7fpjh h3{font-weight:800;margin-bottom:5px;}.css-q7fpjh *+h1,.css-q7fpjh *+h2,.css-q7fpjh *+h3{margin-top:25px;}.css-q7fpjh hr+h1,.css-q7fpjh hr+h2,.css-q7fpjh hr+h3,.css-q7fpjh h2+h3{margin-top:0;}.css-q7fpjh h1{font-size:30px;border-bottom:1px solid #d9dee3;}.css-q7fpjh h2{font-size:25px;border-bottom:1px solid #d9dee3;}.css-q7fpjh h3{font-size:20px;}.css-q7fpjh blockquote{margin:15px 0;padding:2px 14px;border-left:4px solid #bdbdbd;font-style:italic;color:#6e6e6e;}.css-q7fpjh blockquote>:last-child{margin-bottom:0;}.css-q7fpjh ol{margin-left:24px;padding:8px 0;list-style-type:decimal;}.css-q7fpjh ul{margin-left:20px;padding:8px 0;list-style-type:disc;}.css-q7fpjh table{display:block;width:100%;overflow:auto;padding:8px 0;}.css-q7fpjh table th{font-weight:600;background-color:#778899;}.css-q7fpjh table td,.css-q7fpjh table th{padding:6px 13px;border:1px solid #dfe2e5;}.css-q7fpjh table tr{background-color:#fff;border-top:1px solid #c6cbd1;}.css-q7fpjh table tr:nth-child(2n){background-color:#f6f8fa;}.css-q7fpjh hr{border:1px solid #000000;margin:100px 0;}.css-q7fpjh a{color:#4263eb;-webkit-text-decoration:underline;text-decoration:underline;}.css-q7fpjh .language-text{padding:2px 4px;margin:0px 2px;background:#e9e9e9;color:#f00;font-size:14px;border-radius:0.25rem;}</style><div class="flex flex-col w-auto md:w-[725px] lg:w-[840px] mx-3 sm:mx-auto my-0 py-14 px-5 md:py-16 md:px-0 break-all css-q7fpjh e1ijh0y10"><p>spring boot를 2에서 3으로 올리던 평화로운 어느 날이었습니다.
테스트를 진행하던 중에 http response의 body가 잘려서 내려오는 현상을 발견했습니다.
응답 결과가 실패가 아니라 성공인데도 response body만 잘리는 현상이 신기해서 조사했던 내용을 공유하고자 합니다.</p>
<h2>Content Encoding (gzip → brotli)</h2>
<p>디버깅을 해봤더니 response의 content encoding 헤더가 우리에게 친숙한 <code class="language-text">gzip</code>이 아니라 <code class="language-text">br</code>이라는 인코딩 방식으로 내려오는걸 확인할 수 있었습니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f57ed3433d40d603bf9f6df89e201ce1/26cba/image0.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 22.916666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA00lEQVQY02WPzU7DMBCE8y5NnDTE3vXa6Y+dkFYIiR44gODGgfd/iUFd6qiCw6eZWe2PtnrOE5IESIgId+z3B6SUkfOknogVa92KcwTnfrXk6rgseIojThLAxPBelBgjmD1Ih0i9SFgXX7P3XlX7brXKesEpZYzWYRjs7Sppw3bbo+8fVi3+Pv+l6qzDeX7EzhH6wcIYA2PalaYxirliOrRtp/W6brDZ1P+oFmF8nWd8R8HnLuBFGJfAuESP18OIt+mI9znhY06YmGCJ9YOytBws/AA4Kps6vFwshwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/f57ed3433d40d603bf9f6df89e201ce1/a59e9/image0.webp 192w,
/static/f57ed3433d40d603bf9f6df89e201ce1/0ca9f/image0.webp 384w,
/static/f57ed3433d40d603bf9f6df89e201ce1/dc9b9/image0.webp 768w,
/static/f57ed3433d40d603bf9f6df89e201ce1/e2c2f/image0.webp 1152w,
/static/f57ed3433d40d603bf9f6df89e201ce1/f3efb/image0.webp 1536w,
/static/f57ed3433d40d603bf9f6df89e201ce1/b844b/image0.webp 1782w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/f57ed3433d40d603bf9f6df89e201ce1/3b721/image0.png 192w,
/static/f57ed3433d40d603bf9f6df89e201ce1/66595/image0.png 384w,
/static/f57ed3433d40d603bf9f6df89e201ce1/fe486/image0.png 768w,
/static/f57ed3433d40d603bf9f6df89e201ce1/d2d74/image0.png 1152w,
/static/f57ed3433d40d603bf9f6df89e201ce1/e8464/image0.png 1536w,
/static/f57ed3433d40d603bf9f6df89e201ce1/26cba/image0.png 1782w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/f57ed3433d40d603bf9f6df89e201ce1/fe486/image0.png"
            alt="image.png"
            title="image.png"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>그래서 request를 확인해봤더니, 기본 Accept-Encoding으로 <code class="language-text">gzip</code>, <code class="language-text">x-gzip</code>, <code class="language-text">deflate</code>, <code class="language-text">br</code> 총 4가지 인코딩 옵션이 요청헤더에 담겨져 있었습니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/893bfff17b50862767ac274755513769/26e62/image.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 23.4375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA2UlEQVQY001QW27DMAzLUbqua/N2KPmROFmXFe39j8TCLhLkg6AoCASpYo2RK4QYwGEAAaGIUCAMPrDvDcuy2lFVdebbrdz1cVe4rqMzA0UtIZohYinqOM8Lpynyfv/Lc8Ky/GaOcc77xM55qlp2Xc8CAk4xcoTQAhwVDAo69HTySWyMyZwatG23NwHAum54On3xfP7m5fLDAuPE5+vF/1TZGHoBvQonp7QCNk2bX2CtyyZbms3U+8AQxpwuG7aiXB8PPiGMohygvF7LjOOfUpKNt/mo020yfAMRqZxmJzsjzAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/893bfff17b50862767ac274755513769/a59e9/image.webp 192w,
/static/893bfff17b50862767ac274755513769/0ca9f/image.webp 384w,
/static/893bfff17b50862767ac274755513769/dc9b9/image.webp 768w,
/static/893bfff17b50862767ac274755513769/2f8f5/image.webp 1150w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/893bfff17b50862767ac274755513769/3b721/image.png 192w,
/static/893bfff17b50862767ac274755513769/66595/image.png 384w,
/static/893bfff17b50862767ac274755513769/fe486/image.png 768w,
/static/893bfff17b50862767ac274755513769/26e62/image.png 1150w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/893bfff17b50862767ac274755513769/fe486/image.png"
            alt="image.png"
            title="image.png"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>원인은 모르지만 <code class="language-text">gzip이</code> 아니라 <code class="language-text">brotli</code> 방식의 인코딩 방식을 사용하면서 문제가 생긴 것을 확인할 수 있었습니다.</p>
<blockquote>
<p>버전업 전 request header의 Accept-Encoding은 gzip과 deflate만 존재했습니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1af983805c5736cdbdbbe654c6a132fa/26530/image1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 33.854166666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABF0lEQVQoz2WSWW6EMBBEuQuQYRm8s9lskUbKT+5/nYqqGdBI+SiVW8bP1W4yPU1Y9h270vj2AVEbqE5BawNjjLi1DkppGGMxzxHTNGMcJ6zrinEcEWMSzfOMrKpqxNcLP8eB337AYp0AKOc8+n6A9wHDMCCEHl2n8HhU4Lm6bv55VuQlqqZFMAbJWAQfbhhB3nuprxS84HKmZNorNb/LiqKUG82zhddaIM65Nyy8a38fWpYV27ZhXU/FGNE07Z1SgFzY7omBwNDfCanwrpkmpUVEMJ1w7uV5gbL8En0AO4zaCOCCMd0FJISt7vsh623bxTmYM+n5DGfLVQ39bNErDeeDTNNaK60TzElzKJ/pUkr3ExDIv4CsP5iv31rOa/5zAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/1af983805c5736cdbdbbe654c6a132fa/a59e9/image1.webp 192w,
/static/1af983805c5736cdbdbbe654c6a132fa/0ca9f/image1.webp 384w,
/static/1af983805c5736cdbdbbe654c6a132fa/dc9b9/image1.webp 768w,
/static/1af983805c5736cdbdbbe654c6a132fa/3d89b/image1.webp 944w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/1af983805c5736cdbdbbe654c6a132fa/3b721/image1.png 192w,
/static/1af983805c5736cdbdbbe654c6a132fa/66595/image1.png 384w,
/static/1af983805c5736cdbdbbe654c6a132fa/fe486/image1.png 768w,
/static/1af983805c5736cdbdbbe654c6a132fa/26530/image1.png 944w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/1af983805c5736cdbdbbe654c6a132fa/fe486/image1.png"
            alt="image.png"
            title="image.png"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
</blockquote>
<h2>해결방법</h2>
<p>원인이 별로 궁금하지 않은 분들을 위해 해결 방법을 먼저 알려드리면, 간단하게 httpHeader를 overwrite 시켜주면 끝입니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/4af64affb930d4df5f6da235c43f4c13/89260/image12.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 7.291666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAARklEQVQI1wXBiQ2AIBBFQSsRlo+CBxHDRvqv7DmzlG9S3Tl9oDFo78P0xvw611Hod6HWwiphMqIZykJKpLyR8k4wI0iEaPytBh1cBI+v+QAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/4af64affb930d4df5f6da235c43f4c13/a59e9/image12.webp 192w,
/static/4af64affb930d4df5f6da235c43f4c13/0ca9f/image12.webp 384w,
/static/4af64affb930d4df5f6da235c43f4c13/dc9b9/image12.webp 768w,
/static/4af64affb930d4df5f6da235c43f4c13/e2c2f/image12.webp 1152w,
/static/4af64affb930d4df5f6da235c43f4c13/f3efb/image12.webp 1536w,
/static/4af64affb930d4df5f6da235c43f4c13/87f9e/image12.webp 2072w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/4af64affb930d4df5f6da235c43f4c13/3b721/image12.png 192w,
/static/4af64affb930d4df5f6da235c43f4c13/66595/image12.png 384w,
/static/4af64affb930d4df5f6da235c43f4c13/fe486/image12.png 768w,
/static/4af64affb930d4df5f6da235c43f4c13/d2d74/image12.png 1152w,
/static/4af64affb930d4df5f6da235c43f4c13/e8464/image12.png 1536w,
/static/4af64affb930d4df5f6da235c43f4c13/89260/image12.png 2072w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/4af64affb930d4df5f6da235c43f4c13/fe486/image12.png"
            alt="image.png"
            title="image.png"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h2>Response body가 잘리는 이유</h2>
<p>response body가 잘리는 이유를 찾기 위해 디버거를 켰습니다.</p>
<p>디버깅하면서 로직을 분석하다보니 <code class="language-text">BrotliInputStream</code>의 read 메서드가 예상과 다른 동작을 하고 있음을 발견했습니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/a7a60/image2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 77.60416666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACWUlEQVQ4y52Uy27cNhSG9RgZj8Q7KVESRY40lj3OOO2uyKqJkyyDFn3/d/gKaYoULdIE6eLDfwgCh+fKSg0Dymi0Nmhj8M4glUJItdtaa4w1OGcQSiOMQdjNVkgpkVKhpEDLGqsbKhsTy7qQzwtlLrx+vRJzoSwz65rp+kiZZ2KaCMNEmjNdSfRTT+xack6k1NGnkdg5KrVF41qmNLDOAw9LZjklTqeRkge8s/R9wDqLEg2x86ShpY2Rth+QokEIgRCSphFUrp8YzxfGU2YoiSkXxtMZH0dCP2J8oB2m3d5KsmE21TeMdRjrd1tpQ6VdYLw805UTaZlJ8z1hLJzOM3FMOO/w3t00OIxz+yNbZmp3qjBa7FgtqKRsGO9n5vWeXAr54WlPZ5wywxCZR0kfJM5IWq8wRv+Vfo2WAiWOWHHAiANWvqJqnz9x/fU3zm8/k9/+Qf7ld/o3H4nPn+ifX4jXd/jLe9zlBXP5gL287LinD9gvfPxCpdqtaytpeWSYH4l5xcaCDAkZJlSY0O2E+jfh61Rb5+q7A83xQFMfOd4dbuf67m+Od/88f4PKhA4bur3QW/e6zqONptlH4ceptLHkhyvl6SfK0xvmc+HyeCLGlqZuftyhMoZ+fWC+XLm//sw0n2m7dr9smv/hUEiJHRPjsjKdZuJU8N7T1PVXHX7vkX31lA2YNmJ8i96Gdpv+0O11rOuGurlxc3bT/2LfFJsW2mVhWM8MjyuxTOSS8dZgtcJptev282z7+p0INUJblLWEYPHeYo3CKok3Cm/0rtbofUu+Fd0W4Z9zN8v1/R7jxQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/a59e9/image2.webp 192w,
/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/0ca9f/image2.webp 384w,
/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/dc9b9/image2.webp 768w,
/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/e2c2f/image2.webp 1152w,
/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/f3efb/image2.webp 1536w,
/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/97775/image2.webp 1900w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/3b721/image2.png 192w,
/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/66595/image2.png 384w,
/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/fe486/image2.png 768w,
/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/d2d74/image2.png 1152w,
/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/e8464/image2.png 1536w,
/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/a7a60/image2.png 1900w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/fe486/image2.png"
            alt="image.png"
            title="image.png"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>고대의 유물인 <code class="language-text">BrotliInputStream</code>은 destLen이 정확하게 buffer Size만큼 들어오길 기대하도록 짜여져있습니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 490px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/667d075120474e232b5939feb9badf34/ce5c5/image3.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 92.70833333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAADIElEQVQ4y31U23LbNhDVjzS2bFESCQIEQNwIkrrLkhrLuTiJJ43z2EnfOp3J/58M1pYm07p52FkQJA7P7jmLQZEXKPMcsixhuEA5zZHnBQQXlMuSoygYJpMprRljtH96J4QA508xHk8wUFLCiBJLpfDBOKx9gDQWxnmE0KAJDWXvA5omwjl/zjG25/0YI/10MBplKCY5zHqF2aePMNMca2Ow1DVYXtCfE1shKkipoKSCVhqyklBKn6OqJL0fJJqccei2xeqPz9gqjbsm4hgCfVTVBspY1M6jqmtaa+uoCmJqHYyxVH4IAYNsPMHlb6/gthusvn5BZCXWxhLDrbG4MQZ3IeBgHW59wGvncZPeKw3OSiitMZvNsdlsqZpBlo1xPbxC5T3aN3fouMDeeQJb1QZvY8RtaOh5by12xhLwzjpYXaOSCn0/w3K5egYcTzB8dYGw3+Hw7U8sRIV3bYv7tsNrH54AfYBJPbMOm90e690e2TTHcHiF6+sR5cvLIa3PDKVzaPY7hJKjk4oiiopyKk+XnJruk7pNRD7NkY0ypPM/B4lSshKrd29x//0fbCqJx8WC+iiUhgsBxgf4ENC2Hdkk2ajrOvJiYpWccgoCVIyBM4bSWHguMFcaQVTgycgFI9skFfmzfU4xnebkvZRTkLFLLvC7kzgGh89thy/zBT52PR7nC7xvInksmbjrerJFEoAM30RSt+97Yp7WJEqi2UqOIDgsF7Cck2USQ8VKpNFMvWOsPLNJTE6s0t4piGEC3DuFg7N46Gf41PX40HV46Hs8dB1qpRDbjg7/u18vBQHOdIVWVsSqERVMUrRgKFhJIqRy09SMXlD1Pyqnj25Ejhstcd/2eNM0OIYGy9rAWof5fIH9/kDjdXV1TYd+BTxIXlJ//Q25PSDmBTqlyXttJUnhJ4YdCfEz0P+BEqB8/Aaz3OG2rnFsIvbO0agVSaTQYNbP4LzHxcUl9fEE+BLoIBuPUSwzhCiw1ZbGbvd8EbyPkWY39TKVfjze0b13An2ZYTbGxDMYU2FbP10IyTap5E26VWoDUUnqZ/Kb1vUvAX8AoEZYvniLW/UAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/667d075120474e232b5939feb9badf34/a59e9/image3.webp 192w,
/static/667d075120474e232b5939feb9badf34/0ca9f/image3.webp 384w,
/static/667d075120474e232b5939feb9badf34/49ace/image3.webp 490w"
              sizes="(max-width: 490px) 100vw, 490px"
              type="image/webp"
            />
          <source
            srcset="/static/667d075120474e232b5939feb9badf34/3b721/image3.png 192w,
/static/667d075120474e232b5939feb9badf34/66595/image3.png 384w,
/static/667d075120474e232b5939feb9badf34/ce5c5/image3.png 490w"
            sizes="(max-width: 490px) 100vw, 490px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/667d075120474e232b5939feb9badf34/ce5c5/image3.png"
            alt="image.png"
            title="image.png"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>만약 stream 내부적으로 계산했을 때 남은 buffer size가 3013인데 destLen이 8192로 남은 buffer size보다 크게 들어오면 <strong>buffer의 데이터가 압축이 덜 풀린 것으로 인식</strong>하고 buffer의 압축을 푸는 작업을 하도록 짜여져 있습니다.</p>
<p>그럼 왜 상위 메서드에서 <code class="language-text">BrotliInputStream</code>의 read 메서드의 destLen 값으로 더 큰 값을 주었을까요?</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/827160deb296f4bac31f8405347436fe/740ad/image4.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 20.3125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA5ElEQVQY0zXJUU6DQBRAURYizDB03mMo0CkEKNCSWFs0xv1v5xo1fpyvk2TWkscO07ZY8YRKf7mgOFFyDeSlIio48bhScaUQjiXt6UghSnZQTFAyfyCx6Qt57tCup+4H+nPDeolcphOXqWMYIvMSuV1ODF2NSkEVPE3lqYPHpikmTbEmw2YpSR0i57gyzjv3+wf7/snj8cnb6zv7/sW2PRhvT573nW3eWMeVZViYh4WpX7hOK/NwpWsnYj2SWHfASYWRGj02NPGM1BFtO3xZkReCcUpWKKYQCilx//wPJfd/Z5zwDSineZpnuvGZAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/827160deb296f4bac31f8405347436fe/a59e9/image4.webp 192w,
/static/827160deb296f4bac31f8405347436fe/0ca9f/image4.webp 384w,
/static/827160deb296f4bac31f8405347436fe/dc9b9/image4.webp 768w,
/static/827160deb296f4bac31f8405347436fe/e2c2f/image4.webp 1152w,
/static/827160deb296f4bac31f8405347436fe/f3efb/image4.webp 1536w,
/static/827160deb296f4bac31f8405347436fe/4a7a2/image4.webp 1984w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/827160deb296f4bac31f8405347436fe/3b721/image4.png 192w,
/static/827160deb296f4bac31f8405347436fe/66595/image4.png 384w,
/static/827160deb296f4bac31f8405347436fe/fe486/image4.png 768w,
/static/827160deb296f4bac31f8405347436fe/d2d74/image4.png 1152w,
/static/827160deb296f4bac31f8405347436fe/e8464/image4.png 1536w,
/static/827160deb296f4bac31f8405347436fe/740ad/image4.png 1984w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/827160deb296f4bac31f8405347436fe/fe486/image4.png"
            alt="image.png"
            title="image.png"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p><code class="language-text">StringMessageConverter</code>의 readInternal 메서드를 보면 Content-Length 헤더가 따로 없다면 readAllBytes를 수행하도록 되어 있습니다.</p>
<p>readAllBytes는 length를 알 수 없기 때문에 <code class="language-text">Integer.MAX</code> 값으로 넣어주도록 되어 있구요.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e9651ed9b5266d0780c6572d9c61adb7/4e098/image5.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 18.229166666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA9klEQVQY0z3K2U7CUABF0X6G3KENAh1pAUFoSsBWKR2uRQWCQ/z/39gGTXxY2Q/nWP1wgt2/xR6MGI6n+L7HcOCwmEfM70JmE59p7DJLfFzXRY1CbC9GDVxUHKAjD2fs4SQBTuBiheuOMGsJMkOSv5HmLVlR8nw6UtSGwrxwX7akVUeyaUjzmvTRsMxrsqZhse/wNxXBQ02Q7bCitCV5+mRSfhNvjxTmTH36Yv/6QXl4Z91c8Msz4eGTqL5QNR27yrBvOtq2Y1ueiFaGaNkQrVos29YoKdBXSiKEpNcTf4RECoEtJVpcP5KeUP9uhEJcN63QWv/2B/AVfoLWdnIwAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/e9651ed9b5266d0780c6572d9c61adb7/a59e9/image5.webp 192w,
/static/e9651ed9b5266d0780c6572d9c61adb7/0ca9f/image5.webp 384w,
/static/e9651ed9b5266d0780c6572d9c61adb7/dc9b9/image5.webp 768w,
/static/e9651ed9b5266d0780c6572d9c61adb7/45954/image5.webp 848w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/e9651ed9b5266d0780c6572d9c61adb7/3b721/image5.png 192w,
/static/e9651ed9b5266d0780c6572d9c61adb7/66595/image5.png 384w,
/static/e9651ed9b5266d0780c6572d9c61adb7/fe486/image5.png 768w,
/static/e9651ed9b5266d0780c6572d9c61adb7/4e098/image5.png 848w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/e9651ed9b5266d0780c6572d9c61adb7/fe486/image5.png"
            alt="image.png"
            title="image.png"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>그래서 InputStream에서 bytes를 읽어올 때 InputStream 입장에선 정확히 남은 bytes를 모르므로 그냥 본인이 읽을 수 있는 DEFAULT_BUFFER_SIZE인 8192로 length를 넣어준 것입니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b08aabd1a79c9798283d445eba110c2b/47fb9/image6.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 78.64583333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACvElEQVQ4y3WU247cNhBE9RkZieKdIqkLpZmd7Ma7tuGsEcNBjAUS5DXI/3/FCchJbOf2UKpWi6DI6uru7HLGzoW4HWzbzMP9wbfXQlpW7JRY5oiaFlRckUtGHQW5zhjncM5hnSOEiSkmtDZ00jhCXtiOg7nsrKW0TXKOxDSR89Q45kgIHudtg7UGKeVXUI07ozWqwidUyJgQ2bbMvs+Ukillpmy5xXPd2Gmit3jnGMcROY6NWyxHOq11S4qhZxQ9YhjoTz1939PXuO859UNDPwgGMX7GOMp/oZNa45aFqVxY7x5YjgvzccVMMzYu+BCJMZAmh7cKq8e/wagv0GqkU8YSypXluGO5uyfNt41czOSgiMER7EjygmAEkxUEK0hOEN0t/itndNvQYeeD7f6J7f4Ved1aUaYYWZJlTh5tLNkLShSN/+uqn69cT+iWM1PKaOep79YolKwaVdYoKTGyx6oeIwdE1XAQjb/oKlphOqktLlZf1ZOYBqUt0ob2AzkFnPeEmLF1XUgEb1iTZfKGLTtSME1jYwydUgqpDXa9sD88sZyvTHnGpo1ULoQyk+bcpKjmn9a9yXCsnjU7jiVQZse+Vp8GOjnWowqkUtgQsN41ceU4oLVEixNiODEMJ0T/TYubtYaeYbjZ68anZr3OxZWKaduZLxfSVkj7znx3Jh1Hy+fLueWmtRBLbdNCOvb2Pe439rlgw0qXL+/I12fmx09s331kf37h6cMLP/z8G5f3v/L08jt3z7+wvfqR7eknyutP7G9eOL99oTx84Hj8yHx9Tzq/I12+pxvFQEW9jk8ZvxfyOpNybgMg1OobjfEOF0JDXdf8ahTeGZQUf0rR34pSe7k29nr/yP7whrTtWO+pbVn1ar1aW61aQ1S73FDzon77akh09VHLXVELo5ptNK36Sv1jovw/bsNB8gee7Mk/RksllwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/b08aabd1a79c9798283d445eba110c2b/a59e9/image6.webp 192w,
/static/b08aabd1a79c9798283d445eba110c2b/0ca9f/image6.webp 384w,
/static/b08aabd1a79c9798283d445eba110c2b/dc9b9/image6.webp 768w,
/static/b08aabd1a79c9798283d445eba110c2b/e2c2f/image6.webp 1152w,
/static/b08aabd1a79c9798283d445eba110c2b/cba34/image6.webp 1246w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/b08aabd1a79c9798283d445eba110c2b/3b721/image6.png 192w,
/static/b08aabd1a79c9798283d445eba110c2b/66595/image6.png 384w,
/static/b08aabd1a79c9798283d445eba110c2b/fe486/image6.png 768w,
/static/b08aabd1a79c9798283d445eba110c2b/d2d74/image6.png 1152w,
/static/b08aabd1a79c9798283d445eba110c2b/47fb9/image6.png 1246w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/b08aabd1a79c9798283d445eba110c2b/fe486/image6.png"
            alt="InputStream.java"
            title="InputStream.java"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<blockquote>
<p>InputStream.java</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f6c4ae16ee0366c8452537cebb415874/8cb5d/image7.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 6.770833333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAATElEQVQI1wXBSw6AIAxAQY+iQJQWIyURib+40fsf6TnTOc343PBLxakRbGeYZkJuuFTopVAs8R3KtUaajbxH4q7CswmbjUQV2lkRjfy96h7binkOaQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/f6c4ae16ee0366c8452537cebb415874/a59e9/image7.webp 192w,
/static/f6c4ae16ee0366c8452537cebb415874/0ca9f/image7.webp 384w,
/static/f6c4ae16ee0366c8452537cebb415874/dc9b9/image7.webp 768w,
/static/f6c4ae16ee0366c8452537cebb415874/76c93/image7.webp 906w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/f6c4ae16ee0366c8452537cebb415874/3b721/image7.png 192w,
/static/f6c4ae16ee0366c8452537cebb415874/66595/image7.png 384w,
/static/f6c4ae16ee0366c8452537cebb415874/fe486/image7.png 768w,
/static/f6c4ae16ee0366c8452537cebb415874/8cb5d/image7.png 906w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/f6c4ae16ee0366c8452537cebb415874/fe486/image7.png"
            alt="image.png"
            title="image.png"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
</blockquote>
<p>그래서 옛날 구현으로 되어 있는 <code class="language-text">BrotliInputStream</code>은 압축 해제를 시도했지만, state가 이미 FINISHED 상태라 압축 해제를 진행하지 않았고 -1을 return 합니다.</p>
<blockquote>
<p>추측: BrotliInputStream이 구현 될 당시엔 상위에서 정확하게 읽어야 할 byte를 계산해서 넣어줬을 것으로 예상됩니다.</p>
</blockquote>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/0c65650e982e29ab2e865882abfee859/cf75f/image8.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 59.895833333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABrUlEQVQoz42T627jIBBG8xwJNrYDtjHY+IJdkrRV9/0f6qxMsllV6m7742PERYeZD+ZQ1BbdGIqiIMsycinvMc8oCol8zIUQj/X8Gb/SYR8a5/Evr9gp4OMbretZgifGmW3zWNtSVeUT/i9YAmbiROMGxss7btmYbh8M2zWBjXVc4sTra2BdPUqdfwIUtG5kuX7Qh8h4+8UQ3+m3G6Yz9K7BjzbBhPhJyUKgrKWJkW6aWS83Qrzhx4l+HKk7l/zb9R0sAeV+oGlRy8ywbSxhI8Qr6+0t2eDDinP2s3//y3A/mMsCpVu69Q3lJuw0o7se1RjKQqK0+gT89pXPVXX/LuWZXJYUeYY4HhGnI5nIniXvoO9LznPK2lDZCWUcdtlo/YwNMT1MNwVUa3AhYsYlZSoe4K90qJuW0i7Uw5J8VC8rdQw0l436sqFfAudxYFln+t5RlSWFzJMVUuYUUibtF+2NcEgbquHsZop2oOt7tnVgXQeWMDA6w9RpbF3hjWbsNFNXs/YNQ6sZjU7rpq3xvuegtb77kzy6e3U6fY77/xOp/f7qJLJHS971pz1/AzT6ViU0oue3AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/0c65650e982e29ab2e865882abfee859/a59e9/image8.webp 192w,
/static/0c65650e982e29ab2e865882abfee859/0ca9f/image8.webp 384w,
/static/0c65650e982e29ab2e865882abfee859/dc9b9/image8.webp 768w,
/static/0c65650e982e29ab2e865882abfee859/23d9c/image8.webp 1078w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/0c65650e982e29ab2e865882abfee859/3b721/image8.png 192w,
/static/0c65650e982e29ab2e865882abfee859/66595/image8.png 384w,
/static/0c65650e982e29ab2e865882abfee859/fe486/image8.png 768w,
/static/0c65650e982e29ab2e865882abfee859/cf75f/image8.png 1078w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/0c65650e982e29ab2e865882abfee859/fe486/image8.png"
            alt="image.png"
            title="image.png"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<blockquote>
<p>참고로 정상적인 압축 해제 과정은 response body가 있는지 확인하는 과정에서 진행됩니다. 이 과정에서 압축 해제가 완료되면 stream의 state가 FINISHED로 바뀝니다.</p>
</blockquote>
<p>-1을 return 받은 InputStream은 더 읽을 게 없다고 판단하고 stream 읽기를 종료해버립니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/865746e482a087130fc4f00b7239e3b2/9cda9/image9.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 30.208333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABKUlEQVQY05WOWVLCUBBFsw3lze8lkJIwRSCMkXlSC7WKP/e/jGMlsAE/TnX3vV23OzJG4ILCxRobNL5psbHGJxUG6yShaWrdxQbrNSF1tVdpoWUJD6/KiLLySrb6Zry9ki/fKdYnlucvXnc/dBdnRscbveWFzmRLVlTsyIoN2XhTz53pnmyyp1MxPRDF7SE+zUnaOUm5JZ+9sT5emX/80p8fKE430t6EzmTDYHmmPSzJV5/0ywuj8kQ3n9EbLcgGU0LaJ5KNJ4w1pP2cJHuhmbYIIeB8qHXrHEoKtDEY59BaYb2ve+ssWkmMViglEI1nIqUUvpmSl3u64zlpd0CIE3yIEUIgK6RCSvnoH1WIu1/NNVWoIkqSGK01xt2vamPR2tQfKSnrpf/wB4blslNO3VRkAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/865746e482a087130fc4f00b7239e3b2/a59e9/image9.webp 192w,
/static/865746e482a087130fc4f00b7239e3b2/0ca9f/image9.webp 384w,
/static/865746e482a087130fc4f00b7239e3b2/dc9b9/image9.webp 768w,
/static/865746e482a087130fc4f00b7239e3b2/a9696/image9.webp 1026w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/865746e482a087130fc4f00b7239e3b2/3b721/image9.png 192w,
/static/865746e482a087130fc4f00b7239e3b2/66595/image9.png 384w,
/static/865746e482a087130fc4f00b7239e3b2/fe486/image9.png 768w,
/static/865746e482a087130fc4f00b7239e3b2/9cda9/image9.png 1026w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/865746e482a087130fc4f00b7239e3b2/fe486/image9.png"
            alt="image.png"
            title="image.png"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>그래서 마지막에 남은 3013 bytes에 해당하는 response body가 잘렸던 것입니다.</p>
<h2>왜 사용하지않던 brotli Encoding이 들어갔을까?</h2>
<p>spring boot 버전업을 진행하면서 httpclient가 4 → 5로 버전업되었습니다.</p>
<p>그러면서 ContentCompression 로직에 broliSupported가 추가되었는데, 이게 true가 되면서 br이 포함되어서 내려가게 되었습니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/55345dc5bcc2b006decfc53ce8d53fcf/c7591/image10.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 31.770833333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABCElEQVQY01WQSW7DMBAE9RAtJIe7KFGKbMBZkCD5/58qMOMY9qEwjTkUGt3puKBSwSyVtO7Mpwth3dHWM3rHmOIfMTDEgARPzpm5zIgIwzAwjuOdTmJheftk+/phe//mePsgpoBo1TBquuUJLxqtJozWTfQve8ydFksoG9ZHJi2IGFIKBGdxRmONwsn1aqKTJrdinlo9NTRG8KXi5wXtAiEG5jkRnW2NrrJgTRNlJ61d3/eMw0DfP9I3OhNmXC7kerQNbUyoklFrQeXEnDNlq/jThj8qLzWwLZHLkanFYYzCWnND6B43uA/8MPT1p7Xi2DOv58J5T2xrJqbIulf284lSEiE4YvT8AlVBq7rCUmFcAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/55345dc5bcc2b006decfc53ce8d53fcf/a59e9/image10.webp 192w,
/static/55345dc5bcc2b006decfc53ce8d53fcf/0ca9f/image10.webp 384w,
/static/55345dc5bcc2b006decfc53ce8d53fcf/dc9b9/image10.webp 768w,
/static/55345dc5bcc2b006decfc53ce8d53fcf/e2c2f/image10.webp 1152w,
/static/55345dc5bcc2b006decfc53ce8d53fcf/f3efb/image10.webp 1536w,
/static/55345dc5bcc2b006decfc53ce8d53fcf/5162c/image10.webp 1574w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/55345dc5bcc2b006decfc53ce8d53fcf/3b721/image10.png 192w,
/static/55345dc5bcc2b006decfc53ce8d53fcf/66595/image10.png 384w,
/static/55345dc5bcc2b006decfc53ce8d53fcf/fe486/image10.png 768w,
/static/55345dc5bcc2b006decfc53ce8d53fcf/d2d74/image10.png 1152w,
/static/55345dc5bcc2b006decfc53ce8d53fcf/e8464/image10.png 1536w,
/static/55345dc5bcc2b006decfc53ce8d53fcf/c7591/image10.png 1574w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/55345dc5bcc2b006decfc53ce8d53fcf/fe486/image10.png"
            alt="image.png"
            title="image.png"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>brotliSupported는 단순히 BrotliInputStream 클래스가 있으면 사용 가능하다고 보고 있었는데요, brotli 관련 라이브러리를 추가한 적이 없었습니다. 어디서 추가된걸까요?</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/8e481743b9614b3d55093c6bea0bba15/cc5fa/image11.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 32.8125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABEUlEQVQoz5WRS44bMQwF+xxx60eKkiz1x+mMg2CQ+1+rArczCAzMLLIoFPG4IfEmGQfad6TfiHUh9gOpneP74DgW3t42xhiIKpd5xjnH/AWP3RRyxfpKUCGJYGZkM6wYpRZyVjRFJMUXq7ySJZFSYnKXb/ispPudvt/49f6b236jt8a2rjQzVhOWB0UZJmzlyVqEW83sVdmboapMInK+a8uP075t+GvFrwPXG35cT9y4EnLGt3rObvQn/crcG6lkihlTjJHUVvJ2R5eDvP9El4VQC6HY6fiYWyGqErM+s1YIlonVTksW8seFIQR8FHyIhCQEH3CXC+5Rwgvuk+zfbp5nJuc93nucezb4Yf83/1/+AE7NxQ1GaqabAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/8e481743b9614b3d55093c6bea0bba15/a59e9/image11.webp 192w,
/static/8e481743b9614b3d55093c6bea0bba15/0ca9f/image11.webp 384w,
/static/8e481743b9614b3d55093c6bea0bba15/dc9b9/image11.webp 768w,
/static/8e481743b9614b3d55093c6bea0bba15/e2c2f/image11.webp 1152w,
/static/8e481743b9614b3d55093c6bea0bba15/145c7/image11.webp 1188w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/8e481743b9614b3d55093c6bea0bba15/3b721/image11.png 192w,
/static/8e481743b9614b3d55093c6bea0bba15/66595/image11.png 384w,
/static/8e481743b9614b3d55093c6bea0bba15/fe486/image11.png 768w,
/static/8e481743b9614b3d55093c6bea0bba15/d2d74/image11.png 1152w,
/static/8e481743b9614b3d55093c6bea0bba15/cc5fa/image11.png 1188w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/8e481743b9614b3d55093c6bea0bba15/fe486/image11.png"
            alt="image.png"
            title="image.png"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>알고보니 <code class="language-text">tika-parser</code>라는 라이브러리에 전이종속성으로 brotli 라이브러리가 포함되어서 들어온 것이었습니다.</p>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
</style></div><div class="py-0 px-5 md:p-0  md:w-[725px] lg:w-[840px] mx-auto"></div><footer class=" grid place-items-center mt-auto p-12 text-xs md:text-sm text-center leading-6 text-gray-600">Thank You for Visiting My Blog, Have a Good Day 😆<br/>© 2022 정현모, Powered By Gatsby.</footer></main></div></div></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/etc/2024-10-02-response body가 잘리는 현상/";window.___webpackCompilationHash="e1e6a4948f67f9bb80d2";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-637fcefc4628f707002d.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-8c3b3e6f705c3f132a04.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-d1e7a176a1ad7e7b3273.js"],"component---src-templates-post-template-tsx":["/component---src-templates-post-template-tsx-7a1ae7bf742211cfb8f1.js"]};/*]]>*/</script><script src="/app-637fcefc4628f707002d.js" async=""></script><script src="/framework-9481b76e93b7e52994a8.js" async=""></script><script src="/webpack-runtime-ba02f7795fe7073b829c.js" async=""></script></body></html>