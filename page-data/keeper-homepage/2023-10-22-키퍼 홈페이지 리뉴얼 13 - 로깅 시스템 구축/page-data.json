{"componentChunkName":"component---src-templates-post-template-tsx","path":"/keeper-homepage/2023-10-22-키퍼 홈페이지 리뉴얼 13 - 로깅 시스템 구축/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<blockquote>\n<p>최근에 키퍼 홈페이지에 로그 분석 시스템이 필요하다고 느꼈습니다.</p>\n</blockquote>\n<p>드디어 키퍼 홈페이지 리뉴얼2가 배포됐습니다.</p>\n<p>무려 하루 사용자가 50명이나 되는 서비스가 됐는데요.</p>\n<p>사용자가 많아지면서 버그도 많아지고 트러블슈팅용 로그 모니터링 시스템이 필요해졌습니다.</p>\n<h2>ELK</h2>\n<p>처음에 생각한건 제일 유명한 ELK였는데, 저희 조그마한 서버의 스펙으론 버틸수 없겠더라구요.</p>\n<img width=\"562\" alt=\"image\" src=\"https://user-images.githubusercontent.com/26597702/277145580-bb31a7ff-60b8-44e2-9a56-dd7a98524314.png\">\n<blockquote>\n<p>우리의 작은 서버 스펙 (t3.small)</p>\n</blockquote>\n<img width=\"222\" alt=\"스크린샷 2023-10-22 13 41 58\" src=\"https://user-images.githubusercontent.com/26597702/277145625-ca02b41c-8e6b-478b-bd19-149fe24b8891.png\">\n<p>그래서 한 번 가벼운 ELK가 있을 지 찾아봤습니다.</p>\n<img width=\"519\" alt=\"image\" src=\"https://user-images.githubusercontent.com/26597702/277145647-ac697a8d-8300-4584-a3da-825beccdfba7.png\">\n<p>제일 상단에 뜨는 <code class=\"language-text\">signoz</code>. 대놓고 <strong>ELK의 경량화 대안</strong>이라고 소개를 하고 있으니 한 번 써보도록 하겠습니다.</p>\n<h2>signoz</h2>\n<p>signoz는 로그 뿐만 아니라 메트릭, 애플리케이션간의 추적도 지원하는데요, 이런 모든 중요한 모니터링을 하나의 대시보드에 통합해서 <strong>운영 오버헤드를 줄일 수 있다</strong>고 소개하고 있습니다.</p>\n<p>또, 오픈소스이기도 하고 <code class=\"language-text\">k8s</code>, <code class=\"language-text\">Helm</code>, <code class=\"language-text\">prometheus</code> 같은 기술들을 지원하는 단체인 <code class=\"language-text\">CNCF(Cloud Native Computing Foundation)</code>에서 지원하는 기술이기도 합니다.</p>\n<p>흥미로웠던건, README에서 <strong>타 기술들과 자신의 차이점(장점)을 공공연하게 드러내고 있더라구요.</strong> (<a href=\"https://github.com/SigNoz/signoz#comparisons-to-familiar-tools\" target=\"_blank\" rel=\"nofollow\">https://github.com/SigNoz/signoz#comparisons-to-familiar-tools</a>)</p>\n<blockquote>\n<p>마치 <code class=\"language-text\">gradle</code>이 처음 나왔을 때 <code class=\"language-text\">maven</code>과 비교하면서 자신만만했던 README를 보는 것 같습니다.</p>\n</blockquote>\n<p>ELK와 비교해서 signoz에선 어떤 기술 스택을 사용하고 있는지 한 번 보겠습니다.</p>\n<h3>ElasticSearch → Clickhouse</h3>\n<p>수많은 로그와 메트릭들이 파이프라인을 타고 데이터가 적재될텐데, 이를 저장할 저장소(DB)가 필요합니다.</p>\n<p>ELK에선 <code class=\"language-text\">ElasticSearch</code>가 그 역할을 해주고 있었다면, signoz에선 <code class=\"language-text\">clickhouse</code>라는 DB를 사용합니다.</p>\n<p><code class=\"language-text\">clickhouse</code>는 다른 DB와 다르게 컬럼지향 DBMS인데요, 여기선 자세히 다루지 않겠습니다.</p>\n<p>데이터를 수집할 때 50%나 낮은 리소스 요구사항을 벤치마크로 확인했다고 하네요.</p>\n<ul>\n<li><a href=\"https://signoz.io/blog/logs-performance-benchmark/?utm_source=github-readme&#x26;utm_medium=logs-benchmark\" target=\"_blank\" rel=\"nofollow\">https://signoz.io/blog/logs-performance-benchmark/?utm_source=github-readme&#x26;utm_medium=logs-benchmark</a></li>\n</ul>\n<h3>Logstash → OpenTelemtry</h3>\n<p>애플리케이션에서 나오는 메트릭, 수많은 로그들을 누군가는 수집(collect)해야 하는데요.</p>\n<p>ELK에선 <code class=\"language-text\">Logstash</code>(혹은 beat시리즈)가 그 역할을 해주고 있었다면, signoz에선 <code class=\"language-text\">opentelemetry</code>를 사용합니다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/26597702/277146744-071a1b5b-9311-4a76-b1f7-2053a6a7b31a.png\" alt=\"image\"></p>\n<p>위 그림의 <code class=\"language-text\">OTeL Collector</code>가 그 역할을 하는데 다른 collector와 다르게 데이터를 저장하거나 보여주진 않습니다.</p>\n<p>오직 약간의 가공과 전송만 담당하는데요. 그 이유는 opentelemetry의 이념 때문인데, 데이터의 통계, 시각화 같은 기능들은 의도적으로 모니터링 벤더에게 위임하기 때문입니다.</p>\n<p>참고: <a href=\"https://jennifersoft.com/ko/blog/tech/opentelemetry\" target=\"_blank\" rel=\"nofollow\">https://jennifersoft.com/ko/blog/tech/opentelemetry</a></p>\n<h3>Kibana → signoz frontend</h3>\n<p>kibana의 역할을 하는 건 signoz 자체적으로 만든 frontend를 사용합니다.</p>\n<p>생각보다 UI가 이쁘고 괜찮아요. kibana 만큼 다양한 통계나 시각화를 지원하진 않지만, 트러블슈팅 로그 추적엔 최고입니다.</p>\n<h2>signoz 설치해보기</h2>\n<h3>signoz 설치 (with docker-compose)</h3>\n<pre class=\"grvsc-container default-dark\" data-language=\"shell\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">git clone -b main https://github.com/SigNoz/signoz.git</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">cd signoz/deploy/</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">./install.sh</span></span></code></pre>\n<h3>처음 접속시 회원가입 (최초 회원가입은 admin이 됨)</h3>\n<img width=\"896\" alt=\"image\" src=\"https://user-images.githubusercontent.com/26597702/275214896-7392ef86-a23f-40c4-900e-6f6f0e0c8cc6.png\">\n<h3>opentelemetry javaagent 설치</h3>\n<p>opentelemtry는 우리의 java 코드를 전혀 건드리지 않고 로그, 메트릭 수집을 할 수 있습니다.</p>\n<p>바로 <code class=\"language-text\">javaagent</code>를 이용하는 건데, <code class=\"language-text\">javaagnet</code>는 <code class=\"language-text\">main</code> 메서드를 가로채 여러 동작을 할 수도 있고, 실행시간에 동적으로 bytecode를 조작할 수도 있습니다.</p>\n<p>javaagent를 먼저 다운받아주고,</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"shell\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">wget https://github.com/open-telemetry/opentelemetry-java-instrumentation/releases/latest/download/opentelemetry-javaagent.jar</span></span></code></pre>\n<p>아래와 같이 -D옵션만 줘서 jar를 띄우면 끝입니다.</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"shell\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">java -javaagent:/path/opentelemetry-javaagent.jar \\</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> -Dotel.exporter.otlp.endpoint=http://&lt;IP of SigNoz&gt;:4317 \\</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> -Dotel.resource.attributes=service.name=&lt;service_name&gt; \\</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> -jar target/*.jar</span></span></code></pre>\n<p>다음 포스팅에선 제대로 한 번 signoz를 사용해보고 어떤 장점이 있는지 알아보겠습니다.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"title":"키퍼 홈페이지 리뉴얼 13 - 로깅 시스템을 구축해보자! (with SIGNOZ not ELK)","summary":"최근에 키퍼 홈페이지에 로그 분석 시스템이 필요하다고 느꼈습니다.","date":"2023.10.22.","categories":["keeper_homepage"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/webp;base64,UklGRjIBAABXRUJQVlA4WAoAAAAQAAAAEwAACQAAQUxQSC0AAAABR6CgbRuGP+L+jUZExCfJToChtlEu54BgCBOEN2KQvh8CIvo/ARm4FtYX03gAVlA4IN4AAACwAgCdASoUAAoAAAAAJZwCdDKgOldBrwdKF7pGdCAA/v//nIPy78T/zRf8Gcn+PJY+6bgAAz1MS8uxGEpQPj7v/V1n/5v734d+/9/ins5Uf1P/Knle75nH513gNqYv7J/kKwFWkuB+pT34t4Ou/CmEzI/eKxonL7DHj2hSg4cfgTwxfQfcAf/ZyZxW3bHjQaZ/xXVizPm/3ofp9XZbWx9y/+0/2Pe4/+JI2S71DHOyMsVp+0HJXUZGcA05gvwmj4ofwwB7nBL6h+0Hjw5xOL5q6rT6/gBvfs2wtbCAAAA="},"images":{"fallback":{"src":"/static/1e9b6b767c48250a98abf4ecfb165fc1/36677/signoz.webp","srcSet":"/static/1e9b6b767c48250a98abf4ecfb165fc1/f9871/signoz.webp 483w,\n/static/1e9b6b767c48250a98abf4ecfb165fc1/9d54a/signoz.webp 966w,\n/static/1e9b6b767c48250a98abf4ecfb165fc1/36677/signoz.webp 1932w","sizes":"(min-width: 1932px) 1932px, 100vw"},"sources":[]},"width":1932,"height":1009}},"publicURL":"/static/1e9b6b767c48250a98abf4ecfb165fc1/signoz.webp"}}}}]}},"pageContext":{"slug":"/keeper-homepage/2023-10-22-키퍼 홈페이지 리뉴얼 13 - 로깅 시스템 구축/"}},"staticQueryHashes":["2518467932","429584967"]}