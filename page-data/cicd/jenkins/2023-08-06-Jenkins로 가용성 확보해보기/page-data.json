{"componentChunkName":"component---src-templates-post-template-tsx","path":"/cicd/jenkins/2023-08-06-Jenkins로 가용성 확보해보기/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<blockquote>\n<p><strong>이번엔 jenkins를 k8s에 올려서 가용성을 확보해보는 작업을 해보겠습니다</strong></p>\n</blockquote>\n<h2>배경지식</h2>\n<h3>jenkins는 HA를 지원하지 않는다.</h3>\n<p>jenkins는 기본적으로 가용성 보장을 하지 않기 때문에, 마스터를 여러대 띄워도 의미가 없습니다.</p>\n<p>오히려 마스터를 여러대 띄워버리면 설정파일에 대한 <strong>일관성 없는 읽기 / 쓰기 때문에 오히려 문제가 생길 수 있습니다.</strong></p>\n<h3>jenkins는 파일로 저장된다.</h3>\n<p>jenkins는 기본적으로 데이터를 저장할 때 다른 스토리지(SQLlite, MySQL…)를 쓰지 않고 모두 파일에 저장합니다.</p>\n<p>그래서 모든 jenkins 파일을 그대로 복사해서 다시 jenkins를 띄우면 이론상 그대로 <strong>복원이 가능합니다.</strong></p>\n<p>(이 때 jenkins 관련 모든 파일, 폴더가 있는 디렉토리를 보통 <strong>jenkins_home</strong> 이라고 부릅니다.)</p>\n<h2>jenkins 가용성 확보</h2>\n<p>jenkins가 가용성을 보장해주지 않는다면, 우리가 가용성을 보장해주면 됩니다.</p>\n<p>방법은 간단한데, 바로 k8s에 jenkins를 pod로 올려서 k8s의 recover 기능을 사용하는 것입니다.</p>\n<p>만약 jenkins가 사용불능이 되면 k8s에선 jenkins를 다시 띄워주기만 하면 됩니다.</p>\n<h3>방법1. jenkins_home을 외부 볼륨에 NFS처럼 항상 mount하기</h3>\n<p><img src=\"https://user-images.githubusercontent.com/26597702/271594042-e3cd448a-e952-4b3b-abc3-91fc706e5971.png\" alt=\"image\"></p>\n<p>위와 같이 항상 외부 볼륨을 마운트해서 사용하는 방법이 첫 번째입니다.</p>\n<p>테스트를 해보았는데…</p>\n<p><img src=\"https://user-images.githubusercontent.com/26597702/271594103-148550c5-e717-4a00-a652-6ba99d2f185c.png\" alt=\"image\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/26597702/271594183-6b53518f-377f-4115-a730-d0f17973fa9e.png\" alt=\"image\"></p>\n<p>WAR 파일을 읽어들이는데만 <strong>약 5분</strong>의 시간이 걸렸고,</p>\n<p>jenkins가 완전히 뜨는덴 <strong>12분</strong>정도의 시간이 걸렸습니다.</p>\n<p>그럼 평소(로컬 디스크)에 jenkins는 얼마만에 뜰까요?</p>\n<p><img src=\"https://user-images.githubusercontent.com/26597702/271594263-c747372c-cd0a-4837-b42b-048b60539d38.png\" alt=\"image\"></p>\n<p><img src=\"https://user-images.githubusercontent.com/26597702/271594362-8aa8e504-59e5-4d21-9c69-a775335d7f96.png\" alt=\"image\"></p>\n<p><strong>12:13:42</strong>에 war파일을 읽기 시작해서 jenkins가 완전히 뜬 시간은 <strong>12:14:53. 약 1분정도의 시간이 걸립니다.</strong></p>\n<p>NFS로 외부에서 실시간으로 읽어오고 저장하는건 너무 오랜 시간이 걸리는 것을 알 수 있습니다.</p>\n<h3>방법2. 주기적으로 jenkins_home을 백업하고 복원하기.</h3>\n<p><strong>SPOF: k8s cluster, 외부 볼륨</strong></p>\n<p><img src=\"https://user-images.githubusercontent.com/26597702/271594425-bc9d3355-f7fd-413b-b2eb-686d8e3162e7.png\" alt=\"image\"></p>\n<p>위와 같이 <code class=\"language-text\">init container</code>를 이용해 jenkins가 죽으면 jenkins_home을 다운받아서 다시 복원하는 형식입니다.</p>\n<p>복원에 사용될 jenkins_home은 cron을 이용해 주기적으로 백업해주는 방식입니다.</p>\n<h2>끝!</h2>\n<p>오늘은 한 번 jenkins에 HA를 구성해봤는데요, 배운 데에서 그치지 않고 더 고민해 보는것도 재밌는 것 같습니다.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","frontmatter":{"title":"Jenkins로 가용성 확보해보기","summary":"이번엔 jenkins를 k8s에 올려서 가용성을 확보해보는 작업을 해보겠습니다","date":"2023.08.06.","categories":["jenkins"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAATABQDASIAAhEBAxEB/8QAGgABAQACAwAAAAAAAAAAAAAAAAgEBQYHCf/EABcBAQADAAAAAAAAAAAAAAAAAAcFBgj/2gAMAwEAAhADEAAAAeu6c0+GGsHh4stfpfitMiSAxwBne/8A/8QAGxAAAgMBAQEAAAAAAAAAAAAABQYDBAcCART/2gAIAQEAAQUCxjGFAoosaPkJoWZTSQ8lnTmu+K0JTP1K2dL3ZSdCTuQUIrV+0g/719n/xAAlEQACAgEEAQMFAAAAAAAAAAACAwEEBQYREhQiABMxFSEjJDP/2gAIAQMBAT8BtIio8qYoWA1rdocnUSUgzHrf5l1gWToDsrYQrEZjdcrkSYLImLGldIEyDvrzIXGKrtsxj6+Pt0ic2uphsrWfrVaHLdJe7BikA8/DkMQZaut2qmqcyNWzYrDcBPbGu5iRtb4VVuexCyGHb2oiz+Tl+xEO/p5eqeOx51wI6NM55NHcqySniDTAB3kPgAERGPgRGBj7RHr/xAAkEQACAQIFBQEBAAAAAAAAAAABAgMEBRESEyExABQiIzIkUf/aAAgBAgEBPwGVrrU3Gpnq5r+KlZs9ppqOGWWknVZEFMe4fLTlVGLtJJEUOlIJshXSaG63URoulESoynPrKwZdmUr274ZGxT6JwG+B2FriiltNEZY0kMTDSLormP8AbpessDk9Xr8cPDw+dunllDbSScKftuSoJPPJJxP9PX//xAAmEAACAgEEAgIBBQAAAAAAAAACAwEEBQYREhMUIQAiIxUxQUJR/9oACAEBAAY/Ak6w1Mi/YixZsXEVRtMCkdHHL6wsdVRfnnMvi9MKVY5NiADrP6jLNG49OLwtq8Fm2m9goTF2lcrpRt+ofcrtgSBwFYx9gTEVpZNjw7ApIrWOYKvIxzTx9nrP6d9IyrGUbxvENhQtHf8AqcT/AD8RpfUeTqYd9aZsV3zAU8e+tkWsyAqA+M1Kx132bCPDsSHKuKHK7Y58X3x1Ld1hQx1FdXSGlh8zIhgvqcZOxStOkMYpWTZE9mU4KiKxMFj7gQmBtZJVisg825+Yth4faMW7lh3aK5MlmIK6xRAkPL8UnO3PaMcwzIjOjTMymfZH1GrkX+lIJVEzPueETPvefmYtMQptgQyygc5YuNS6dihFcUSyC6OEWn79PCWc/wAnPgHFIQRwK6FEQETIYiCQLJ/aY33NhlMz73n5/8QAGRABAQEBAQEAAAAAAAAAAAAAAREAITFR/9oACAEBAAE/IXSN2cMeZEDtc+p+WxkbLY1kXlev6MuRCAsc0Mr8tgVUK3hVtw2imVE5jgMS8P8AffLMQqSAltazpm6N9m6orScSnEmSiFxF4jci0Cb7lyEtZA//2gAMAwEAAgADAAAAEPcXvf/EABgRAQEBAQEAAAAAAAAAAAAAAAERACFB/9oACAEDAQE/EHLWGmIxAJNKqABftEqlLMWZp7XSUhmFE2hyAEJAejBb2HhUEf/EABkRAQADAQEAAAAAAAAAAAAAAAEAESExYf/aAAgBAgEBPxDKam5FdjhYZdHEBTsHMqQ0BAMPY74QwNHbV6RTBCygtXVpBOorarP/xAAZEAEBAQEBAQAAAAAAAAAAAAABABExECH/2gAIAQEAAT8Qibrbq5WZ9IFc2p+3QQpTJXpSAeJyxkBfhG70guyaJ59dW1A0FCAXO7+wS0TTzn8tuyTAYgWxuoU4sOCtRBUn4ICsQKG4YsE+qH0in//Z"},"images":{"fallback":{"src":"/static/6a3b9dce28b4687f9f583de058b08be4/cad72/choonsik_jenkins.jpg","srcSet":"/static/6a3b9dce28b4687f9f583de058b08be4/263a2/choonsik_jenkins.jpg 264w,\n/static/6a3b9dce28b4687f9f583de058b08be4/ac426/choonsik_jenkins.jpg 529w,\n/static/6a3b9dce28b4687f9f583de058b08be4/cad72/choonsik_jenkins.jpg 1057w","sizes":"(min-width: 1057px) 1057px, 100vw"},"sources":[{"srcSet":"/static/6a3b9dce28b4687f9f583de058b08be4/c5924/choonsik_jenkins.webp 264w,\n/static/6a3b9dce28b4687f9f583de058b08be4/d0e04/choonsik_jenkins.webp 529w,\n/static/6a3b9dce28b4687f9f583de058b08be4/8470c/choonsik_jenkins.webp 1057w","type":"image/webp","sizes":"(min-width: 1057px) 1057px, 100vw"}]},"width":1057,"height":1016.0000000000001}},"publicURL":"/static/6a3b9dce28b4687f9f583de058b08be4/choonsik_jenkins.jpeg"}}}}]}},"pageContext":{"slug":"/cicd/jenkins/2023-08-06-Jenkins로 가용성 확보해보기/"}},"staticQueryHashes":["2518467932","429584967"]}