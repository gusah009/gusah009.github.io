{"componentChunkName":"component---src-templates-post-template-tsx","path":"/cicd/jenkins/2023-07-23-Jenkins를 이용한 CICD 파이프라인 구축 2/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<blockquote>\n<p><strong>jenkins 시작하기</strong></p>\n</blockquote>\n<h2>Jenkins 시작해보기</h2>\n<h2>Jenkins 설치</h2>\n<p><code class=\"language-text\">brew install jenkins-lts</code></p>\n<p><code class=\"language-text\">brew servies restart jenkins-lis</code></p>\n<img width=\"400\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/f2ff1a9d-34ee-4be3-9963-10db07587ff0\">\n<p>이쁜 UI</p>\n<img width=\"700\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/6fe883c9-4377-4c39-93a8-ea174db58eaa\">\n<p>Pipeline, Github, Gradle 같이 우리한테 필요한걸 잘 다운받는 모습입니다.</p>\n<h2>Jenkins Pipeline 추가</h2>\n<p>jenkins pipeline 구성 파일을 작성해 보겠습니다.</p>\n<p>간단하게</p>\n<ol>\n<li>jenkins 레포를 클론해오고</li>\n<li>hello를 찍은 뒤</li>\n<li>gradle로 프로젝트를 빌드하는 pipeline을 작성해 보겠습니다.</li>\n</ol>\n<pre class=\"grvsc-container default-dark\" data-language=\"groovy\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">node {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    stage(</span><span class=\"mtk8\">&#39;clone&#39;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">print</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;git clone start...!&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        git url: </span><span class=\"mtk8\">&quot;https://github.com/gusah009/jenkins-study.git&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk3\">// 깃헙 주소</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">print</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;git clone done...!&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t</span><span class=\"mtk4\">def</span><span class=\"mtk1\"> hello = </span><span class=\"mtk8\">&#39;Hello gusah&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk3\">// 변수 선언</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\tstage(</span><span class=\"mtk8\">&#39;print test&#39;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">print</span><span class=\"mtk1\">(hello) </span><span class=\"mtk3\">// 함수 및 변수 사용</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    stage (</span><span class=\"mtk8\">&#39;test build&#39;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        sh </span><span class=\"mtk8\">&quot;./gradlew build&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">print</span><span class=\"mtk1\">(</span><span class=\"mtk12\">message</span><span class=\"mtk1\">) { </span><span class=\"mtk3\">// 함수 선언</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    echo </span><span class=\"mtk8\">&quot;</span><span class=\"mtk4\">${</span><span class=\"mtk1\">message</span><span class=\"mtk4\">}</span><span class=\"mtk8\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>돌려보면..!</p>\n<img width=\"300\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/78df59f8-44c2-4656-85ea-23c1d7d393fa\">\n<p><em>박살…</em></p>\n<p>원인은 jenkins에서 git clone을 해 올 때 default 브랜치를 master로 잡아서였는데요,</p>\n<p>23년 현재 github 초기 default 브랜치는 master가 아니라 main이므로 main 브랜치로 수정해주면 됩니다.</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"groovy\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">git branch: </span><span class=\"mtk8\">&quot;main&quot;</span><span class=\"mtk1\">, url: </span><span class=\"mtk8\">&quot;https://github.com/gusah009/jenkins-study.git&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk3\">// 깃헙 주소</span></span></span></code></pre>\n<img width=\"300\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/99d79d58-01a3-44d4-9034-3545b00536df\">\n<p><code class=\"language-text\">clone</code>, <code class=\"language-text\">print test</code> 는 성공!</p>\n<p>이제 간단하게 자바 코드를 넣고 빌드해 봅시다.</p>\n<img width=\"300\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/7ab5e2cd-2673-4767-9277-b5da46271f92\">\n<p>빌드도 성공!</p>\n<h2>Jenkins 자동 배포 설정해보기</h2>\n<p>이제 github에서 코드가 올라오면 자동으로 배포하는 pipeline을 만들어보겠습니다.</p>\n<h3>Git, Gradle 적용</h3>\n<img width=\"400\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/7292078c-13e3-437f-84d3-eb592384c66c\">\n<img width=\"400\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/548bcf8a-3e68-47ed-975e-fcb561bc0521\">\n<p>위와 같이 플러그인이 제대로 깔려있다면 free-style Item을 새로 만들고 아래와 같이 설정을 해줍니다.</p>\n<p><img width=\"300\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/fca7305d-91ae-4b56-80d6-dfe60472177f\"> <img width=\"300\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/8907fd2d-8121-4004-8860-58ca3030bc55\"></p>\n<p><img width=\"300\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/cf06aefe-d4b2-4f6b-8bf0-b7f235d1e5b3\"> <img width=\"300\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/95419888-0003-48ad-8ad2-4f8d7aea1e79\"></p>\n<hr>\n<p><img src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/8bc6f319-eef3-4b86-85a9-067249f36163\" alt=\"image\"></p>\n<p>간단하게 커밋을 하나 올리고 다시 빌드해보면</p>\n<p><img src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/a7ac1a82-f61b-447d-a094-675e680d2961\" alt=\"image\"></p>\n<p>커밋된 내역을 가지고 와서 새로운 코드로 다시 빌드해주는걸 볼 수 있습니다.</p>\n<h3>주기적으로 업데이트된 내용을 확인해서 빌드하기</h3>\n<p>설정에서 poll SCM을 <code class=\"language-text\">* * * * *</code> 로 설정해주면 매분마다 깃을 확인하는데, 이 때 깃에 변경사항이 있다면 빌드를 쭉 진행해줍니다.</p>\n<h3>젠킨스로 서버 배포해보기</h3>\n<blockquote>\n<p>저는 오라클 프리티어 인스턴스에서 진행했습니다.</p>\n</blockquote>\n<p>먼저, 젠킨스에 아래와 같이 <code class=\"language-text\">Publish Over SSH</code> 플러그인을 설치해줍니다.</p>\n<img width=\"300\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/c9996d7d-a0d6-46f3-a37b-be15eec0be95\">\n<p>플러그인을 설치하면 Jenkins 관리 → 설정에 <strong>Publish Over SSH</strong> 란이 생겼을텐데, 아래처럼 ssh 연결을 위한 설정을 해줍니다.</p>\n<img width=\"400\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/da7cf7ac-426a-43ee-aa2a-78d66c1f62c8\">\n<p>그리고 <strong>“빌드 후 조치”</strong> 로 아래와 같이 적용해주면 원격 오라클 서버에서 spring이 실행됩니다/</p>\n<img width=\"400\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/023d6bd0-f374-4ade-94ac-e9150e76f7b5\">\n<p>로컬에서 오라클 서버의 8080포트로도 잘 접속이 되는걸 볼 수 있습니다.</p>\n<img width=\"400\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/df71395d-1d19-4857-88b1-7be07259fe13\">\n<p>하지만 프로세스가 작동중인 상태에서 위의 명령어로 또 배포를 한다면 어떻게 될까요?</p>\n<p>포트가 이미 사용중이라 다른 포트로 뜰 수도 있고, 프로세스가 아예 뜨지 않을 수도 있어서 이를 문제를 해결해 줘야 합니다.</p>\n<blockquote>\n<p>사실 java -jar로 애플리케이션을 띄우면 8080포트로 계속 listen 하고 있기 때문에 젠킨스 입장에선 ssh로 들어간 내 워커가 영원히 오라클 서버를 물고있는 상황이 됩니다.</p>\n<p>그래서 <strong>Publish Over SSH</strong>의 기본 timeout인 12초가 지나면 자연스럽게 연결이 끊기게 되고, 젠킨스 입장에선 timeout으로 빌드가 실패했다고 하지만 오라클 서버에는 애플리케이션이 잘 구동되고 있는 상황입니다.</p>\n</blockquote>\n<p>해결하는 방법은 3장에서 계속…</p>\n<h2>ref</h2>\n<p><a href=\"https://www.inflearn.com/course/%EC%A0%A0%ED%82%A8%EC%8A%A4-ci-cd-%ED%8C%8C%EC%9D%B4%ED%94%84%EB%9D%BC%EC%9D%B8/dashboard\" target=\"_blank\" rel=\"nofollow\">Jenkins를 이용한 CI/CD Pipeline 구축 - 인프런 | 강의</a></p>\n<p><a href=\"https://www.youtube.com/watch?v=GOLHN3FHjpI\" target=\"_blank\" rel=\"nofollow\">[토크ON세미나] Jenkins를 활용한 CI/CD 3강 - 젠킨스 CI/CD 파이프라인 구성 실습(1) | T아카데미</a></p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk3 { color: #6A9955; }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .mtk10 { color: #4EC9B0; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"title":"Jenkins를 이용한 CI/CD 파이프라인 구축 2","summary":"jenkins 시작하기","date":"2023.07.22.","categories":["jenkins"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAATABQDASIAAhEBAxEB/8QAGgABAQACAwAAAAAAAAAAAAAAAAgEBQYHCf/EABcBAQADAAAAAAAAAAAAAAAAAAcFBgj/2gAMAwEAAhADEAAAAeu6c0+GGsHh4stfpfitMiSAxwBne/8A/8QAGxAAAgMBAQEAAAAAAAAAAAAABQYDBAcCART/2gAIAQEAAQUCxjGFAoosaPkJoWZTSQ8lnTmu+K0JTP1K2dL3ZSdCTuQUIrV+0g/719n/xAAlEQACAgEEAQMFAAAAAAAAAAACAwEEBQYREhQiABMxFSEjJDP/2gAIAQMBAT8BtIio8qYoWA1rdocnUSUgzHrf5l1gWToDsrYQrEZjdcrkSYLImLGldIEyDvrzIXGKrtsxj6+Pt0ic2uphsrWfrVaHLdJe7BikA8/DkMQZaut2qmqcyNWzYrDcBPbGu5iRtb4VVuexCyGHb2oiz+Tl+xEO/p5eqeOx51wI6NM55NHcqySniDTAB3kPgAERGPgRGBj7RHr/xAAkEQACAQIFBQEBAAAAAAAAAAABAgMEBRESEyExABQiIzIkUf/aAAgBAgEBPwGVrrU3Gpnq5r+KlZs9ppqOGWWknVZEFMe4fLTlVGLtJJEUOlIJshXSaG63URoulESoynPrKwZdmUr274ZGxT6JwG+B2FriiltNEZY0kMTDSLormP8AbpessDk9Xr8cPDw+dunllDbSScKftuSoJPPJJxP9PX//xAAmEAACAgEEAgIBBQAAAAAAAAACAwEEBQYREhMUIQAiIxUxQUJR/9oACAEBAAY/Ak6w1Mi/YixZsXEVRtMCkdHHL6wsdVRfnnMvi9MKVY5NiADrP6jLNG49OLwtq8Fm2m9goTF2lcrpRt+ofcrtgSBwFYx9gTEVpZNjw7ApIrWOYKvIxzTx9nrP6d9IyrGUbxvENhQtHf8AqcT/AD8RpfUeTqYd9aZsV3zAU8e+tkWsyAqA+M1Kx132bCPDsSHKuKHK7Y58X3x1Ld1hQx1FdXSGlh8zIhgvqcZOxStOkMYpWTZE9mU4KiKxMFj7gQmBtZJVisg825+Yth4faMW7lh3aK5MlmIK6xRAkPL8UnO3PaMcwzIjOjTMymfZH1GrkX+lIJVEzPueETPvefmYtMQptgQyygc5YuNS6dihFcUSyC6OEWn79PCWc/wAnPgHFIQRwK6FEQETIYiCQLJ/aY33NhlMz73n5/8QAGRABAQEBAQEAAAAAAAAAAAAAAREAITFR/9oACAEBAAE/IXSN2cMeZEDtc+p+WxkbLY1kXlev6MuRCAsc0Mr8tgVUK3hVtw2imVE5jgMS8P8AffLMQqSAltazpm6N9m6orScSnEmSiFxF4jci0Cb7lyEtZA//2gAMAwEAAgADAAAAEPcXvf/EABgRAQEBAQEAAAAAAAAAAAAAAAERACFB/9oACAEDAQE/EHLWGmIxAJNKqABftEqlLMWZp7XSUhmFE2hyAEJAejBb2HhUEf/EABkRAQADAQEAAAAAAAAAAAAAAAEAESExYf/aAAgBAgEBPxDKam5FdjhYZdHEBTsHMqQ0BAMPY74QwNHbV6RTBCygtXVpBOorarP/xAAZEAEBAQEBAQAAAAAAAAAAAAABABExECH/2gAIAQEAAT8Qibrbq5WZ9IFc2p+3QQpTJXpSAeJyxkBfhG70guyaJ59dW1A0FCAXO7+wS0TTzn8tuyTAYgWxuoU4sOCtRBUn4ICsQKG4YsE+qH0in//Z"},"images":{"fallback":{"src":"/static/6a3b9dce28b4687f9f583de058b08be4/cad72/choonsik_jenkins.jpg","srcSet":"/static/6a3b9dce28b4687f9f583de058b08be4/263a2/choonsik_jenkins.jpg 264w,\n/static/6a3b9dce28b4687f9f583de058b08be4/ac426/choonsik_jenkins.jpg 529w,\n/static/6a3b9dce28b4687f9f583de058b08be4/cad72/choonsik_jenkins.jpg 1057w","sizes":"(min-width: 1057px) 1057px, 100vw"},"sources":[{"srcSet":"/static/6a3b9dce28b4687f9f583de058b08be4/c5924/choonsik_jenkins.webp 264w,\n/static/6a3b9dce28b4687f9f583de058b08be4/d0e04/choonsik_jenkins.webp 529w,\n/static/6a3b9dce28b4687f9f583de058b08be4/8470c/choonsik_jenkins.webp 1057w","type":"image/webp","sizes":"(min-width: 1057px) 1057px, 100vw"}]},"width":1057,"height":1016.0000000000001}},"publicURL":"/static/6a3b9dce28b4687f9f583de058b08be4/choonsik_jenkins.jpeg"}}}}]}},"pageContext":{"slug":"/cicd/jenkins/2023-07-23-Jenkins를 이용한 CICD 파이프라인 구축 2/"}},"staticQueryHashes":["2518467932","429584967"]}