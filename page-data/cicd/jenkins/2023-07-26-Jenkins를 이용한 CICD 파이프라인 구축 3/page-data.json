{"componentChunkName":"component---src-templates-post-template-tsx","path":"/cicd/jenkins/2023-07-26-Jenkins를 이용한 CICD 파이프라인 구축 3/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<blockquote>\n<p><strong>ansible docker 연동하기</strong></p>\n</blockquote>\n<p>이번엔 jenkins와 배포에 필요한 도구들인 ansible, docker를 연동하는 과정을 진행해 보겠습니다.</p>\n<h2>DevOps Tools</h2>\n<ol>\n<li>Kubernates</li>\n<li>docker</li>\n<li>lstio</li>\n<li>GitHub Actions</li>\n<li>Jenkins</li>\n<li>Prometheus</li>\n<li><strong>Ansible - 이번 강의에서 다룰 것~</strong></li>\n<li>Chef</li>\n</ol>\n<p>…</p>\n<h2>Ansible 기초</h2>\n<p><strong>IaC</strong>(Infrastructure as Code): 우리가 가지고 있는 코드로 인프라를 관리하는 방법</p>\n<ul>\n<li>시스템, 하드웨어, 인터페이스의 구성 정보를 파일(스크립트)로 관리하는 방법.</li>\n</ul>\n<p><strong>IaC를 사용하기 전:</strong> 특정 서버가 다운됐을 때 필요한 서버를 증설하고 사용중이던 서버를 중지시켜 야됨. (수동으로)</p>\n<p><strong>IaC 도입 후:</strong> ansible 서버가 각 서버들을 관리할 수 있도록 설정해두고 서버의 목록이나 서버 설정 파일을 가지고 있으면서 서버가 다운됐을 때 ansible이 자동으로 서버를 추가해줄 수 있음.</p>\n<p><strong>Ansible:</strong> 여러개의 서버를 효율적으로 관리할 수 있게 해주는 환경 구성 자동화 도구로 Push 기반임.</p>\n<p><strong>Ansible의 결과:</strong> <code class=\"language-text\">ok</code> / <code class=\"language-text\">fail</code> / <code class=\"language-text\">unreachable</code> / <code class=\"language-text\">changed</code></p>\n<h3>도커 설치</h3>\n<p>Ansible 서버를 로컬에 설치해 보겠습니다.</p>\n<p><code class=\"language-text\">docker pull edowon0623/ansible-server:m1</code></p>\n<pre class=\"grvsc-container default-dark\" data-language=\"bash\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">docker run --privileged \\</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  --name ansible-server -itd \\</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  -p 20022:22 -p 8081:8080 \\</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  -e container=docker \\</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\t-v /sys/fs/cgroup:/sys/fs/cgroup --cgroupns=host \\</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">\tedowon0623/ansible-server:m1 /usr/sbin/init</span></span></span></code></pre>\n<h3>ansible 서버와 오라클 서버 연결</h3>\n<p>ansible 도커 설치 후 ansible-server 도커 안에서 <code class=\"language-text\">vi /etc/ansible/hosts</code> 명령어로 아래와 같이 설정을 해줍니다.</p>\n<img width=\"400\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/7faa41c5-7f92-484e-b09c-52839236d2e0\">\n<p>빨간 네모 부분은 관리할 host의 도메인 주소(IP 주소)를 넣어주면 됩니다.</p>\n<h3>ansible 기본 명령어</h3>\n<img width=\"400\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/1cc69e15-b740-4633-81e0-9292794ca052\">\n<p>또 ansible은 멱등성이란 특징을 가지고 있는데, 어떤 동작을 몇 번을 하든 한 번만 적용되는 것을 의미함. (조금 다르지만…)</p>\n<img width=\"600\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/51d0b1d1-491d-4920-a8e1-73f5c22b9e1f\">\n<p>위와 같이 echo로 <code class=\"language-text\">/etc/ansible/hosts</code>에 mygroup을 추가하면 당연히 2번 들어가게 됩니다. 하지만 ansible로 같은 동작을 반복하면 1번만 들어간다는 사실..!</p>\n<blockquote>\n<p>ansible에서 멱등성을 유지하는 원리는 모듈 개발자가 직접 하나하나 멱등성을 지켜주도록 개발을 했기 때문입니다. 개인이 만든 모듈에서 멱등성을 지키지 않도록 개발이 되었다면 ansible을 이용하더라도 멱등성이 지켜지지 않을 수도 있습니다.</p>\n</blockquote>\n<h3>Ansible Module</h3>\n<p>ansible ↔ hosts 연결 확인</p>\n<p><code class=\"language-text\">ansible all -m ping</code> 명령어를 사용하면 내가 등록한 hosts 들에게 ansible이 잘 연결되는지 확인할 수 있습니다.</p>\n<img width=\"400\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/0ffe4125-6343-4d60-b374-2265004f76e2\">\n<p>그래서 위와 같이 host의 private_key를 주석처리하면 <strong>아래와 같이 실패하는 것</strong>을 볼 수 있습니다.</p>\n<img width=\"600\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/b2fd100b-658b-4063-8f1a-cfec95c24dcc\">\n<h3>Copy 해보기</h3>\n<p>Ansible 서버의 test.txt를 오라클 서버로 copy 해보겠습니다.</p>\n<p><code class=\"language-text\">ansible all -m copy -a \"src=./test.txt dest=/tmp”</code></p>\n<p>위 명령어를 이용하면 아래와 같이 test.txt가 원격 서버에 잘 복사된걸 볼 수 있습니다.</p>\n<img width=\"400\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/d6144dc8-d741-462e-8c25-7e7e42834f66\">\n<h2>Ansible Playbook</h2>\n<p><code class=\"language-text\">Ansible Playbook</code>은 매번 위와 같이 명령어를 칠 수 없으니 사용자가 원하는 내용을 미리 작성해 놓은 파일입니다.</p>\n<ul>\n<li>yaml 형식으로 작성됩니다.</li>\n</ul>\n<h3>파일 수정 실습</h3>\n<img width=\"300\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/4be83404-6b85-40a0-a09e-5f97f398c0b8\">\n<p>위와 같이 playbook을 작성하고 <code class=\"language-text\">ansible-playbook first-playbook.yml</code> 명령어로 실행해보겠습니다.</p>\n<img width=\"500\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/5f2924ff-052a-404d-b410-b29150e42cce\">\n<p>위와 같이 <strong><em>[mygroup]</em></strong> 이 추가된 것을 볼 수 있습니다.</p>\n<blockquote>\n<p>멱등성이 적용되기 때문에 한 번 더 <code class=\"language-text\">ansible-playbook first-playbook.yml</code> 명령을 수행해도 <strong><em>[mygroup]</em></strong> 은 한 번만 추가됩니다.</p>\n</blockquote>\n<h3>파일 COPY 실습</h3>\n<pre class=\"grvsc-container default-dark\" data-language=\"yaml\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">- </span><span class=\"mtk4\">name</span><span class=\"mtk1\">: </span><span class=\"mtk8\">Ansible Copy Example Local to Remote</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">hosts</span><span class=\"mtk1\">: </span><span class=\"mtk8\">devops</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">tasks</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    - </span><span class=\"mtk4\">name</span><span class=\"mtk1\">: </span><span class=\"mtk8\">copying file with playbook</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">copy</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">src</span><span class=\"mtk1\">: </span><span class=\"mtk8\">~/sample.txt</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">dest</span><span class=\"mtk1\">: </span><span class=\"mtk8\">/tmp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">owner</span><span class=\"mtk1\">: </span><span class=\"mtk8\">opc</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">mode</span><span class=\"mtk1\">: </span><span class=\"mtk7\">0644</span></span></span></code></pre>\n<p>ansible 서버의 파일들을 devops hosts로 전달하는 실습을 진행해보겠습니다.</p>\n<p>아래와 같이 <code class=\"language-text\">sample.txt</code> 파일이 잘 전달된 것을 볼 수 있습니다.</p>\n<img width=\"400\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/39e5de93-98ff-4504-ba82-b2e366442cd7\">\n<h3>Ansible 서버 Jenkins 연동</h3>\n<!-- [Jenkins를 이용한 CI/CD 파이프라인 구축 - 2장](https://www.notion.so/Jenkins-CI-CD-2-b2deac90df8743bfb3132ae1a5f0befa?pvs=21) 에서 나온 **Publish Over SSH**를 이용해 Ansible 서버도 설정을 해줍니다. -->\n<h3>Ansible Playbook으로 Ansible 서버에서 오라클 서버로 jar 배포하기</h3>\n<p>아래와 같이 ansible Playbook을 작성해주면 끝!</p>\n<blockquote>\n<p><em>강의와 다르게 환경을 구성해서 많이 고생했네요… ㅠㅠ</em></p>\n</blockquote>\n<img width=\"600\" alt=\"image\" src=\"https://github.com/KEEPER31337/Homepage-Back-R2/assets/26597702/6e0f0545-096f-420b-bd6a-697a94304bf4\">\n<ol>\n<li>8080 포트에 떠있는 프로세스를 죽인다 (jar)</li>\n<li>원래 있던 jar 파일을 삭제한다.</li>\n<li>새로운 jar 파일로 복사한다.</li>\n<li>백그라운드로 jar를 띄운다.</li>\n</ol>\n<p>다음 장에선 k8s에 연동해보는 과정을 가져보겠습니다!</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk7 { color: #B5CEA8; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"title":"Jenkins를 이용한 CI/CD 파이프라인 구축 3","summary":"ansible docker 연동하기","date":"2023.07.26.","categories":["jenkins"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAATABQDASIAAhEBAxEB/8QAGgABAQACAwAAAAAAAAAAAAAAAAgEBQYHCf/EABcBAQADAAAAAAAAAAAAAAAAAAcFBgj/2gAMAwEAAhADEAAAAeu6c0+GGsHh4stfpfitMiSAxwBne/8A/8QAGxAAAgMBAQEAAAAAAAAAAAAABQYDBAcCART/2gAIAQEAAQUCxjGFAoosaPkJoWZTSQ8lnTmu+K0JTP1K2dL3ZSdCTuQUIrV+0g/719n/xAAlEQACAgEEAQMFAAAAAAAAAAACAwEEBQYREhQiABMxFSEjJDP/2gAIAQMBAT8BtIio8qYoWA1rdocnUSUgzHrf5l1gWToDsrYQrEZjdcrkSYLImLGldIEyDvrzIXGKrtsxj6+Pt0ic2uphsrWfrVaHLdJe7BikA8/DkMQZaut2qmqcyNWzYrDcBPbGu5iRtb4VVuexCyGHb2oiz+Tl+xEO/p5eqeOx51wI6NM55NHcqySniDTAB3kPgAERGPgRGBj7RHr/xAAkEQACAQIFBQEBAAAAAAAAAAABAgMEBRESEyExABQiIzIkUf/aAAgBAgEBPwGVrrU3Gpnq5r+KlZs9ppqOGWWknVZEFMe4fLTlVGLtJJEUOlIJshXSaG63URoulESoynPrKwZdmUr274ZGxT6JwG+B2FriiltNEZY0kMTDSLormP8AbpessDk9Xr8cPDw+dunllDbSScKftuSoJPPJJxP9PX//xAAmEAACAgEEAgIBBQAAAAAAAAACAwEEBQYREhMUIQAiIxUxQUJR/9oACAEBAAY/Ak6w1Mi/YixZsXEVRtMCkdHHL6wsdVRfnnMvi9MKVY5NiADrP6jLNG49OLwtq8Fm2m9goTF2lcrpRt+ofcrtgSBwFYx9gTEVpZNjw7ApIrWOYKvIxzTx9nrP6d9IyrGUbxvENhQtHf8AqcT/AD8RpfUeTqYd9aZsV3zAU8e+tkWsyAqA+M1Kx132bCPDsSHKuKHK7Y58X3x1Ld1hQx1FdXSGlh8zIhgvqcZOxStOkMYpWTZE9mU4KiKxMFj7gQmBtZJVisg825+Yth4faMW7lh3aK5MlmIK6xRAkPL8UnO3PaMcwzIjOjTMymfZH1GrkX+lIJVEzPueETPvefmYtMQptgQyygc5YuNS6dihFcUSyC6OEWn79PCWc/wAnPgHFIQRwK6FEQETIYiCQLJ/aY33NhlMz73n5/8QAGRABAQEBAQEAAAAAAAAAAAAAAREAITFR/9oACAEBAAE/IXSN2cMeZEDtc+p+WxkbLY1kXlev6MuRCAsc0Mr8tgVUK3hVtw2imVE5jgMS8P8AffLMQqSAltazpm6N9m6orScSnEmSiFxF4jci0Cb7lyEtZA//2gAMAwEAAgADAAAAEPcXvf/EABgRAQEBAQEAAAAAAAAAAAAAAAERACFB/9oACAEDAQE/EHLWGmIxAJNKqABftEqlLMWZp7XSUhmFE2hyAEJAejBb2HhUEf/EABkRAQADAQEAAAAAAAAAAAAAAAEAESExYf/aAAgBAgEBPxDKam5FdjhYZdHEBTsHMqQ0BAMPY74QwNHbV6RTBCygtXVpBOorarP/xAAZEAEBAQEBAQAAAAAAAAAAAAABABExECH/2gAIAQEAAT8Qibrbq5WZ9IFc2p+3QQpTJXpSAeJyxkBfhG70guyaJ59dW1A0FCAXO7+wS0TTzn8tuyTAYgWxuoU4sOCtRBUn4ICsQKG4YsE+qH0in//Z"},"images":{"fallback":{"src":"/static/6a3b9dce28b4687f9f583de058b08be4/cad72/choonsik_jenkins.jpg","srcSet":"/static/6a3b9dce28b4687f9f583de058b08be4/263a2/choonsik_jenkins.jpg 264w,\n/static/6a3b9dce28b4687f9f583de058b08be4/ac426/choonsik_jenkins.jpg 529w,\n/static/6a3b9dce28b4687f9f583de058b08be4/cad72/choonsik_jenkins.jpg 1057w","sizes":"(min-width: 1057px) 1057px, 100vw"},"sources":[{"srcSet":"/static/6a3b9dce28b4687f9f583de058b08be4/c5924/choonsik_jenkins.webp 264w,\n/static/6a3b9dce28b4687f9f583de058b08be4/d0e04/choonsik_jenkins.webp 529w,\n/static/6a3b9dce28b4687f9f583de058b08be4/8470c/choonsik_jenkins.webp 1057w","type":"image/webp","sizes":"(min-width: 1057px) 1057px, 100vw"}]},"width":1057,"height":1016.0000000000001}},"publicURL":"/static/6a3b9dce28b4687f9f583de058b08be4/choonsik_jenkins.jpeg"}}}}]}},"pageContext":{"slug":"/cicd/jenkins/2023-07-26-Jenkins를 이용한 CICD 파이프라인 구축 3/"}},"staticQueryHashes":["2518467932","429584967"]}