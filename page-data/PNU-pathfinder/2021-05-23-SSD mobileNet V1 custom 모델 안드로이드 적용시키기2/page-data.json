{"componentChunkName":"component---src-templates-post-template-tsx","path":"/PNU-pathfinder/2021-05-23-SSD mobileNet V1 custom 모델 안드로이드 적용시키기2/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p><img src=\"https://images.velog.io/images/gusah009/post/c71f513b-d1c2-416e-9b05-f7570d91ea94/100000_train.png\" alt=\"\"></p>\n<h2>ckpt -> pb 파일로 변환</h2>\n<p>학습이 끝나면 train폴더에 ckpt파일들이 생깁니다.\n해당 파일중 가장 마지막 checkpoint파일을 pb파일로 변환해야합니다.\n아래 명령어에서 model.ckpt- 뒤의 숫자는 본인 파일의 숫자를 작성하시면 됩니다.\n이제 명령어를 실행시키시면 exported_model 폴더에 pb파일이 생성됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">python object_detection/export_tflite_ssd_graph.py  <span class=\"token parameter variable\">--pipeline_config_path</span><span class=\"token operator\">=</span>ssd_mobilenet_v1_coco.config  <span class=\"token parameter variable\">--trained_checkpoint_prefix</span><span class=\"token operator\">=</span>train/model.ckpt-103512 <span class=\"token parameter variable\">--output_directory</span> exported_model</code></pre></div>\n<h2>pb -> tflite 파일로 변환</h2>\n<p>생성된 pb파일을 이제 android프로젝트에 맞게 경량화 시켜야 합니다.\nexported_model의 파일을 tflite 파일로 변환시켜 주겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">tflite_convert <span class=\"token parameter variable\">--input_shape</span><span class=\"token operator\">=</span><span class=\"token number\">1,300</span>,300,3 <span class=\"token parameter variable\">--input_arrays</span><span class=\"token operator\">=</span>normalized_input_image_tensor <span class=\"token parameter variable\">--output_arrays</span><span class=\"token operator\">=</span>TFLite_Detection_PostProcess,TFLite_Detection_PostProcess:1,TFLite_Detection_PostProcess:2,TFLite_Detection_PostProcess:3 <span class=\"token parameter variable\">--allow_custom_ops</span> <span class=\"token parameter variable\">--graph_def_file</span><span class=\"token operator\">=</span>exported_model/tflite_graph.pb <span class=\"token parameter variable\">--output_file</span><span class=\"token operator\">=</span>detect.tflite</code></pre></div>\n<h3>삽질…</h3>\n<p>명령어를 실행시키고 나면 저희의 작업폴더인 models 폴더에 detect.tflite 파일이 생성되어있습니다. 해당파일을 바로넣으면 오류가 나면서 안되고, metadata라는 것을 추가해주어야 합니다.</p>\n<blockquote>\n<p>해당 오류때문에 며칠을 고생했던 기억이 있습니다.. ㅠㅜ</p>\n</blockquote>\n<p>실제 공식문서에서 빠진 부분입니다.</p>\n<h2>meta 데이터 추가</h2>\n<h3>label.txt 파일 추가</h3>\n<p>metadata를 추가하기 앞서서 label.txt 파일을 생성하겠습니다.\nlabel.txt 위치는 models 폴더에 위치하고, 양식은 1번이 dog, 2번이 cat, 3번이 snake라면</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dog\ncat\nsnake</code></pre></div>\n<p>형식으로 넣어주시기만 하면 됩니다.</p>\n<h3>metadata 추가하기</h3>\n<p>아래 python코드를 이용해 detect.tflite 파일에 metadata를 추가해주시면 됩니다.\n실제로 바꼈다는 내용이 있진 않고 파일 내부적으로 변경됩니다.\n저는 models폴더에 python파일로 만들어서 실행시켰습니다.</p>\n<h2>Android 프로젝트에 추가하기</h2>\n<p><a href=\"https://github.com/tensorflow/examples\" target=\"_blank\" rel=\"nofollow\">https://github.com/tensorflow/examples</a>\n위 프로젝트를 git clone 받고 해당 프로젝트의 <code class=\"language-text\">lite/examples/object_detection/android/src/main/assests</code> 폴더안에 있는 <code class=\"language-text\">detect.tflite</code>파일을 저희가 학습한 <code class=\"language-text\">detect.tflite</code>파일로 바꿔줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> clone <span class=\"token string\">\"https://github.com/tensorflow/examples\"</span></code></pre></div>\n<p>추가로  <code class=\"language-text\">lite/examples/object_detection/android/src/main/java/org/tensorflow</code>\n<code class=\"language-text\">/lite/examples/detection/DetectorActivity.java</code> 파일 안에 <code class=\"language-text\">TF_OD_API_IS_QUANTIZED = false</code>로 바꿔주시면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> <span class=\"token constant\">TF_OD_API_IS_QUANTIZED</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>마무리</h2>\n<p>학습된 과정을 tensorboard로 보고싶다면 models 폴더에서 아래 명령어를 실행시켜줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">tensorboard <span class=\"token parameter variable\">--logdir</span><span class=\"token operator\">=</span>train</code></pre></div>\n<p><img src=\"https://images.velog.io/images/gusah009/post/355ed039-2ebc-4578-9bf2-d682cb81a259/%EC%86%90%EC%8B%A4%EA%B0%92.png\" alt=\"\"><img src=\"https://images.velog.io/images/gusah009/post/8fd818fe-c87f-4926-a79f-5c8014e0b2cb/100000_eval.png\" alt=\"\"></p>\n<blockquote>\n<p>모든 학습이 끝나고 직접 건물인식을 시켜봤는데, 하늘을보고 건물이라하는 경우가 허다했고 정확히 학습한부분만 인식하는 경우가 많았습니다. 오히려 10만번 학습시킨 ckpt보다 4~6만번이 더 실제로 느끼기에 정확도가 좋았던 것 같습니다.</p>\n</blockquote>\n<p>이상 <strong>SSD mobilenet v1 custom dataset android 적용시키기</strong> 글을 마치겠습니다.</p>","frontmatter":{"title":"SSD mobileNet V1 custom 모델 안드로이드 적용시키기 (2/2)","summary":"학습이 끝나면 train폴더에 ckpt파일들이 생깁니다. 해당 파일중 가장 마지막 checkpoint파일을 pb파일로 변환해야합니다. 아래 명령어에서 model.ckpt- 뒤의 숫자는 본인 파일의 숫자를 작성하시면 됩니다.","date":"2021.05.17.","categories":["pathfinder"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACqElEQVQozwXB6U9SAQAA8PcvOV1f2sr1oVJhLg6HBkIcgsCDd/jgCcSlgIACj0tu5JgYcnjgQW2SklYum80cVjjTaaJSbnasT63fD3i7f/Fq/+fGx1+V3esX765Wty+X3zQWXzfmN8/nqmeF6ll+/Sy3fprf+FaoNopbV8XNq8Xtm5nKQSKTBozONGIpPI3XRvO/VZkbeaQh8p9wiEOmo86wfaaPHdAsBxTzJ9pYnW4/6XWdc3yX0vQ/6sjsTO4ZIAJVPJGKxgJFuFsT3NbHd7HgHjbVgCa/SrzHAu8Rz3PE9x4L/KeiUEMaa6KZv9LgzoDFlijMAzJoovsBuaubSWOCjH5QgplRfRSOfGEXLvjZJpT8AU59l0QvwXhTlrxWZv9g0Q9iLXans31ApgDs1lBXJ4UnUjM4MJncg4JyLks6nMKFKxqS3Qc7FtTEc0N4cySwZkvvemffu9yuWJBwOZyRcAyQCMXtd+8JhAoSuaetpYXd24diBithsejkiIwhh8SQRJhJxQMeS6lYOKnXjuu1l6ul7HR8qVQElEoDAg5hqMZosCUDk8loxON2GfU6Ho81wOMPQciYyeRxuCJO0GcXLM0V1srlna3qYW2v2TgFUqmF6fRMNOyxGFFUxuJzqdRHDxl0CpfNtZmtdovZabN6HI6U3+nWd2mh1gChjYfCATdRKuQBHruDQmol3W8jddzroVH5bAEshlEQQuSwj3AbtepkLDadnBof0ZWzk1r5bfXgrXjItTC3tLFWAbgcNp3GeMxgPmH1IxKZTmEw4kadwqhEcQ0+TDgmYuGI2+HU4vh8gtgq51ZzyepyqpgOrpTKgEgo5LH6oEGREkYUMKqEcRxRqTDdqM5s0OgjkWjIHzQZTMOYSoshKbc2NG5KEKP56ERlJfcf6xBw5+cGgPEAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/ea88ad243301f7fdbf60ca8f00e93bef/a3fb2/pathfinder_100000_eval.png","srcSet":"/static/ea88ad243301f7fdbf60ca8f00e93bef/110ea/pathfinder_100000_eval.png 387w,\n/static/ea88ad243301f7fdbf60ca8f00e93bef/97fa0/pathfinder_100000_eval.png 774w,\n/static/ea88ad243301f7fdbf60ca8f00e93bef/a3fb2/pathfinder_100000_eval.png 1547w","sizes":"(min-width: 1547px) 1547px, 100vw"},"sources":[{"srcSet":"/static/ea88ad243301f7fdbf60ca8f00e93bef/14e34/pathfinder_100000_eval.webp 387w,\n/static/ea88ad243301f7fdbf60ca8f00e93bef/7cc6c/pathfinder_100000_eval.webp 774w,\n/static/ea88ad243301f7fdbf60ca8f00e93bef/bdde4/pathfinder_100000_eval.webp 1547w","type":"image/webp","sizes":"(min-width: 1547px) 1547px, 100vw"}]},"width":1547,"height":885}},"publicURL":"/static/ea88ad243301f7fdbf60ca8f00e93bef/pathfinder_100000_eval.png"}}}}]}},"pageContext":{"slug":"/PNU-pathfinder/2021-05-23-SSD mobileNet V1 custom 모델 안드로이드 적용시키기2/"}},"staticQueryHashes":[]}