{"componentChunkName":"component---src-templates-post-template-tsx","path":"/etc/2024-08-15-op-based CRDT/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p>지금까지 본 상태 기반 CRDT는 자신의 값 전체를 전달하는 방식으로 데이터 일관성을 맞춰왔습니다.</p>\n<p>하지만 operation-based CRDT, 즉 작업 기반 CRDT는 변경사항을 전달하는 방식으로 동작합니다.</p>\n<p>상태 기반과 작업 기반의 가장 큰 차이를 아래에서 보겠습니다.</p>\n<p><img src=\"op_based/Untitled.png\" alt=\"Untitled\"></p>\n<h3>인과관계 문제</h3>\n<p>상태 기반은 자신의 전체 상태를 보내기 때문에 순서가 뒤바뀌어도 큰 문제가 없습니다.</p>\n<p>하지만 전달해야 할 메시지가 많아질수록 모든 상태를 보내야 해서 비효율적이게 됩니다.</p>\n<p>operation 방식은 순서가 뒤바뀌면 큰 문제가 될 수 있습니다.</p>\n<p>위의 예시에선 메시지를 받은 순서대로 데이터를 쓴다면 B 입장에선 C가 미래를 예지하고 먼저 대답을 한 것 처럼 보일 것 입니다.</p>\n<p>이를 해결하기 위해 각 명령에 순서를 넣는데, 이는 보통 Logical Clock으로 해결합니다.</p>\n<h3>유실 문제</h3>\n<p>여기서 끝이 아니라, 또 다른 문제가 있습니다.</p>\n<p>상태 기반 CRDT는 중간에 유실이 되는게 큰 문제가 되진 않습니다. 받은 것 중 가장 최신의 데이터로 덮어쓰면 되기 때문입니다.</p>\n<p>그런데 작업 기반 CRDT는 모든 작업을 “반드시” 받아야 합니다. 작업을 모두 받아야 데이터가 완성되기 때문인데요,</p>\n<p><img src=\"op_based/Untitled1.png\" alt=\"Untitled\"></p>\n<p>이 때 만약 A가 영구적으로 네트워크가 끊겼다면 어떻게 될까요? B는 영원히 기다려야 할까요?</p>\n<p>이를 해결하기 위해 다른 노드가 이벤트를 복제해주는 것도 허용하는 방식이 있습니다.</p>\n<h3>A의 이벤트를 꼭 A에게 받을 필요는 없다</h3>\n<p>특정 노드에서 일어난 이벤트를 다른 노드가 복제해주는 이 컨셉은 중복이 아주 많이 발생하는 문제가 있긴 합니다.</p>\n<p>N개의 노드가 있다면 이벤트 하나가 발생했을 때 (N - 1)^2 만큼 네트워크로 메시지가 날아가게 되는데요,</p>\n<p><img src=\"op_based/graphviz.png\" alt=\"graphviz.png\"></p>\n<p>이렇게 중복이 많아지는 문제를 해결하기 위해 pull-based model이 채택되었습니다.</p>\n<p>이것만으론 충분하지 않아서 pull을 할 때 본인의 타임스탬프를 보내는 방식도 함께 채택되었습니다.</p>\n<p>이 방식을 이용하면 모든 변경사항이 아니라, 본인이 알고 있는 이벤트 다음부터 얻을 수 있다.</p>\n<p><img src=\"op_based/Untitled2.png\" alt=\"Untitled\"></p>\n<p>출처: <a href=\"https://www.bartoszsypytkowski.com/content/images/2020/08/rcb-sequence-diagram-2.png\" target=\"_blank\" rel=\"nofollow\">https://www.bartoszsypytkowski.com/content/images/2020/08/rcb-sequence-diagram-2.png</a></p>\n<h2>참고</h2>\n<p><a href=\"https://www.bartoszsypytkowski.com/operation-based-crdts-protocol/\" target=\"_blank\" rel=\"nofollow\">Operation based CRDTs: protocol</a></p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","frontmatter":{"title":"op based CRDT","summary":"operation based CRDT에 대해 알아보자","date":"2024.08.15.","categories":["crdt","yorkie"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADo0lEQVQ4y32VSUhjSRjHnwlR8KKieDFRjEt7iBBB8WBcIuTixYgwguIyohiVzMGTuAyMKIiKgwOKuA4yJ22U9mArgsuACw2Sw4yKIigyDCIqYzbNe6/q33xFIrYdp6Dyqr6q+tW31RdJURTp5uYmBoAVgB1AHQAngJ8B/AbgDwCfAXwBcAHgPwAygF2Px5MPQHK5XBJjTEtjSVVVC4B/FUXB3d0dLi8v4XK5sL29jeXlZczMzGBoaAidnZ1ob29HbW0tKisr+crKCoLtF0mSIhhjEgAt/Zyvr6/DYDCo6enpjL6ZmZmy2WyWCwoKFJvNptjtdrWmpoY5nU42MDDA6YKsrCyluroaXq+XoF/cbrdZaEizhoYGVZIkPjU1xQGEOt6M8VbW2NjI09LS5N3dXbGgqmo1AdW2tjYQMDIykvf29mJnZweLi4vC3JGREZDM6XSivr4eFRUVKC0thdVq5Varlc5RV2ZnZ4npIyBraWkRQI1GIzbExMQgNTUVGRkZMJlMyM3NJYCA1dXVCXh3dzcGBwfJlzwnJ4fWGRG/ARIsMTERV1dX4Pytpe823tHRIbSl8XfAlJQUUMQZY5ibm8Po6Ch6enpwcnIiTp+dnaG8vBx5eXkYGxsTMofD8T5Qr9fD5/Ph6emJghXyEQoLC19UohSKj4/H4+OjmLe2tiII/N7k5OTkl41HR0fQarXQ6XQC2t/fL+TT09MwGo2QZVnMKajvAg0GA9xut1hcW1tDbGysiC6tUdDIvwsLC8KS5+fn8ECHwxEWuLm5KbQ7Pz+HzWYT0LKyMkxMTIgsILeEA6r/B4yIiMD19TVOT08RSiuCZWdnC1+H1bC5uZkHnc9fA7e2thAVFYWLiwsx7+vrewkS5aff7w8LvBwfH6dNLKghDwVldXVVHKYvNUql/Px8IUtKSgq9Y0obvE4bp6qqKC4uVkhDo9HIfT4f93g84uaioiI0NTXh4eFBHKZqRK+F/PheYlP/eHt7SxGVExISwhYFejl0id/vJws4+XV/f5/v7e1xs9nMX57e/f29ND8/Hw3gr8PDQzJHLikpgd1u5xaLhZtMJq7X61lcXJwaHR1NVUkJdlmj0cg6nY5k6uTkJPH8VGC1gUCAqvYHAJ6NjQ1YLBZGaVJVVSX809XVheHhYZHQS0tLoD0HBwc4Pj4WGRD0uQLgR2Ey51xAvV5vHoC/X9U9yot/SHsAfwL4BOB3AL8G/yJ+IgiAHwKBQAYV2K+VHz2VfZz9JAAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/73d79c4eb6f00426e49f551564b50291/1689d/notion-icon.png","srcSet":"/static/73d79c4eb6f00426e49f551564b50291/8a20a/notion-icon.png 512w,\n/static/73d79c4eb6f00426e49f551564b50291/34104/notion-icon.png 1024w,\n/static/73d79c4eb6f00426e49f551564b50291/1689d/notion-icon.png 2048w","sizes":"(min-width: 2048px) 2048px, 100vw"},"sources":[{"srcSet":"/static/73d79c4eb6f00426e49f551564b50291/3591c/notion-icon.webp 512w,\n/static/73d79c4eb6f00426e49f551564b50291/e306d/notion-icon.webp 1024w,\n/static/73d79c4eb6f00426e49f551564b50291/035dc/notion-icon.webp 2048w","type":"image/webp","sizes":"(min-width: 2048px) 2048px, 100vw"}]},"width":2048,"height":2048}},"publicURL":"/static/73d79c4eb6f00426e49f551564b50291/notion-icon.png"}}}}]}},"pageContext":{"slug":"/etc/2024-08-15-op-based CRDT/"}},"staticQueryHashes":["2518467932","429584967"]}