{"componentChunkName":"component---src-templates-post-template-tsx","path":"/etc/2024-06-16-CRDT 기초/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p>오늘은 Google Docs나 Notion, Figma에서 사용하는 동시 편집 기술에 대해 알아보겠습니다.</p>\n<p>동시 편집 기술은 말 그대로 원격의 사람들이 같은 공간에서 동시에 편집할 수 있도록 해주는 기술입니다.</p>\n<p>동시 편집 기술에 사용되는 알고리즘은 대표적으로 <strong>CRDT</strong>(Conflict-Free-Replicated Data Types)와 <strong>OT</strong>(Operational Transformation)가 있습니다.</p>\n<h2>OT</h2>\n<p>먼저 OT 방식에 대해 알아보겠습니다.</p>\n<p>OT 방식은 1989년~2006년 구시대에 사용된 알고리즘인데, 이 방식을 한 줄로 요약하면 <strong>“서버가 병합을 수행”</strong> 하는 알고리즘이라 할 수 있습니다.</p>\n<h3>예시</h3>\n<p>문자의 상태가 <code class=\"language-text\">HELO</code> 라고 해보겠습니다. 여기서</p>\n<p>A가 3번째 인덱스에 <code class=\"language-text\">L</code>을 입력과 동시에,</p>\n<p>B가 4번째 인덱스에 <code class=\"language-text\">!</code>를 입력했다고 가정하겠습니다.</p>\n<ul>\n<li><strong>원하는 목표: <code class=\"language-text\">HELLO!</code></strong></li>\n</ul>\n<p>그런데 서버에서 요청을 받기를 아래 순서로 받는다면 어떻게 될까요?</p>\n<ol>\n<li><code class=\"language-text\">HELO</code></li>\n<li><code class=\"language-text\">HELLO</code> (A 사용자 입력)</li>\n<li><code class=\"language-text\">HELL!O</code> (B 사용자 입력)</li>\n</ol>\n<p>이런 문제를 해결하기 위해선 B 사용자가 느낌표를 어디에 넣으려고 했는지 추측해서 <strong>3번째 동작에 수정</strong>을 줘야합니다.</p>\n<p>OT를 수행하는 서버는 위 2번째 동작에서 문자열이 변경된걸 파악하고 B가 느낌표를 입력하려 했던 곳은 4번째 인덱스가 아니라 5번째 인덱스라고 추측합니다. 그리고 B가 보낸 입력을 변경해줘야 합니다.</p>\n<blockquote>\n<p>여기서 변경해주는걸 transformation이라고 한다.</p>\n</blockquote>\n<h3>단점</h3>\n<p>OT 방식은 <strong>서버가 반드시 transformation 해줘야 하는 방식</strong>으로 인해, P2P로 각각의 유저가 직접 연동하는 방식은 사용할 수 없다는 단점이 있습니다.</p>\n<p>서버에서 모든 충돌을 해결해야 하기 때문에 사람이 몰릴 때 서버에 과부하가 올 수 밖에 없습니다.</p>\n<h2>CRDT(Conflict-Free-Replicated Data Types)</h2>\n<p>CRDT는 이런 OT 방식의 문제를 해결하고자 나왔습니다.</p>\n<p>중앙집중식 서버가 필요없고, 어떤 네트워크, 어떤 통신을 선택하던지 제한이 없도록 설계되었습니다. 그래서 협업 애플리케이션 뿐만 아니라 Redis Enterprise 같은 DC 간에 지역적으로 떨어져서 운영하는 DB 시스템에도 활용되고 있습니다.</p>\n<p>CRDT를 한 줄로 요약하면 <strong>“P2P 방식에, 교환법칙, (결합법칙)이 성립하는”</strong> 알고리즘이라 할 수 있는데요,</p>\n<p>OT 방식은 위에서 봤듯이 이전 동작에 따라 다음 동작이 transformation 되기 때문에 앞 동작이 뒷 동작에 영향을 미치므로 <strong>교환 법칙이 성립할 수 없습니다.</strong></p>\n<p>CRDT는 교환법칙이 성립하는데, 각 동작의 순서와 상관없이 변경 사항만 같으면 같은 상태로 봅니다.</p>\n<h3>OT의 문제점 해결</h3>\n<p>OT 방식에서 문제점은 각 글자에 인덱스를 부여했다는 점입니다.</p>\n<p>OT 방식은 배열 형식의 인덱스를 사용하면 인덱스가 변한다는 점이 문제였는데, CRDT는 이를 해결하기 위해 각 개체를 유니크한 값으로 간주합니다.</p>\n<p>아까 봤던 예시를 CRDT 버전으로 다시 보겠습니다.</p>\n<p>편의를 위해 원래 예시의 인덱스를 사용했습니다.</p>\n<ol>\n<li>\n<p><code class=\"language-text\">HELO</code></p>\n<table>\n<thead>\n<tr>\n<th>H</th>\n<th>E</th>\n<th>L</th>\n<th>O</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td>1</td>\n<td>2</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>\n<p><code class=\"language-text\">HELLO</code> (A 사용자 입력)</p>\n<table>\n<thead>\n<tr>\n<th>H</th>\n<th>E</th>\n<th>L</th>\n<th>L</th>\n<th>O</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td>1</td>\n<td>2</td>\n<td>2.1234 (2와 3 사이의 난수)</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>\n<p><code class=\"language-text\">HELLO!</code> (B 사용자 입력)</p>\n<table>\n<thead>\n<tr>\n<th>H</th>\n<th>E</th>\n<th>L</th>\n<th>L</th>\n<th>O</th>\n<th>!</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td>1</td>\n<td>2</td>\n<td>2.1234</td>\n<td>3</td>\n<td>3.5678 (3보다 큰 난수)</td>\n</tr>\n</tbody>\n</table>\n</li>\n</ol>\n<p>OT 방식과 다르게 기존에 존재하던 글자들의 인덱스는 변하지 않기 때문에 어떤 순서로 변경사항이 들어와도 상관이 없습니다.</p>\n<h3>CRDT 문제점</h3>\n<p>이런 CRDT도 문제가 하나 있는데, 같은 위치에 데이터를 삽입했을 때 merge하는 과정입니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7ba3507f652ce6c280f561af956e73d7/1263b/crdt1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.4375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXUlEQVQoz61S2ZLjIAzM///jJOM4gIXFYWxjLuGtslMkOzP7NNsPFCUJtejWZX9DrXX/B35MXfZf4HJ2PRtP0xRj/JHNOee9/xJ8Meec+76XUp7p1nHf95QSYw9EJKKvzCEE7/26rpzzeZ4bbSslIq2NECKEsCzLtm3Px1rrvu/v97uUIOUYU065xliIqNZaSo0xE+3eh4+PK+e86zrGmLU2pXRps2mtOedCcOccEW1bdi7ERDFGgIExBgBn6jU2EZ1isAOIel19SiWEEkKOkbaQjLGI+na7KaWcc6WU52NE7LoOAKSUw4DTlI9P1ibseUf01+unHCXjHBGnaXqNLaVUSgHAMAjEcVmWJphSCnEEACHEOI7zPDcjnj4bY5RS1lo8sK4rEZVSaq3WWqXUWYCIy7L8ZZUxhjGmlBpgEAcYY4/HAwDaKYQAAH7gZdVv1/N9H9/RNPse/w/MfwB/h2gYGV/yqAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7ba3507f652ce6c280f561af956e73d7/a59e9/crdt1.webp 192w,\n/static/7ba3507f652ce6c280f561af956e73d7/0ca9f/crdt1.webp 384w,\n/static/7ba3507f652ce6c280f561af956e73d7/dc9b9/crdt1.webp 768w,\n/static/7ba3507f652ce6c280f561af956e73d7/80c60/crdt1.webp 1000w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7ba3507f652ce6c280f561af956e73d7/3b721/crdt1.png 192w,\n/static/7ba3507f652ce6c280f561af956e73d7/66595/crdt1.png 384w,\n/static/7ba3507f652ce6c280f561af956e73d7/fe486/crdt1.png 768w,\n/static/7ba3507f652ce6c280f561af956e73d7/1263b/crdt1.png 1000w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7ba3507f652ce6c280f561af956e73d7/fe486/crdt1.png\"\n            alt=\"image1.png\"\n            title=\"image1.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9c47acfd4def718aade0476d25e25656/1263b/crdt2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.39583333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSUlEQVQoz61SYW/rIAzs//+DU0PWTt1aMISW2AQCDmQiXaft6X2YtJ0s5PtwnM72bv0Fdn8prrUyL845RHTOjRuYl/+L6wPrWueZY8zMix0sAFhrtdbX6zVnTolrXb9WEyulAGB7leyeYd/pXphegBDudvs0WZZSSv3XOYRARNM0ee8JkRDvnbvdEDGlzNxsEZMxMUb2PofAIeSc8+574JWXj+/Jk1RSSgkgTycQArru0nXyURetTctcNtRalqVMU75TZg4hpJRijCnNMc6IIaXWpzTnnJi5OROR1toYbaxVL69WCN0fji/ufDi/9ud9b9+O6k2cnvbD8TDA4ThN00fmUopzTj8wGG0ABm2k1K1VoJSWF6UBhrYCA0pZa+d5bmJmHsfRe39faRsWISISbdUojY2S99skiZxzRPQXF1Z/gM/7+0p/5fwOpb0r1cL14qUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/9c47acfd4def718aade0476d25e25656/a59e9/crdt2.webp 192w,\n/static/9c47acfd4def718aade0476d25e25656/0ca9f/crdt2.webp 384w,\n/static/9c47acfd4def718aade0476d25e25656/dc9b9/crdt2.webp 768w,\n/static/9c47acfd4def718aade0476d25e25656/80c60/crdt2.webp 1000w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/9c47acfd4def718aade0476d25e25656/3b721/crdt2.png 192w,\n/static/9c47acfd4def718aade0476d25e25656/66595/crdt2.png 384w,\n/static/9c47acfd4def718aade0476d25e25656/fe486/crdt2.png 768w,\n/static/9c47acfd4def718aade0476d25e25656/1263b/crdt2.png 1000w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/9c47acfd4def718aade0476d25e25656/fe486/crdt2.png\"\n            alt=\"image2.png\"\n            title=\"image2.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>위와 같이 난수를 사용하기 때문에 동시에 같은 부분이 수정되면 글자가 섞이는 문제도 있습니다.</p>\n<p>이런 CRDT의 문제를 보완하기 위해 Yjs, Automerge 등 다양한 알고리즘 기법들이 나와있습니다.</p>\n<p>이 알고리즘들에 대해서도 기회가 되면 다루도록 하겠습니다.</p>\n<h2>참고</h2>\n<p><a href=\"https://velog.io/@hbsps/CRDT-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-CRDT%EB%9E%80\" target=\"_blank\" rel=\"nofollow\">https://velog.io/@hbsps/CRDT-구현하기-CRDT란</a></p>\n<p><a href=\"https://channel.io/ko/blog/crdt_vs_ot\" target=\"_blank\" rel=\"nofollow\">https://channel.io/ko/blog/crdt_vs_ot</a></p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","frontmatter":{"title":"CRDT란?","summary":"오늘은 Google Docs나 Notion, Figma에서 사용하는 동시 편집 기술에 대해 알아보겠습니다.","date":"2024.06.16.","categories":["crdt","yorkie"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADo0lEQVQ4y32VSUhjSRjHnwlR8KKieDFRjEt7iBBB8WBcIuTixYgwguIyohiVzMGTuAyMKIiKgwOKuA4yJ22U9mArgsuACw2Sw4yKIigyDCIqYzbNe6/q33xFIrYdp6Dyqr6q+tW31RdJURTp5uYmBoAVgB1AHQAngJ8B/AbgDwCfAXwBcAHgPwAygF2Px5MPQHK5XBJjTEtjSVVVC4B/FUXB3d0dLi8v4XK5sL29jeXlZczMzGBoaAidnZ1ob29HbW0tKisr+crKCoLtF0mSIhhjEgAt/Zyvr6/DYDCo6enpjL6ZmZmy2WyWCwoKFJvNptjtdrWmpoY5nU42MDDA6YKsrCyluroaXq+XoF/cbrdZaEizhoYGVZIkPjU1xQGEOt6M8VbW2NjI09LS5N3dXbGgqmo1AdW2tjYQMDIykvf29mJnZweLi4vC3JGREZDM6XSivr4eFRUVKC0thdVq5Varlc5RV2ZnZ4npIyBraWkRQI1GIzbExMQgNTUVGRkZMJlMyM3NJYCA1dXVCXh3dzcGBwfJlzwnJ4fWGRG/ARIsMTERV1dX4Pytpe823tHRIbSl8XfAlJQUUMQZY5ibm8Po6Ch6enpwcnIiTp+dnaG8vBx5eXkYGxsTMofD8T5Qr9fD5/Ph6emJghXyEQoLC19UohSKj4/H4+OjmLe2tiII/N7k5OTkl41HR0fQarXQ6XQC2t/fL+TT09MwGo2QZVnMKajvAg0GA9xut1hcW1tDbGysiC6tUdDIvwsLC8KS5+fn8ECHwxEWuLm5KbQ7Pz+HzWYT0LKyMkxMTIgsILeEA6r/B4yIiMD19TVOT08RSiuCZWdnC1+H1bC5uZkHnc9fA7e2thAVFYWLiwsx7+vrewkS5aff7w8LvBwfH6dNLKghDwVldXVVHKYvNUql/Px8IUtKSgq9Y0obvE4bp6qqKC4uVkhDo9HIfT4f93g84uaioiI0NTXh4eFBHKZqRK+F/PheYlP/eHt7SxGVExISwhYFejl0id/vJws4+XV/f5/v7e1xs9nMX57e/f29ND8/Hw3gr8PDQzJHLikpgd1u5xaLhZtMJq7X61lcXJwaHR1NVUkJdlmj0cg6nY5k6uTkJPH8VGC1gUCAqvYHAJ6NjQ1YLBZGaVJVVSX809XVheHhYZHQS0tLoD0HBwc4Pj4WGRD0uQLgR2Ey51xAvV5vHoC/X9U9yot/SHsAfwL4BOB3AL8G/yJ+IgiAHwKBQAYV2K+VHz2VfZz9JAAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/73d79c4eb6f00426e49f551564b50291/1689d/notion-icon.png","srcSet":"/static/73d79c4eb6f00426e49f551564b50291/8a20a/notion-icon.png 512w,\n/static/73d79c4eb6f00426e49f551564b50291/34104/notion-icon.png 1024w,\n/static/73d79c4eb6f00426e49f551564b50291/1689d/notion-icon.png 2048w","sizes":"(min-width: 2048px) 2048px, 100vw"},"sources":[{"srcSet":"/static/73d79c4eb6f00426e49f551564b50291/3591c/notion-icon.webp 512w,\n/static/73d79c4eb6f00426e49f551564b50291/e306d/notion-icon.webp 1024w,\n/static/73d79c4eb6f00426e49f551564b50291/035dc/notion-icon.webp 2048w","type":"image/webp","sizes":"(min-width: 2048px) 2048px, 100vw"}]},"width":2048,"height":2048}},"publicURL":"/static/73d79c4eb6f00426e49f551564b50291/notion-icon.png"}}}}]}},"pageContext":{"slug":"/etc/2024-06-16-CRDT 기초/"}},"staticQueryHashes":["2518467932","429584967"]}