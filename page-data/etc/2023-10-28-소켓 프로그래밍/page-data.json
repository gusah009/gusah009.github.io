{"componentChunkName":"component---src-templates-post-template-tsx","path":"/etc/2023-10-28-소켓 프로그래밍/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p><strong>오늘은 간단한 채팅 프로그램을 만들어보고 공유해보겠습니다.</strong></p>\n<p>소켓은 네트워크 상에서 수행되는 <strong>양방향 통신</strong> 링크의 한쪽 끝 단을 의미합니다.</p>\n<p>소켓은 특정 포트 번호와 연결되어 있습니다.</p>\n<h3>소켓 프로그래밍 구조</h3>\n<p>서버는 소켓 서버를 특정 포트에 열어두고 계속 listen 하고 있는 방식으로 동작합니다.</p>\n<p>그러다 클라이언트가 접속을 시도하면 아래 코드처럼 <code class=\"language-text\">accpet()</code> 메서드가 호출되면서 socket 객체를 하나 만들어냅니다.</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">Socket</span><span class=\"mtk1\"> </span><span class=\"mtk12\">socket</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">listener</span><span class=\"mtk1\">.</span><span class=\"mtk11\">accept</span><span class=\"mtk1\">();</span></span></span></code></pre>\n<p>그럼 소켓 객체가 서버의 포트를 이용해서 클라이언트의 포트로 접근을 시도하고, 클라와 서버가 서로 <code class=\"language-text\">stream</code>을 이용해 데이터를 입출력하기 시작합니다.</p>\n<p>그렇게 소켓 통신을 모두 완료하면 <code class=\"language-text\">socket.close()</code> 를 이용해 완료합니다.</p>\n<blockquote>\n<p>참고: 파일을 읽고 쓰는 것과 똑같이 동작합니다.</p>\n</blockquote>\n<h3>Socket 클래스</h3>\n<p>소켓 클래스의 생성자를 보면 소켓 클래스에 대해 더 잘 이해할 수 있습니다.</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// 생성자</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">Socket</span><span class=\"mtk1\">(</span><span class=\"mtk10\">InetAddress</span><span class=\"mtk1\"> address, </span><span class=\"mtk10\">int</span><span class=\"mtk1\"> port)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">Socket</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> host, </span><span class=\"mtk10\">int</span><span class=\"mtk1\"> port)</span></span></span></code></pre>\n<p>생성자를 통해 소켓을 객체를 만들 땐 상대방의 주소(IP)와 port를 알아야 한다는 걸 알 수 있습니다.</p>\n<blockquote>\n<p>상대방의 주소는 클라이언트 입장에선 서버 주소일것이고, 서버 입장에선 클라이언트 주소입니다.</p>\n</blockquote>\n<h3>간단한 채팅 프로그램 예제</h3>\n<p>간단하게 클라이언트들이 하나의 방에서 서로 통신하는 예제를 만들어보겠습니다.</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">package</span><span class=\"mtk1\"> org.example;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.io.BufferedReader;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.io.IOException;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.io.InputStreamReader;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.io.PrintWriter;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.net.Socket;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.util.Scanner;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.util.concurrent.CountDownLatch;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.util.concurrent.ExecutorService;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.util.concurrent.Executors;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.util.concurrent.TimeUnit;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Client</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ANSI_RESET</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;</span><span class=\"mtk6\">\\u</span><span class=\"mtk8\">001B[0m&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ANSI_RED</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">&quot;</span><span class=\"mtk6\">\\u</span><span class=\"mtk8\">001B[31m&quot;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">CountDownLatch</span><span class=\"mtk1\"> </span><span class=\"mtk12\">latch</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">CountDownLatch</span><span class=\"mtk1\">(</span><span class=\"mtk7\">1</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ExecutorService</span><span class=\"mtk1\"> </span><span class=\"mtk12\">executor</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Executors</span><span class=\"mtk1\">.</span><span class=\"mtk11\">newFixedThreadPool</span><span class=\"mtk1\">(</span><span class=\"mtk7\">10</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Scanner</span><span class=\"mtk1\"> </span><span class=\"mtk12\">userInput</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Scanner</span><span class=\"mtk1\">(</span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">in</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">main</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">args</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">IOException</span><span class=\"mtk1\">, </span><span class=\"mtk10\">InterruptedException</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">Socket</span><span class=\"mtk1\"> </span><span class=\"mtk12\">socket</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Socket</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;localhost&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">8888</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;connected to server!&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">executor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">submit</span><span class=\"mtk1\">(() </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk10\">BufferedReader</span><span class=\"mtk1\"> </span><span class=\"mtk12\">reader</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">BufferedReader</span><span class=\"mtk1\">(</span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">InputStreamReader</span><span class=\"mtk1\">(</span><span class=\"mtk12\">socket</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getInputStream</span><span class=\"mtk1\">()));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk15\">while</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">true</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">otherClientMessage</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">getOtherClientMessage</span><span class=\"mtk1\">(reader);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk11\">isServerDisconnected</span><span class=\"mtk1\">(otherClientMessage)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                            </span><span class=\"mtk12\">latch</span><span class=\"mtk1\">.</span><span class=\"mtk11\">countDown</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                            </span><span class=\"mtk15\">return</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(ANSI_RESET + otherClientMessage);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk12\">Thread</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sleep</span><span class=\"mtk1\">(</span><span class=\"mtk7\">500</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> | </span><span class=\"mtk10\">InterruptedException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">e</span><span class=\"mtk1\">.</span><span class=\"mtk11\">printStackTrace</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">executor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">submit</span><span class=\"mtk1\">(() </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;waiting for user input... </span><span class=\"mtk6\">\\&quot;</span><span class=\"mtk8\">exit</span><span class=\"mtk6\">\\&quot;</span><span class=\"mtk8\"> to exit&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk10\">PrintWriter</span><span class=\"mtk1\"> </span><span class=\"mtk12\">writer</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">PrintWriter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">socket</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getOutputStream</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk15\">while</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">userInput</span><span class=\"mtk1\">.</span><span class=\"mtk11\">hasNext</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">inputLine</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">userInput</span><span class=\"mtk1\">.</span><span class=\"mtk11\">nextLine</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk12\">writer</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(inputLine);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk12\">writer</span><span class=\"mtk1\">.</span><span class=\"mtk11\">flush</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">inputLine</span><span class=\"mtk1\">.</span><span class=\"mtk11\">equals</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;exit&quot;</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                            </span><span class=\"mtk12\">latch</span><span class=\"mtk1\">.</span><span class=\"mtk11\">countDown</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                            </span><span class=\"mtk15\">return</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(ANSI_RED + </span><span class=\"mtk8\">&quot;me: &quot;</span><span class=\"mtk1\"> + inputLine);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">print</span><span class=\"mtk1\">(ANSI_RESET);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk12\">Thread</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sleep</span><span class=\"mtk1\">(</span><span class=\"mtk7\">500</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> | </span><span class=\"mtk10\">InterruptedException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">e</span><span class=\"mtk1\">.</span><span class=\"mtk11\">printStackTrace</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">latch</span><span class=\"mtk1\">.</span><span class=\"mtk11\">await</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;bye~!&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">executor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">shutdown</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getOtherClientMessage</span><span class=\"mtk1\">(</span><span class=\"mtk10\">BufferedReader</span><span class=\"mtk1\"> </span><span class=\"mtk12\">reader</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">reader</span><span class=\"mtk1\">.</span><span class=\"mtk11\">readLine</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">ignored</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">null</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk10\">boolean</span><span class=\"mtk1\"> </span><span class=\"mtk11\">isServerDisconnected</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">otherClientMessage</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> otherClientMessage == </span><span class=\"mtk4\">null</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<pre class=\"grvsc-container default-dark\" data-language=\"java\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">package</span><span class=\"mtk1\"> org.example;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.io.BufferedReader;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.io.IOException;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.io.InputStreamReader;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.io.PrintWriter;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.net.ServerSocket;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.net.Socket;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.util.Map;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.util.concurrent.ConcurrentHashMap;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.util.concurrent.ConcurrentMap;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.util.concurrent.ExecutorService;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">import</span><span class=\"mtk1\"> java.util.concurrent.Executors;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Server</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">int</span><span class=\"mtk1\"> </span><span class=\"mtk12\">MAX_CONNECTION</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">10</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ConcurrentMap</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Socket</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">socketMap</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ConcurrentHashMap</span><span class=\"mtk1\">&lt;&gt;();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">main</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\">[] </span><span class=\"mtk12\">args</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">final</span><span class=\"mtk1\"> </span><span class=\"mtk10\">ExecutorService</span><span class=\"mtk1\"> </span><span class=\"mtk12\">executor</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">Executors</span><span class=\"mtk1\">.</span><span class=\"mtk11\">newFixedThreadPool</span><span class=\"mtk1\">(MAX_CONNECTION);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">ServerSocket</span><span class=\"mtk1\"> </span><span class=\"mtk12\">server</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">ServerSocket</span><span class=\"mtk1\">(</span><span class=\"mtk7\">8888</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;server is ready!&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">while</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">true</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk10\">Socket</span><span class=\"mtk1\"> </span><span class=\"mtk12\">socket</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">server</span><span class=\"mtk1\">.</span><span class=\"mtk11\">accept</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">socketMap</span><span class=\"mtk1\">.</span><span class=\"mtk11\">size</span><span class=\"mtk1\">() &gt;= MAX_CONNECTION) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;server is full!&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">socket</span><span class=\"mtk1\">.</span><span class=\"mtk11\">close</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk15\">continue</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">socketMap</span><span class=\"mtk1\">.</span><span class=\"mtk11\">containsKey</span><span class=\"mtk1\">(</span><span class=\"mtk11\">getSocketKey</span><span class=\"mtk1\">(socket))) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;this client is already connected! &quot;</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">socket</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getInetAddress</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getHostAddress</span><span class=\"mtk1\">() + </span><span class=\"mtk8\">&quot;:&quot;</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">socket</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getPort</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk15\">continue</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">socketMap</span><span class=\"mtk1\">.</span><span class=\"mtk11\">put</span><span class=\"mtk1\">(</span><span class=\"mtk11\">getSocketKey</span><span class=\"mtk1\">(socket), socket);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk11\">sendMessageToEveryone</span><span class=\"mtk1\">(</span><span class=\"mtk11\">getSocketKey</span><span class=\"mtk1\">(socket) + </span><span class=\"mtk8\">&quot; is joined Room!!&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">executor</span><span class=\"mtk1\">.</span><span class=\"mtk11\">submit</span><span class=\"mtk1\">(</span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Connection</span><span class=\"mtk1\">(socket, () </span><span class=\"mtk4\">-&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">socketMap</span><span class=\"mtk1\">.</span><span class=\"mtk11\">remove</span><span class=\"mtk1\">(</span><span class=\"mtk11\">getSocketKey</span><span class=\"mtk1\">(socket));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk12\">socket</span><span class=\"mtk1\">.</span><span class=\"mtk11\">close</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk11\">sendMessageToEveryone</span><span class=\"mtk1\">(</span><span class=\"mtk11\">getSocketKey</span><span class=\"mtk1\">(socket) + </span><span class=\"mtk8\">&quot; is left Room!!&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;{&quot;</span><span class=\"mtk1\"> + </span><span class=\"mtk11\">getSocketKey</span><span class=\"mtk1\">(socket) + </span><span class=\"mtk8\">&quot;} socket closed&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk15\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">RuntimeException</span><span class=\"mtk1\">(e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                }));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getSocketKey</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Socket</span><span class=\"mtk1\"> </span><span class=\"mtk12\">socket</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk12\">socket</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getInetAddress</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getHostAddress</span><span class=\"mtk1\">() + </span><span class=\"mtk8\">&quot;:&quot;</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">socket</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getPort</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Connection</span><span class=\"mtk1\"> </span><span class=\"mtk4\">implements</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Runnable</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Socket</span><span class=\"mtk1\"> </span><span class=\"mtk12\">socket</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Runnable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">socketCloseHandler</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Connection</span><span class=\"mtk1\">(</span><span class=\"mtk10\">Socket</span><span class=\"mtk1\"> </span><span class=\"mtk12\">socket</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Runnable</span><span class=\"mtk1\"> </span><span class=\"mtk12\">socketCloseHandler</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">socket</span><span class=\"mtk1\"> = socket;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">socketCloseHandler</span><span class=\"mtk1\"> = socketCloseHandler;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        @</span><span class=\"mtk10\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">run</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">try</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;client is connected! &quot;</span><span class=\"mtk1\"> + </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">socket</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getInetAddress</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getHostAddress</span><span class=\"mtk1\">() + </span><span class=\"mtk8\">&quot;:&quot;</span><span class=\"mtk1\"> + </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">socket</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getPort</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk12\">System</span><span class=\"mtk1\">.</span><span class=\"mtk12\">out</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;waiting for client message...&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk10\">BufferedReader</span><span class=\"mtk1\"> </span><span class=\"mtk12\">reader</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">BufferedReader</span><span class=\"mtk1\">(</span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">InputStreamReader</span><span class=\"mtk1\">(</span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">socket</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getInputStream</span><span class=\"mtk1\">()));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">while</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">true</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientMessage</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">reader</span><span class=\"mtk1\">.</span><span class=\"mtk11\">readLine</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (clientMessage == </span><span class=\"mtk4\">null</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk15\">break</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk8\">&quot;exit&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk11\">equals</span><span class=\"mtk1\">(clientMessage)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk15\">break</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk11\">sendMessageToOthers</span><span class=\"mtk1\">(clientMessage, </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">socket</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk8\">&quot;list&quot;</span><span class=\"mtk1\">.</span><span class=\"mtk11\">equals</span><span class=\"mtk1\">(clientMessage)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk11\">sendMessageToEveryone</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&quot;current connected client list: &quot;</span><span class=\"mtk1\"> + </span><span class=\"mtk12\">socketMap</span><span class=\"mtk1\">.</span><span class=\"mtk11\">keySet</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                    </span><span class=\"mtk12\">Thread</span><span class=\"mtk1\">.</span><span class=\"mtk11\">sleep</span><span class=\"mtk1\">(</span><span class=\"mtk7\">500</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            } </span><span class=\"mtk15\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> | </span><span class=\"mtk10\">InterruptedException</span><span class=\"mtk1\"> </span><span class=\"mtk12\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">RuntimeException</span><span class=\"mtk1\">(e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            } </span><span class=\"mtk15\">finally</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk4\">this</span><span class=\"mtk1\">.</span><span class=\"mtk12\">socketCloseHandler</span><span class=\"mtk1\">.</span><span class=\"mtk11\">run</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">sendMessageToOthers</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientMessage</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Socket</span><span class=\"mtk1\"> </span><span class=\"mtk12\">me</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">Map</span><span class=\"mtk1\">.</span><span class=\"mtk10\">Entry</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">String</span><span class=\"mtk1\">, </span><span class=\"mtk10\">Socket</span><span class=\"mtk1\">&gt; </span><span class=\"mtk12\">socketEntry</span><span class=\"mtk1\"> </span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">socketMap</span><span class=\"mtk1\">.</span><span class=\"mtk11\">entrySet</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">socketEntry</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getValue</span><span class=\"mtk1\">() == me) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk15\">continue</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">PrintWriter</span><span class=\"mtk1\"> </span><span class=\"mtk12\">writer</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">PrintWriter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">socketEntry</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getValue</span><span class=\"mtk1\">().</span><span class=\"mtk11\">getOutputStream</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">writer</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(</span><span class=\"mtk12\">socketEntry</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getKey</span><span class=\"mtk1\">() + </span><span class=\"mtk8\">&quot;: &quot;</span><span class=\"mtk1\"> + clientMessage);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">writer</span><span class=\"mtk1\">.</span><span class=\"mtk11\">flush</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">private</span><span class=\"mtk1\"> </span><span class=\"mtk4\">static</span><span class=\"mtk1\"> </span><span class=\"mtk10\">void</span><span class=\"mtk1\"> </span><span class=\"mtk11\">sendMessageToEveryone</span><span class=\"mtk1\">(</span><span class=\"mtk10\">String</span><span class=\"mtk1\"> </span><span class=\"mtk12\">clientMessage</span><span class=\"mtk1\">) </span><span class=\"mtk4\">throws</span><span class=\"mtk1\"> </span><span class=\"mtk10\">IOException</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk10\">Socket</span><span class=\"mtk1\"> </span><span class=\"mtk12\">socket</span><span class=\"mtk1\"> </span><span class=\"mtk15\">:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">socketMap</span><span class=\"mtk1\">.</span><span class=\"mtk11\">values</span><span class=\"mtk1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">PrintWriter</span><span class=\"mtk1\"> </span><span class=\"mtk12\">writer</span><span class=\"mtk1\"> = </span><span class=\"mtk15\">new</span><span class=\"mtk1\"> </span><span class=\"mtk11\">PrintWriter</span><span class=\"mtk1\">(</span><span class=\"mtk12\">socket</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getOutputStream</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">writer</span><span class=\"mtk1\">.</span><span class=\"mtk11\">println</span><span class=\"mtk1\">(clientMessage);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">writer</span><span class=\"mtk1\">.</span><span class=\"mtk11\">flush</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>총 4개의 클라이언트를 동시에 접속시키면 아래와 같이 누가 채팅방에 들어왔는지 채팅방 로그로 알 수 있습니다.</p>\n<img width=\"1131\" alt=\"image\" src=\"https://user-images.githubusercontent.com/26597702/278804188-7d8de7be-7c48-4501-b446-4380a468667b.png\">\n<p>다음으로 내가 말한 내용은 빨간색으로 표시되고 다른 사람이 말한 내용은 기본 폰트 색깔로 나오게 됩니다.</p>\n<img width=\"1132\" alt=\"스크린샷 2023-10-28 18 39 24\" src=\"https://user-images.githubusercontent.com/26597702/278804322-266ba074-f884-41d5-95f8-a88712ac42a0.png\">\n<p>또 list라는 명령어로 이 방에 누구누구가 있는지 알 수 있습니다.</p>\n<img width=\"1132\" alt=\"스크린샷 2023-10-28 18 40 32\" src=\"https://user-images.githubusercontent.com/26597702/278804393-d7158c55-6748-42f1-9a15-9c998240b9af.png\">\n<p>“exit”를 채팅방에 보내면 채팅방에서 나가지고 채팅방의 다른 사람들에게 내가 채팅방에서 나갔다는 소식을 전달합니다.</p>\n<img width=\"1132\" alt=\"스크린샷 2023-10-28 21 08 43\" src=\"https://user-images.githubusercontent.com/26597702/278812341-99319a09-5851-44ce-9b9e-f370383881bb.png\">\n<p>이렇게 해서 오늘은 갑자기 소켓에 대해 궁금해져서 간단한 코딩과 공부를 해봤는데요, 다음 시간엔 조금 더 상세하고 깊은 내용을 가지고 돌아오겠습니다~</p>\n<p><strong>행복한 하루 되세요~!</strong></p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk10 { color: #4EC9B0; }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk3 { color: #6A9955; }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk6 { color: #D7BA7D; }\n  .default-dark .mtk15 { color: #C586C0; }\n  .default-dark .mtk7 { color: #B5CEA8; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"title":"소켓 프로그래밍 (with 그룹 채팅)","summary":"오늘은 간단한 채팅 프로그램을 만들어보고 공유해보겠습니다.","date":"2023.10.28.","categories":["etc"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACMElEQVQoz62Sy09TURDG+z+5caELQ2Jc6MrEmLghgYBWEtQYNcayQDE8pAFaQMUgXkohCrbYF1CgcNteah/Q0pQKLRgtGIhp4wNpCcLP3FNBYtSVi8n3nZlv5sw5MxoltcX/NI1/6Ru+xU28i5sC97nqVwX7eJir+Lve9zNHowrm3n8nltll9t0OUZWv7jGTzgvBn0yNxTJ7RDO7B7kqig7VoE6SKWu2cvXxBBcNDrRtNtzzOZGopPPMpAuHeB73fBatwU5lq42qdhdleis1kiximrFYlpLrD2l8HqD0VisNvR7O6J7xaDQpOvXEc3jiWYGT81lia9DpWuDUzS4M1jD1Zi91fV5O3ugSTWgckQ207SNIFoWSE6d52munpk+hod/HeGQVyR7E5Agj2YKYnGHhaxxQuNbpwuaJY3aGeOGOcsngwDX3sViwss3BgCPC2XOlWJwB7kg+6s0yntgGrtAao5EPjITXhHmi69T3+7ncYqGje4jbdUaMPTbK9dZiwcnEJ45VGylvtnBe18WVDidHq1rpmUyL580sFwisbPN6ZVv8perrnkhxpKIJbYuFigeDXLjXx/FqI1MLn9EElgs8GUlQa5JpGgxRK02jHwohJ7+g/GXK8puv6IeC1PZOc7/fz12TTPdYsjgU9fax8Covx2O8mk4yPJXAHc4c7NvhPVRSxbPahKox2wPYvYsMTy3gS+QIvt0pLrZ/aeuXpfb5vxdb6FL5A/1oPIdrdp0fbszXXWCBBj4AAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/ae6021df7d8795df60a6cfea3236aef6/e018d/Socket-Programming.png","srcSet":"/static/ae6021df7d8795df60a6cfea3236aef6/c6b60/Socket-Programming.png 480w,\n/static/ae6021df7d8795df60a6cfea3236aef6/f5e84/Socket-Programming.png 960w,\n/static/ae6021df7d8795df60a6cfea3236aef6/e018d/Socket-Programming.png 1920w","sizes":"(min-width: 1920px) 1920px, 100vw"},"sources":[{"srcSet":"/static/ae6021df7d8795df60a6cfea3236aef6/0df1a/Socket-Programming.webp 480w,\n/static/ae6021df7d8795df60a6cfea3236aef6/eeb31/Socket-Programming.webp 960w,\n/static/ae6021df7d8795df60a6cfea3236aef6/702da/Socket-Programming.webp 1920w","type":"image/webp","sizes":"(min-width: 1920px) 1920px, 100vw"}]},"width":1920,"height":1080}},"publicURL":"/static/ae6021df7d8795df60a6cfea3236aef6/Socket-Programming.png"}}}}]}},"pageContext":{"slug":"/etc/2023-10-28-소켓 프로그래밍/"}},"staticQueryHashes":["2518467932","429584967"]}