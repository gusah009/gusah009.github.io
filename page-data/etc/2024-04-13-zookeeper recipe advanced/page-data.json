{"componentChunkName":"component---src-templates-post-template-tsx","path":"/etc/2024-04-13-zookeeper recipe advanced/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p>이번 포스팅에서는 <a href=\"https://gusah009.github.io/etc/2024-03-24-zookeeper%20recipe/\" target=\"_blank\" rel=\"nofollow\">zookeeper 기초편</a>에 이어서 주키퍼에서 제공하는 핵심 기능들을 더 살펴보겠습니다.</p>\n<p>기능들의 원리들과 로직의 구현체인 <code class=\"language-text\">curator</code>에선 어떻게 구현했고, 실제로 어떻게 동작하는지 살펴보겠습니다.</p>\n<h2>Locks</h2>\n<p>분산 시스템에선 <strong>전역적인 Lock</strong>을 잡는 일은 많이 필요로 하지만 쉽지는 않은 작업입니다.</p>\n<blockquote>\n<p>전역적인 Lock을 분산 락 (Distributed Lock) 이라고도 부릅니다.</p>\n</blockquote>\n<p>하지만 주키퍼를 이용하면 쉽게 분산 락을 구현할 수 있습니다. 그 과정은 아래와 같습니다.</p>\n<ol>\n<li><code class=\"language-text\">/lock</code> 이라는 경로명과 함께 sequence &#x26; ephermeral flag로 세팅해 경로를 만듭니다.</li>\n</ol>\n<blockquote>\n<p>Sequence Nodes: 경로의 끝에 일정하게 증가하는 카운터가 추가 됨.</p>\n<p>ex. /svc/nodes0000000001,/svc/nodes0000000002</p>\n<p>Ephemeral Nodes: 세션이 유지되는 동안 활성(세션이 종료되면 삭제됨), 자식 노드를 가질 수 없음</p>\n<p>참고: <a href=\"https://andro-jinu.tistory.com/entry/zookeeper2\" target=\"_blank\" rel=\"nofollow\">https://andro-jinu.tistory.com/entry/zookeeper2</a></p>\n</blockquote>\n<ol start=\"2\">\n<li>\n<p>잠금을 획득할 노드에서 <code class=\"language-text\">getChildren()</code>을 호출합니다. (이 때 watch는 설정하지 않습니다.)</p>\n</li>\n<li>\n<p>만약 1단계에서 생성한 경로명의 시퀀스 번호 접미사가 가장 낮으면 클라이언트가 잠금을 갖게 되고 작업을 수행하면 됩니다.</p>\n</li>\n<li>\n<p>클라이언트는 다음으로 낮은 시퀀스 번호의 잠금 디렉터리 경로에 감시 플래그를 설정하여 <code class=\"language-text\">exists()</code>를 호출합니다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">exists()</code>가 null을 반환하면 2단계로 이동합니다. 그렇지 않으면 2단계로 이동하기 전에 이전 단계의 경로 이름에 대한 알림을 기다립니다.</p>\n</li>\n</ol>\n<h3>그림으로 보기</h3>\n<p>그림으로 보면 아래와 같습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/67d7d42e115bc9d9bac0935c610df5f2/37b68/zk-lock1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAABxUlEQVQ4y51T24rbMBD1L/cz+t7AvvRH+tAaAiHdpW9NCMQvCcR2bcmWYsmSZVlTjkhCts1mLwMHMRcfzZyRk8Ph8Klpmq+c8y91Xc+qqrpASjnTWs8458/ijLEYuz6bpnnI8/xzYox5IiIax5G01mSMibDW0m63o/V6TW3bRr/v+5jDGUKgf20YBpP0ff8djtbatm07dl0XoZQai6IYsywbm6aJ/jmHOufciD5CCIADhzGmAGEKxznnhRBU1zXleR7PqqpotVpRWZYRiHPOY8fORY7YaTi1a62tMHI6DANJKf1+v49jZlkWsVwuaT6f02KxoM1mQ9vtNpJKKe8TQjuttcft0GiapqgZPkTXx+MxagzgcsReJLTWpqdC33XdpeiWneN3Cdu2TaGPEMIrpZ6RnYovsTcRdl2XokApFTvEuNdE1zjn7i4FIyNprfXQDF3eA/R+dSlYAJ7N+VG/BtRfy/AfIYpCCJ4+YDc1ZIxBH/+SdrcAg+YYH7zQVQhRJVrrHwhO0+RCCNNbQUSTUiqCiOJChRB/krquF3j93r9/YvyaAAwcZVnKJM/zB875byHEUkr5+B4wxiKklD8ZY7+Kovj2F2j1yAzvUostAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/67d7d42e115bc9d9bac0935c610df5f2/a59e9/zk-lock1.webp 192w,\n/static/67d7d42e115bc9d9bac0935c610df5f2/0ca9f/zk-lock1.webp 384w,\n/static/67d7d42e115bc9d9bac0935c610df5f2/dc9b9/zk-lock1.webp 768w,\n/static/67d7d42e115bc9d9bac0935c610df5f2/e2c2f/zk-lock1.webp 1152w,\n/static/67d7d42e115bc9d9bac0935c610df5f2/f3efb/zk-lock1.webp 1536w,\n/static/67d7d42e115bc9d9bac0935c610df5f2/84b9a/zk-lock1.webp 2364w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/67d7d42e115bc9d9bac0935c610df5f2/3b721/zk-lock1.png 192w,\n/static/67d7d42e115bc9d9bac0935c610df5f2/66595/zk-lock1.png 384w,\n/static/67d7d42e115bc9d9bac0935c610df5f2/fe486/zk-lock1.png 768w,\n/static/67d7d42e115bc9d9bac0935c610df5f2/d2d74/zk-lock1.png 1152w,\n/static/67d7d42e115bc9d9bac0935c610df5f2/e8464/zk-lock1.png 1536w,\n/static/67d7d42e115bc9d9bac0935c610df5f2/37b68/zk-lock1.png 2364w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/67d7d42e115bc9d9bac0935c610df5f2/fe486/zk-lock1.png\"\n            alt=\"zk-lock1\"\n            title=\"zk-lock1\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/93bb4bcc3e1b916c2b8d059fa16df952/37b68/zk-lock2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACIklEQVQ4y5VT2a7aMBDNL/cz+l6k+9If6UPLEypFICEBAoHYk0B2kzjOYnuqMyW99xapLZaOnBnbZ84scVzX/ZAkyec4jj+FYdgLguA3hBA9KWUvjuN3/iiK2Pd2T5LkxfO8j45SakRE1LYtSSlJKcWoqooOhwMtFgtK05Ttsiz5DLu1lv5cdV0rpyzLrzCklFWapm2e54yiKFrf99vNZtMmScJ2d4Z7TdO00GGtBRpwKKV8EPZhNE2jsyyjMAzJdV0KgoCu1yvNZjO6XC7k+z77oyhixU3DHKzU3uVWVRUg5X5d1ySE0MfjkU6nE+33e9rtdjQajWgwGNBwOKT1ek3b7ZaD3G63vxOiJlJKDXV4AEXYUUOQIJDneQz44zjmmt7JHglxWNc1p4wHUHk+n2k6ndJ4PKb5fM5kCNSdFUXBTUQzIfSBsKoqjdrgIdJbrVacMjCZTLjbIAZZV8NuIowx1hiD7/eESZLwZSEEN2e5XHJTQN41Axl0CjvUdW3v4/RKqJTSIMrznIGLnQIANvxIEzsaiSCA1toikOd5r4Rt2+puoO8BHtD5u4YgCBqKGiJQlmW/CHHJWqvpyQWVXVNQ06IoAifP8z5kG2P0mzH4J7BQIkwGCO/1Dxwp5TccGGMaa635XxCRkVIyiEijrkKIqxOG4QCjovXTGfPvCWDht7xcLsLxPO8ljuNZlmXfhRA/nkEURQwhxDCKorHv+19+AmdNuermVYKpAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/93bb4bcc3e1b916c2b8d059fa16df952/a59e9/zk-lock2.webp 192w,\n/static/93bb4bcc3e1b916c2b8d059fa16df952/0ca9f/zk-lock2.webp 384w,\n/static/93bb4bcc3e1b916c2b8d059fa16df952/dc9b9/zk-lock2.webp 768w,\n/static/93bb4bcc3e1b916c2b8d059fa16df952/e2c2f/zk-lock2.webp 1152w,\n/static/93bb4bcc3e1b916c2b8d059fa16df952/f3efb/zk-lock2.webp 1536w,\n/static/93bb4bcc3e1b916c2b8d059fa16df952/84b9a/zk-lock2.webp 2364w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/93bb4bcc3e1b916c2b8d059fa16df952/3b721/zk-lock2.png 192w,\n/static/93bb4bcc3e1b916c2b8d059fa16df952/66595/zk-lock2.png 384w,\n/static/93bb4bcc3e1b916c2b8d059fa16df952/fe486/zk-lock2.png 768w,\n/static/93bb4bcc3e1b916c2b8d059fa16df952/d2d74/zk-lock2.png 1152w,\n/static/93bb4bcc3e1b916c2b8d059fa16df952/e8464/zk-lock2.png 1536w,\n/static/93bb4bcc3e1b916c2b8d059fa16df952/37b68/zk-lock2.png 2364w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/93bb4bcc3e1b916c2b8d059fa16df952/fe486/zk-lock2.png\"\n            alt=\"zk-lock2\"\n            title=\"zk-lock2\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/941b32e119d5f41d718ef9ae11f2a8c5/37b68/zk-lock3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACBElEQVQ4y5VSy27bMBDUL/czeq+BXPojPbQ5Fa3r2AcbfsIHP0RZEimRliiJenCLISzHaVwkWWCw4ooczi7H833/U5IkX4UQX+I4HkRRdIVSaqC1HgghXtQ55652m5MkeWCMffbKsvxDRNQ0DWmtqaoqKsvS5d1uR4vFgtI0JWOMqwNFUZC1lv4NY0zpFUXxHYuiKKo0TRulVCOldNn3/Wa9Xjec8xd17KvruoEOay1Qg6MsywCEjxf2VkpJeZ47QO35fKbtdktKKbfu60mSUF07DqfUXuRWVRVdCauqanHwPYGL300IVXEcu0NQwjl3M4yiyAF1IYSb8YXsPiFaBsHpdKLD4eAwHo9pOBzSdDolxpj7t9/v6Xg8XtvHY0LoXUIowcHNZkOr1YpGo5HDZDKh+XzuADLsQ8v9q3ddZ7uuw/drhdiM1tH2crmk2WzmyPvWwzC8KuxhjLEXO72eYZZlDtjYKwCwRh1tIsOXuAQXtG1rkRljz4RN07QwbG/se7g1Pd6hnyNmiCylfCYkopY+GFDZPwpmmud55GVZ9ojZtG3rFEIBbruxxF0gMCLYCISX+Uee1voHvGeMqcMw7DjnXRAEHcJa+18QUae1dkB3mKtSKvTiOP4Jq+DZPxq92RG+78OnymOMPQghZlLKX1LKYQ+l1JvgnDsopX5zzp+CIPj2F04Nv4QJxqz1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/941b32e119d5f41d718ef9ae11f2a8c5/a59e9/zk-lock3.webp 192w,\n/static/941b32e119d5f41d718ef9ae11f2a8c5/0ca9f/zk-lock3.webp 384w,\n/static/941b32e119d5f41d718ef9ae11f2a8c5/dc9b9/zk-lock3.webp 768w,\n/static/941b32e119d5f41d718ef9ae11f2a8c5/e2c2f/zk-lock3.webp 1152w,\n/static/941b32e119d5f41d718ef9ae11f2a8c5/f3efb/zk-lock3.webp 1536w,\n/static/941b32e119d5f41d718ef9ae11f2a8c5/84b9a/zk-lock3.webp 2364w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/941b32e119d5f41d718ef9ae11f2a8c5/3b721/zk-lock3.png 192w,\n/static/941b32e119d5f41d718ef9ae11f2a8c5/66595/zk-lock3.png 384w,\n/static/941b32e119d5f41d718ef9ae11f2a8c5/fe486/zk-lock3.png 768w,\n/static/941b32e119d5f41d718ef9ae11f2a8c5/d2d74/zk-lock3.png 1152w,\n/static/941b32e119d5f41d718ef9ae11f2a8c5/e8464/zk-lock3.png 1536w,\n/static/941b32e119d5f41d718ef9ae11f2a8c5/37b68/zk-lock3.png 2364w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/941b32e119d5f41d718ef9ae11f2a8c5/fe486/zk-lock3.png\"\n            alt=\"zk-lock3\"\n            title=\"zk-lock3\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8e0178f4eb529460ca8ebc6de9c6196e/37b68/zk-lock4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACAElEQVQ4y51Sy47bMAz0L/czem+AvfRHemj3VLRd9BIUCWIgCRLAT8m2ZFuW/JBYjGBn89jDtgQGimhmSM0wiKLoQ1mWn4ui+MQYW+V5foGUcqWUWhVFcZPnnPvc9VmW5VMcxx8DrfULEdE4jqSUImMMaa39eTqdaLvdUlVV1Pe9zwNd15Fzju6j73sddF33FZeu60xVVaOUchRC+DOKojEMw5FzfpNH3TAMI+ZwzgEDOLTWCQifZ/ZJCEFt2/pJMUVd17Tf70lK6XPLt7IsaRg8h5/UzeMaY/ILoTFmwh+naboB4vpurfUSvIuwaZobTebiB63wkncR4olvEdwHXrIQLr0fCBcNGWN0OBzoeDzSZrPxLu92OwrD0CNNU68h3MbzZykcfmutbwlRCIA4z3NPuF6vPSkaQTsQRlFEkAerBfOMMW5ep0dTUAjA0WUfceKOPFyGNNjbJay1LssyOp/Pr4TjOE5zt8sC3+N66fHExTSYgkZVVb0SYjvoP2I20cGktm3zoGmaZ2gzTZOfEBOg21X3i/OYall6TImnAyCE9n5CpdQ3JPu+H7Iss5xzmySJRTjnLgDfMAwWNYwxm+e5revaKqXwze+wlDILGGPf4zj23f81sAkAAs6naSqDOI6fiqL4I4T4IYT4tUBK+SauazjnHlLKn5zz30mSfPkLFFfFfqlnaHkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8e0178f4eb529460ca8ebc6de9c6196e/a59e9/zk-lock4.webp 192w,\n/static/8e0178f4eb529460ca8ebc6de9c6196e/0ca9f/zk-lock4.webp 384w,\n/static/8e0178f4eb529460ca8ebc6de9c6196e/dc9b9/zk-lock4.webp 768w,\n/static/8e0178f4eb529460ca8ebc6de9c6196e/e2c2f/zk-lock4.webp 1152w,\n/static/8e0178f4eb529460ca8ebc6de9c6196e/f3efb/zk-lock4.webp 1536w,\n/static/8e0178f4eb529460ca8ebc6de9c6196e/84b9a/zk-lock4.webp 2364w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8e0178f4eb529460ca8ebc6de9c6196e/3b721/zk-lock4.png 192w,\n/static/8e0178f4eb529460ca8ebc6de9c6196e/66595/zk-lock4.png 384w,\n/static/8e0178f4eb529460ca8ebc6de9c6196e/fe486/zk-lock4.png 768w,\n/static/8e0178f4eb529460ca8ebc6de9c6196e/d2d74/zk-lock4.png 1152w,\n/static/8e0178f4eb529460ca8ebc6de9c6196e/e8464/zk-lock4.png 1536w,\n/static/8e0178f4eb529460ca8ebc6de9c6196e/37b68/zk-lock4.png 2364w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8e0178f4eb529460ca8ebc6de9c6196e/fe486/zk-lock4.png\"\n            alt=\"zk-lock4\"\n            title=\"zk-lock4\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3>curator를 사용한 Lock 예시</h3>\n<p>curator를 사용해 Lock을 구현한 사용성 예시입니다.</p>\n<p><a href=\"https://github.com/gusah009/zookeeper-recipe/blob/main/zk-recipe/src/test/kotlin/org/example/zkrecipe/LockTest.kt\" target=\"_blank\" rel=\"nofollow\">https://github.com/gusah009/zookeeper-recipe/blob/main/zk-recipe/src/test/kotlin/org/example/zkrecipe/LockTest.kt</a></p>\n<h3>zookeeper를 이용한 분산 락이 좋은 이유</h3>\n<p>만약 고가용성이 필요하지 않다면 이런 분산 락은 redis를 이용해 구현할 수도 있습니다.</p>\n<p>redis는 기본적으로 단일 스레드이기 때문에 <strong>직렬적으로 명령을 수행할 수 있어서</strong> 반드시 한 번에 하나의 서버만 락을 가질 수 있음을 보장할 수 있습니다.</p>\n<p>하지만 고가용성을 보장하진 못하는데요, 이를 위해 <a href=\"https://redis.io/docs/latest/develop/use/patterns/distributed-locks/\" target=\"_blank\" rel=\"nofollow\">RedLock</a>이라는 대체제도 나온 것으로 보이지만 아직 부족해보입니다.</p>\n<blockquote>\n<p><a href=\"https://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html\" target=\"_blank\" rel=\"nofollow\">https://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html</a></p>\n<p>think the Redlock algorithm is a poor choice because it is “neither fish nor fowl”: it is unnecessarily heavyweight and expensive for efficiency-optimization locks, but it is not sufficiently safe for situations in which correctness depends on the lock.</p>\n<p>Redlock 알고리즘은 “물고기도 새도 아닌” 알고리즘으로 효율성 최적화 잠금에는 불필요하게 무겁고 비용이 많이 들지만 잠금에 따라 정확성이 좌우되는 상황에서는 충분히 안전하지 않기 때문에 잘못된 선택이라고 생각합니다.</p>\n</blockquote>\n<p>그에 반해 주키퍼는 합의 알고리즘을 기반으로 <strong>고가용성을 보장</strong>하면서도 락을 보장할 수 있습니다.</p>\n<h2>Leader Election</h2>\n<p>리더 선출도 분산 시스템에서 중요한 기능 중 하나입니다.</p>\n<p>가령 단일 리더 DB에서는 리더만 쓰기를 허용하고 나머지는 읽기만 가능하게 하는 기능을 사용할 수도 있습니다.</p>\n<p>주키퍼에선 이런 리더 선출을 아주 쉽게 사용할 수 있는데요, 바로 <code class=\"language-text\">SEQUENCE-EPHEMERAL</code> 노드를 생성해 그 중 가장 낮은 번호를 가진 노드를 리더로 설정하는 것입니다.</p>\n<p>하지만 리더 선출은 단순히 리더를 선출하는 것 뿐만 아니라 리더가 죽었을 때 새로운 리더를 선출하는 것도 중요합니다.</p>\n<p>지금부턴 어떻게 주키퍼에서 리더가 죽었을 때 새로운 리더를 선출하는 지 알아보겠습니다.</p>\n<ol>\n<li><code class=\"language-text\">/Election</code> 이라는 경로에 <code class=\"language-text\">SEQUENCE-EPHEMERAL</code> 플래그를 사용해 노드들을 생성합니다.</li>\n<li>여기서 가장 작은 sequence number를 가진 노드가 리더가 되고, 만약 내가 리더가 아니라면 바로 앞 노드를 watch합니다.</li>\n<li>만약 바로 앞 노드가 제거됐다면, 내가 가장 작은 sequence number를 가진 노드이므로 내가 리더가 됩니다.</li>\n</ol>\n<h3>curator에서 사용법</h3>\n<p>curator에선 리더 선출에 대해 2가지 방법을 제공하고 있습니다.</p>\n<p>먼저 <strong>Leader Latch</strong> 방법이 있습니다.</p>\n<p><strong>Leader Latch</strong>는 여러 노드 중에 리더를 선출하고 이 리더에 문제가 생기지 않는 한, 계속 리더로 유지하는 방식입니다.</p>\n<p>다음으로 <strong>Leader Selector</strong> 방식은 각 노드가 한 번씩 리더가 되어서 역할을 수행하는 방식입니다.</p>\n<p>이 방식은 리더로 들어온 모든 노드들이 한 번씩 리더가 되어서 역할을 수행함을 보장합니다.</p>\n<p>단, 반드시 한 번엔 하나의 리더만 선출되기 때문에 <strong>“한 번에 하나씩”</strong> 을 보장할 수 있습니다.</p>\n<p>각각의 사용성은 아래 코드를 clone해 수행해보시면 더 명확하게 알 수 있습니다.</p>\n<p><a href=\"https://github.com/gusah009/zookeeper-recipe/blob/main/zk-recipe/src/test/kotlin/org/example/zkrecipe/LeaderElectionTest.kt\" target=\"_blank\" rel=\"nofollow\">https://github.com/gusah009/zookeeper-recipe/blob/main/zk-recipe/src/test/kotlin/org/example/zkrecipe/LeaderElectionTest.kt</a></p>\n<h2>참고</h2>\n<ul>\n<li><a href=\"https://github.com/gusah009/zookeeper-recipe/\" target=\"_blank\" rel=\"nofollow\">https://github.com/gusah009/zookeeper-recipe/</a></li>\n<li><a href=\"https://zookeeper.apache.org/doc/current/recipes.html\" target=\"_blank\" rel=\"nofollow\">https://zookeeper.apache.org/doc/current/recipes.html</a></li>\n<li><a href=\"https://curator.apache.org/docs\" target=\"_blank\" rel=\"nofollow\">https://curator.apache.org/docs</a></li>\n</ul>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","frontmatter":{"title":"Zookeeper Recipe - 고급편","summary":"zookeeper recipe 고급편이라 쓰고 curator라 읽는다","date":"2024.04.13.","categories":["etc"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACVklEQVQoz2Po8pRlUNC2YuSR0WXgkdaWVTX3fmHmFvVc19xDVc/Si8HA2ofRMUOTgSSwrreZEcoUmFya8KC3JPkNg5C+BK+4FYOzvR+jU64u8YaFyDFoMTAwcDFYMTB8PjST4fDM/KOnZhdf///yKQODAwNDeLkug3MBCQbOy/Wcta0pyYIhm5fTvlJ7fVKt9f+MOrv/duXa0xlmMjA0BSkzNpgpMmxiFQPjjUgYK9jbm7nv5Mzi44FlRlscy3W2uVfr/nep1P5qVaRx1aFcW6bAR4XhPwMrw0ZWUYbNbGIM/zmVGLKZeRkKmfmwG5hnIRaQE6RjcGX5HGanYp1At2rd/5ENZv972oJ3MfxfwLCVX1JwIbso/xxWYZ4FrML8dSz8zAzgMGIEhTsyZgIbmG8jGeKiyS0ZUqjL4FahN9+5Sud/QI3x381TMnr2iWlKLGERMjrLIaVxnV1K4Sq7lDJIjzwjM+4wLLARD4rREZFUrjBicy7Xue9aoffBqULnv1GuYijYZlbGAAYGcMSpMTAwmDAyMHgxMDDoMzAwGDMwMOhB2aBYM2dgYFBnyLaXj4+WFxLXL9cT9ag2/OhSrrvRp9b4n0uNUSoDA4MICwtjMgMDA8jwCAYGhngGBoYYBgaGKAYGhkwov4CBgSGJgYGhkIGBQZwhOsj7l6+nW22Foyhfuo/GTgd7SemyGIu1BR7K0ZkGQiIgV6oIcjArMrIwCECDCQ0Io6bD4MAPwWHhZxNtlOISjUR++mqJuEToCd9JMBH7H2EolhZpKMIwKUCJidh0CADHGJcIJM6HpgAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/be3257cf10d95c7a69ee473f3d6dc144/b5be0/zklogo.png","srcSet":"/static/be3257cf10d95c7a69ee473f3d6dc144/bd29b/zklogo.png 300w,\n/static/be3257cf10d95c7a69ee473f3d6dc144/7dfa2/zklogo.png 600w,\n/static/be3257cf10d95c7a69ee473f3d6dc144/b5be0/zklogo.png 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/be3257cf10d95c7a69ee473f3d6dc144/47d95/zklogo.webp 300w,\n/static/be3257cf10d95c7a69ee473f3d6dc144/f4b9d/zklogo.webp 600w,\n/static/be3257cf10d95c7a69ee473f3d6dc144/3e838/zklogo.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":649}},"publicURL":"/static/be3257cf10d95c7a69ee473f3d6dc144/zklogo.png"}}}}]}},"pageContext":{"slug":"/etc/2024-04-13-zookeeper recipe advanced/"}},"staticQueryHashes":["2518467932","429584967"]}