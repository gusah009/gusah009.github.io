{"componentChunkName":"component---src-templates-post-template-tsx","path":"/etc/2024-10-02-response body가 잘리는 현상/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p>spring boot를 2에서 3으로 올리던 평화로운 어느 날이었습니다.\n테스트를 진행하던 중에 http response의 body가 잘려서 내려오는 현상을 발견했습니다.\n응답 결과가 실패가 아니라 성공인데도 response body만 잘리는 현상이 신기해서 조사했던 내용을 공유하고자 합니다.</p>\n<h2>Content Encoding (gzip → brotli)</h2>\n<p>디버깅을 해봤더니 response의 content encoding 헤더가 우리에게 친숙한 <code class=\"language-text\">gzip</code>이 아니라 <code class=\"language-text\">br</code>이라는 인코딩 방식으로 내려오는걸 확인할 수 있었습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f57ed3433d40d603bf9f6df89e201ce1/26cba/image0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.916666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA00lEQVQY02WPzU7DMBCE8y5NnDTE3vXa6Y+dkFYIiR44gODGgfd/iUFd6qiCw6eZWe2PtnrOE5IESIgId+z3B6SUkfOknogVa92KcwTnfrXk6rgseIojThLAxPBelBgjmD1Ih0i9SFgXX7P3XlX7brXKesEpZYzWYRjs7Sppw3bbo+8fVi3+Pv+l6qzDeX7EzhH6wcIYA2PalaYxirliOrRtp/W6brDZ1P+oFmF8nWd8R8HnLuBFGJfAuESP18OIt+mI9znhY06YmGCJ9YOytBws/AA4Kps6vFwshwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f57ed3433d40d603bf9f6df89e201ce1/a59e9/image0.webp 192w,\n/static/f57ed3433d40d603bf9f6df89e201ce1/0ca9f/image0.webp 384w,\n/static/f57ed3433d40d603bf9f6df89e201ce1/dc9b9/image0.webp 768w,\n/static/f57ed3433d40d603bf9f6df89e201ce1/e2c2f/image0.webp 1152w,\n/static/f57ed3433d40d603bf9f6df89e201ce1/f3efb/image0.webp 1536w,\n/static/f57ed3433d40d603bf9f6df89e201ce1/b844b/image0.webp 1782w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f57ed3433d40d603bf9f6df89e201ce1/3b721/image0.png 192w,\n/static/f57ed3433d40d603bf9f6df89e201ce1/66595/image0.png 384w,\n/static/f57ed3433d40d603bf9f6df89e201ce1/fe486/image0.png 768w,\n/static/f57ed3433d40d603bf9f6df89e201ce1/d2d74/image0.png 1152w,\n/static/f57ed3433d40d603bf9f6df89e201ce1/e8464/image0.png 1536w,\n/static/f57ed3433d40d603bf9f6df89e201ce1/26cba/image0.png 1782w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f57ed3433d40d603bf9f6df89e201ce1/fe486/image0.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>그래서 request를 확인해봤더니, 기본 Accept-Encoding으로 <code class=\"language-text\">gzip</code>, <code class=\"language-text\">x-gzip</code>, <code class=\"language-text\">deflate</code>, <code class=\"language-text\">br</code> 총 4가지 인코딩 옵션이 요청헤더에 담겨져 있었습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/893bfff17b50862767ac274755513769/26e62/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.4375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA2UlEQVQY001QW27DMAzLUbqua/N2KPmROFmXFe39j8TCLhLkg6AoCASpYo2RK4QYwGEAAaGIUCAMPrDvDcuy2lFVdebbrdz1cVe4rqMzA0UtIZohYinqOM8Lpynyfv/Lc8Ky/GaOcc77xM55qlp2Xc8CAk4xcoTQAhwVDAo69HTySWyMyZwatG23NwHAum54On3xfP7m5fLDAuPE5+vF/1TZGHoBvQonp7QCNk2bX2CtyyZbms3U+8AQxpwuG7aiXB8PPiGMohygvF7LjOOfUpKNt/mo020yfAMRqZxmJzsjzAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/893bfff17b50862767ac274755513769/a59e9/image.webp 192w,\n/static/893bfff17b50862767ac274755513769/0ca9f/image.webp 384w,\n/static/893bfff17b50862767ac274755513769/dc9b9/image.webp 768w,\n/static/893bfff17b50862767ac274755513769/2f8f5/image.webp 1150w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/893bfff17b50862767ac274755513769/3b721/image.png 192w,\n/static/893bfff17b50862767ac274755513769/66595/image.png 384w,\n/static/893bfff17b50862767ac274755513769/fe486/image.png 768w,\n/static/893bfff17b50862767ac274755513769/26e62/image.png 1150w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/893bfff17b50862767ac274755513769/fe486/image.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>원인은 모르지만 <code class=\"language-text\">gzip이</code> 아니라 <code class=\"language-text\">brotli</code> 방식의 인코딩 방식을 사용하면서 문제가 생긴 것을 확인할 수 있었습니다.</p>\n<blockquote>\n<p>버전업 전 request header의 Accept-Encoding은 gzip과 deflate만 존재했습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1af983805c5736cdbdbbe654c6a132fa/26530/image1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.854166666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABF0lEQVQoz2WSWW6EMBBEuQuQYRm8s9lskUbKT+5/nYqqGdBI+SiVW8bP1W4yPU1Y9h270vj2AVEbqE5BawNjjLi1DkppGGMxzxHTNGMcJ6zrinEcEWMSzfOMrKpqxNcLP8eB337AYp0AKOc8+n6A9wHDMCCEHl2n8HhU4Lm6bv55VuQlqqZFMAbJWAQfbhhB3nuprxS84HKmZNorNb/LiqKUG82zhddaIM65Nyy8a38fWpYV27ZhXU/FGNE07Z1SgFzY7omBwNDfCanwrpkmpUVEMJ1w7uV5gbL8En0AO4zaCOCCMd0FJISt7vsh623bxTmYM+n5DGfLVQ39bNErDeeDTNNaK60TzElzKJ/pUkr3ExDIv4CsP5iv31rOa/5zAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1af983805c5736cdbdbbe654c6a132fa/a59e9/image1.webp 192w,\n/static/1af983805c5736cdbdbbe654c6a132fa/0ca9f/image1.webp 384w,\n/static/1af983805c5736cdbdbbe654c6a132fa/dc9b9/image1.webp 768w,\n/static/1af983805c5736cdbdbbe654c6a132fa/3d89b/image1.webp 944w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1af983805c5736cdbdbbe654c6a132fa/3b721/image1.png 192w,\n/static/1af983805c5736cdbdbbe654c6a132fa/66595/image1.png 384w,\n/static/1af983805c5736cdbdbbe654c6a132fa/fe486/image1.png 768w,\n/static/1af983805c5736cdbdbbe654c6a132fa/26530/image1.png 944w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1af983805c5736cdbdbbe654c6a132fa/fe486/image1.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n</blockquote>\n<h2>해결방법</h2>\n<p>원인이 별로 궁금하지 않은 분들을 위해 해결 방법을 먼저 알려드리면, 간단하게 httpHeader를 overwrite 시켜주면 끝입니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4af64affb930d4df5f6da235c43f4c13/89260/image12.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.291666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAARklEQVQI1wXBiQ2AIBBFQSsRlo+CBxHDRvqv7DmzlG9S3Tl9oDFo78P0xvw611Hod6HWwiphMqIZykJKpLyR8k4wI0iEaPytBh1cBI+v+QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4af64affb930d4df5f6da235c43f4c13/a59e9/image12.webp 192w,\n/static/4af64affb930d4df5f6da235c43f4c13/0ca9f/image12.webp 384w,\n/static/4af64affb930d4df5f6da235c43f4c13/dc9b9/image12.webp 768w,\n/static/4af64affb930d4df5f6da235c43f4c13/e2c2f/image12.webp 1152w,\n/static/4af64affb930d4df5f6da235c43f4c13/f3efb/image12.webp 1536w,\n/static/4af64affb930d4df5f6da235c43f4c13/87f9e/image12.webp 2072w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4af64affb930d4df5f6da235c43f4c13/3b721/image12.png 192w,\n/static/4af64affb930d4df5f6da235c43f4c13/66595/image12.png 384w,\n/static/4af64affb930d4df5f6da235c43f4c13/fe486/image12.png 768w,\n/static/4af64affb930d4df5f6da235c43f4c13/d2d74/image12.png 1152w,\n/static/4af64affb930d4df5f6da235c43f4c13/e8464/image12.png 1536w,\n/static/4af64affb930d4df5f6da235c43f4c13/89260/image12.png 2072w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4af64affb930d4df5f6da235c43f4c13/fe486/image12.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2>Response body가 잘리는 이유</h2>\n<p>response body가 잘리는 이유를 찾기 위해 디버거를 켰습니다.</p>\n<p>디버깅하면서 로직을 분석하다보니 <code class=\"language-text\">BrotliInputStream</code>의 read 메서드가 예상과 다른 동작을 하고 있음을 발견했습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/a7a60/image2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.60416666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACWUlEQVQ4y52Uy27cNhSG9RgZj8Q7KVESRY40lj3OOO2uyKqJkyyDFn3/d/gKaYoULdIE6eLDfwgCh+fKSg0Dymi0Nmhj8M4glUJItdtaa4w1OGcQSiOMQdjNVkgpkVKhpEDLGqsbKhsTy7qQzwtlLrx+vRJzoSwz65rp+kiZZ2KaCMNEmjNdSfRTT+xack6k1NGnkdg5KrVF41qmNLDOAw9LZjklTqeRkge8s/R9wDqLEg2x86ShpY2Rth+QokEIgRCSphFUrp8YzxfGU2YoiSkXxtMZH0dCP2J8oB2m3d5KsmE21TeMdRjrd1tpQ6VdYLw805UTaZlJ8z1hLJzOM3FMOO/w3t00OIxz+yNbZmp3qjBa7FgtqKRsGO9n5vWeXAr54WlPZ5wywxCZR0kfJM5IWq8wRv+Vfo2WAiWOWHHAiANWvqJqnz9x/fU3zm8/k9/+Qf7ld/o3H4nPn+ifX4jXd/jLe9zlBXP5gL287LinD9gvfPxCpdqtaytpeWSYH4l5xcaCDAkZJlSY0O2E+jfh61Rb5+q7A83xQFMfOd4dbuf67m+Od/88f4PKhA4bur3QW/e6zqONptlH4ceptLHkhyvl6SfK0xvmc+HyeCLGlqZuftyhMoZ+fWC+XLm//sw0n2m7dr9smv/hUEiJHRPjsjKdZuJU8N7T1PVXHX7vkX31lA2YNmJ8i96Gdpv+0O11rOuGurlxc3bT/2LfFJsW2mVhWM8MjyuxTOSS8dZgtcJptev282z7+p0INUJblLWEYPHeYo3CKok3Cm/0rtbofUu+Fd0W4Z9zN8v1/R7jxQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/a59e9/image2.webp 192w,\n/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/0ca9f/image2.webp 384w,\n/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/dc9b9/image2.webp 768w,\n/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/e2c2f/image2.webp 1152w,\n/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/f3efb/image2.webp 1536w,\n/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/97775/image2.webp 1900w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/3b721/image2.png 192w,\n/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/66595/image2.png 384w,\n/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/fe486/image2.png 768w,\n/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/d2d74/image2.png 1152w,\n/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/e8464/image2.png 1536w,\n/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/a7a60/image2.png 1900w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ed04a4ceac0fb36b6b0e3a36ff7cbd05/fe486/image2.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>고대의 유물인 <code class=\"language-text\">BrotliInputStream</code>은 destLen이 정확하게 buffer Size만큼 들어오길 기대하도록 짜여져있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 490px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/667d075120474e232b5939feb9badf34/ce5c5/image3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.70833333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAADIElEQVQ4y31U23LbNhDVjzS2bFESCQIEQNwIkrrLkhrLuTiJJ43z2EnfOp3J/58M1pYm07p52FkQJA7P7jmLQZEXKPMcsixhuEA5zZHnBQQXlMuSoygYJpMprRljtH96J4QA508xHk8wUFLCiBJLpfDBOKx9gDQWxnmE0KAJDWXvA5omwjl/zjG25/0YI/10MBplKCY5zHqF2aePMNMca2Ow1DVYXtCfE1shKkipoKSCVhqyklBKn6OqJL0fJJqccei2xeqPz9gqjbsm4hgCfVTVBspY1M6jqmtaa+uoCmJqHYyxVH4IAYNsPMHlb6/gthusvn5BZCXWxhLDrbG4MQZ3IeBgHW59wGvncZPeKw3OSiitMZvNsdlsqZpBlo1xPbxC5T3aN3fouMDeeQJb1QZvY8RtaOh5by12xhLwzjpYXaOSCn0/w3K5egYcTzB8dYGw3+Hw7U8sRIV3bYv7tsNrH54AfYBJPbMOm90e690e2TTHcHiF6+sR5cvLIa3PDKVzaPY7hJKjk4oiiopyKk+XnJruk7pNRD7NkY0ypPM/B4lSshKrd29x//0fbCqJx8WC+iiUhgsBxgf4ENC2Hdkk2ajrOvJiYpWccgoCVIyBM4bSWHguMFcaQVTgycgFI9skFfmzfU4xnebkvZRTkLFLLvC7kzgGh89thy/zBT52PR7nC7xvInksmbjrerJFEoAM30RSt+97Yp7WJEqi2UqOIDgsF7Cck2USQ8VKpNFMvWOsPLNJTE6s0t4piGEC3DuFg7N46Gf41PX40HV46Hs8dB1qpRDbjg7/u18vBQHOdIVWVsSqERVMUrRgKFhJIqRy09SMXlD1Pyqnj25Ejhstcd/2eNM0OIYGy9rAWof5fIH9/kDjdXV1TYd+BTxIXlJ//Q25PSDmBTqlyXttJUnhJ4YdCfEz0P+BEqB8/Aaz3OG2rnFsIvbO0agVSaTQYNbP4LzHxcUl9fEE+BLoIBuPUSwzhCiw1ZbGbvd8EbyPkWY39TKVfjze0b13An2ZYTbGxDMYU2FbP10IyTap5E26VWoDUUnqZ/Kb1vUvAX8AoEZYvniLW/UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/667d075120474e232b5939feb9badf34/a59e9/image3.webp 192w,\n/static/667d075120474e232b5939feb9badf34/0ca9f/image3.webp 384w,\n/static/667d075120474e232b5939feb9badf34/49ace/image3.webp 490w\"\n              sizes=\"(max-width: 490px) 100vw, 490px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/667d075120474e232b5939feb9badf34/3b721/image3.png 192w,\n/static/667d075120474e232b5939feb9badf34/66595/image3.png 384w,\n/static/667d075120474e232b5939feb9badf34/ce5c5/image3.png 490w\"\n            sizes=\"(max-width: 490px) 100vw, 490px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/667d075120474e232b5939feb9badf34/ce5c5/image3.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>만약 stream 내부적으로 계산했을 때 남은 buffer size가 3013인데 destLen이 8192로 남은 buffer size보다 크게 들어오면 <strong>buffer의 데이터가 압축이 덜 풀린 것으로 인식</strong>하고 buffer의 압축을 푸는 작업을 하도록 짜여져 있습니다.</p>\n<p>그럼 왜 상위 메서드에서 <code class=\"language-text\">BrotliInputStream</code>의 read 메서드의 destLen 값으로 더 큰 값을 주었을까요?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/827160deb296f4bac31f8405347436fe/740ad/image4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.3125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA5ElEQVQY0zXJUU6DQBRAURYizDB03mMo0CkEKNCSWFs0xv1v5xo1fpyvk2TWkscO07ZY8YRKf7mgOFFyDeSlIio48bhScaUQjiXt6UghSnZQTFAyfyCx6Qt57tCup+4H+nPDeolcphOXqWMYIvMSuV1ODF2NSkEVPE3lqYPHpikmTbEmw2YpSR0i57gyzjv3+wf7/snj8cnb6zv7/sW2PRhvT573nW3eWMeVZViYh4WpX7hOK/NwpWsnYj2SWHfASYWRGj02NPGM1BFtO3xZkReCcUpWKKYQCilx//wPJfd/Z5zwDSineZpnuvGZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/827160deb296f4bac31f8405347436fe/a59e9/image4.webp 192w,\n/static/827160deb296f4bac31f8405347436fe/0ca9f/image4.webp 384w,\n/static/827160deb296f4bac31f8405347436fe/dc9b9/image4.webp 768w,\n/static/827160deb296f4bac31f8405347436fe/e2c2f/image4.webp 1152w,\n/static/827160deb296f4bac31f8405347436fe/f3efb/image4.webp 1536w,\n/static/827160deb296f4bac31f8405347436fe/4a7a2/image4.webp 1984w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/827160deb296f4bac31f8405347436fe/3b721/image4.png 192w,\n/static/827160deb296f4bac31f8405347436fe/66595/image4.png 384w,\n/static/827160deb296f4bac31f8405347436fe/fe486/image4.png 768w,\n/static/827160deb296f4bac31f8405347436fe/d2d74/image4.png 1152w,\n/static/827160deb296f4bac31f8405347436fe/e8464/image4.png 1536w,\n/static/827160deb296f4bac31f8405347436fe/740ad/image4.png 1984w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/827160deb296f4bac31f8405347436fe/fe486/image4.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><code class=\"language-text\">StringMessageConverter</code>의 readInternal 메서드를 보면 Content-Length 헤더가 따로 없다면 readAllBytes를 수행하도록 되어 있습니다.</p>\n<p>readAllBytes는 length를 알 수 없기 때문에 <code class=\"language-text\">Integer.MAX</code> 값으로 넣어주도록 되어 있구요.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e9651ed9b5266d0780c6572d9c61adb7/4e098/image5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.229166666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA9klEQVQY0z3K2U7CUABF0X6G3KENAh1pAUFoSsBWKR2uRQWCQ/z/39gGTXxY2Q/nWP1wgt2/xR6MGI6n+L7HcOCwmEfM70JmE59p7DJLfFzXRY1CbC9GDVxUHKAjD2fs4SQBTuBiheuOMGsJMkOSv5HmLVlR8nw6UtSGwrxwX7akVUeyaUjzmvTRsMxrsqZhse/wNxXBQ02Q7bCitCV5+mRSfhNvjxTmTH36Yv/6QXl4Z91c8Msz4eGTqL5QNR27yrBvOtq2Y1ueiFaGaNkQrVos29YoKdBXSiKEpNcTf4RECoEtJVpcP5KeUP9uhEJcN63QWv/2B/AVfoLWdnIwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e9651ed9b5266d0780c6572d9c61adb7/a59e9/image5.webp 192w,\n/static/e9651ed9b5266d0780c6572d9c61adb7/0ca9f/image5.webp 384w,\n/static/e9651ed9b5266d0780c6572d9c61adb7/dc9b9/image5.webp 768w,\n/static/e9651ed9b5266d0780c6572d9c61adb7/45954/image5.webp 848w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e9651ed9b5266d0780c6572d9c61adb7/3b721/image5.png 192w,\n/static/e9651ed9b5266d0780c6572d9c61adb7/66595/image5.png 384w,\n/static/e9651ed9b5266d0780c6572d9c61adb7/fe486/image5.png 768w,\n/static/e9651ed9b5266d0780c6572d9c61adb7/4e098/image5.png 848w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e9651ed9b5266d0780c6572d9c61adb7/fe486/image5.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>그래서 InputStream에서 bytes를 읽어올 때 InputStream 입장에선 정확히 남은 bytes를 모르므로 그냥 본인이 읽을 수 있는 DEFAULT_BUFFER_SIZE인 8192로 length를 넣어준 것입니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b08aabd1a79c9798283d445eba110c2b/47fb9/image6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.64583333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACvElEQVQ4y3WU247cNhBE9RkZieKdIqkLpZmd7Ma7tuGsEcNBjAUS5DXI/3/FCchJbOf2UKpWi6DI6uru7HLGzoW4HWzbzMP9wbfXQlpW7JRY5oiaFlRckUtGHQW5zhjncM5hnSOEiSkmtDZ00jhCXtiOg7nsrKW0TXKOxDSR89Q45kgIHudtg7UGKeVXUI07ozWqwidUyJgQ2bbMvs+Ukillpmy5xXPd2Gmit3jnGMcROY6NWyxHOq11S4qhZxQ9YhjoTz1939PXuO859UNDPwgGMX7GOMp/oZNa45aFqVxY7x5YjgvzccVMMzYu+BCJMZAmh7cKq8e/wagv0GqkU8YSypXluGO5uyfNt41czOSgiMER7EjygmAEkxUEK0hOEN0t/itndNvQYeeD7f6J7f4Ved1aUaYYWZJlTh5tLNkLShSN/+uqn69cT+iWM1PKaOep79YolKwaVdYoKTGyx6oeIwdE1XAQjb/oKlphOqktLlZf1ZOYBqUt0ob2AzkFnPeEmLF1XUgEb1iTZfKGLTtSME1jYwydUgqpDXa9sD88sZyvTHnGpo1ULoQyk+bcpKjmn9a9yXCsnjU7jiVQZse+Vp8GOjnWowqkUtgQsN41ceU4oLVEixNiODEMJ0T/TYubtYaeYbjZ68anZr3OxZWKaduZLxfSVkj7znx3Jh1Hy+fLueWmtRBLbdNCOvb2Pe439rlgw0qXL+/I12fmx09s331kf37h6cMLP/z8G5f3v/L08jt3z7+wvfqR7eknyutP7G9eOL99oTx84Hj8yHx9Tzq/I12+pxvFQEW9jk8ZvxfyOpNybgMg1OobjfEOF0JDXdf8ahTeGZQUf0rR34pSe7k29nr/yP7whrTtWO+pbVn1ar1aW61aQ1S73FDzon77akh09VHLXVELo5ptNK36Sv1jovw/bsNB8gee7Mk/RksllwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b08aabd1a79c9798283d445eba110c2b/a59e9/image6.webp 192w,\n/static/b08aabd1a79c9798283d445eba110c2b/0ca9f/image6.webp 384w,\n/static/b08aabd1a79c9798283d445eba110c2b/dc9b9/image6.webp 768w,\n/static/b08aabd1a79c9798283d445eba110c2b/e2c2f/image6.webp 1152w,\n/static/b08aabd1a79c9798283d445eba110c2b/cba34/image6.webp 1246w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b08aabd1a79c9798283d445eba110c2b/3b721/image6.png 192w,\n/static/b08aabd1a79c9798283d445eba110c2b/66595/image6.png 384w,\n/static/b08aabd1a79c9798283d445eba110c2b/fe486/image6.png 768w,\n/static/b08aabd1a79c9798283d445eba110c2b/d2d74/image6.png 1152w,\n/static/b08aabd1a79c9798283d445eba110c2b/47fb9/image6.png 1246w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b08aabd1a79c9798283d445eba110c2b/fe486/image6.png\"\n            alt=\"InputStream.java\"\n            title=\"InputStream.java\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<blockquote>\n<p>InputStream.java</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f6c4ae16ee0366c8452537cebb415874/8cb5d/image7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6.770833333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAATElEQVQI1wXBSw6AIAxAQY+iQJQWIyURib+40fsf6TnTOc343PBLxakRbGeYZkJuuFTopVAs8R3KtUaajbxH4q7CswmbjUQV2lkRjfy96h7binkOaQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f6c4ae16ee0366c8452537cebb415874/a59e9/image7.webp 192w,\n/static/f6c4ae16ee0366c8452537cebb415874/0ca9f/image7.webp 384w,\n/static/f6c4ae16ee0366c8452537cebb415874/dc9b9/image7.webp 768w,\n/static/f6c4ae16ee0366c8452537cebb415874/76c93/image7.webp 906w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f6c4ae16ee0366c8452537cebb415874/3b721/image7.png 192w,\n/static/f6c4ae16ee0366c8452537cebb415874/66595/image7.png 384w,\n/static/f6c4ae16ee0366c8452537cebb415874/fe486/image7.png 768w,\n/static/f6c4ae16ee0366c8452537cebb415874/8cb5d/image7.png 906w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f6c4ae16ee0366c8452537cebb415874/fe486/image7.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n</blockquote>\n<p>그래서 옛날 구현으로 되어 있는 <code class=\"language-text\">BrotliInputStream</code>은 압축 해제를 시도했지만, state가 이미 FINISHED 상태라 압축 해제를 진행하지 않았고 -1을 return 합니다.</p>\n<blockquote>\n<p>추측: BrotliInputStream이 구현 될 당시엔 상위에서 정확하게 읽어야 할 byte를 계산해서 넣어줬을 것으로 예상됩니다.</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0c65650e982e29ab2e865882abfee859/cf75f/image8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.895833333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABrUlEQVQoz42T627jIBBG8xwJNrYDtjHY+IJdkrRV9/0f6qxMsllV6m7742PERYeZD+ZQ1BbdGIqiIMsycinvMc8oCol8zIUQj/X8Gb/SYR8a5/Evr9gp4OMbretZgifGmW3zWNtSVeUT/i9YAmbiROMGxss7btmYbh8M2zWBjXVc4sTra2BdPUqdfwIUtG5kuX7Qh8h4+8UQ3+m3G6Yz9K7BjzbBhPhJyUKgrKWJkW6aWS83Qrzhx4l+HKk7l/zb9R0sAeV+oGlRy8ywbSxhI8Qr6+0t2eDDinP2s3//y3A/mMsCpVu69Q3lJuw0o7se1RjKQqK0+gT89pXPVXX/LuWZXJYUeYY4HhGnI5nIniXvoO9LznPK2lDZCWUcdtlo/YwNMT1MNwVUa3AhYsYlZSoe4K90qJuW0i7Uw5J8VC8rdQw0l436sqFfAudxYFln+t5RlSWFzJMVUuYUUibtF+2NcEgbquHsZop2oOt7tnVgXQeWMDA6w9RpbF3hjWbsNFNXs/YNQ6sZjU7rpq3xvuegtb77kzy6e3U6fY77/xOp/f7qJLJHS971pz1/AzT6ViU0oue3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0c65650e982e29ab2e865882abfee859/a59e9/image8.webp 192w,\n/static/0c65650e982e29ab2e865882abfee859/0ca9f/image8.webp 384w,\n/static/0c65650e982e29ab2e865882abfee859/dc9b9/image8.webp 768w,\n/static/0c65650e982e29ab2e865882abfee859/23d9c/image8.webp 1078w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0c65650e982e29ab2e865882abfee859/3b721/image8.png 192w,\n/static/0c65650e982e29ab2e865882abfee859/66595/image8.png 384w,\n/static/0c65650e982e29ab2e865882abfee859/fe486/image8.png 768w,\n/static/0c65650e982e29ab2e865882abfee859/cf75f/image8.png 1078w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0c65650e982e29ab2e865882abfee859/fe486/image8.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<blockquote>\n<p>참고로 정상적인 압축 해제 과정은 response body가 있는지 확인하는 과정에서 진행됩니다. 이 과정에서 압축 해제가 완료되면 stream의 state가 FINISHED로 바뀝니다.</p>\n</blockquote>\n<p>-1을 return 받은 InputStream은 더 읽을 게 없다고 판단하고 stream 읽기를 종료해버립니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/865746e482a087130fc4f00b7239e3b2/9cda9/image9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.208333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABKUlEQVQY05WOWVLCUBBFsw3lze8lkJIwRSCMkXlSC7WKP/e/jGMlsAE/TnX3vV23OzJG4ILCxRobNL5psbHGJxUG6yShaWrdxQbrNSF1tVdpoWUJD6/KiLLySrb6Zry9ki/fKdYnlucvXnc/dBdnRscbveWFzmRLVlTsyIoN2XhTz53pnmyyp1MxPRDF7SE+zUnaOUm5JZ+9sT5emX/80p8fKE430t6EzmTDYHmmPSzJV5/0ywuj8kQ3n9EbLcgGU0LaJ5KNJ4w1pP2cJHuhmbYIIeB8qHXrHEoKtDEY59BaYb2ve+ssWkmMViglEI1nIqUUvpmSl3u64zlpd0CIE3yIEUIgK6RCSvnoH1WIu1/NNVWoIkqSGK01xt2vamPR2tQfKSnrpf/wB4blslNO3VRkAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/865746e482a087130fc4f00b7239e3b2/a59e9/image9.webp 192w,\n/static/865746e482a087130fc4f00b7239e3b2/0ca9f/image9.webp 384w,\n/static/865746e482a087130fc4f00b7239e3b2/dc9b9/image9.webp 768w,\n/static/865746e482a087130fc4f00b7239e3b2/a9696/image9.webp 1026w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/865746e482a087130fc4f00b7239e3b2/3b721/image9.png 192w,\n/static/865746e482a087130fc4f00b7239e3b2/66595/image9.png 384w,\n/static/865746e482a087130fc4f00b7239e3b2/fe486/image9.png 768w,\n/static/865746e482a087130fc4f00b7239e3b2/9cda9/image9.png 1026w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/865746e482a087130fc4f00b7239e3b2/fe486/image9.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>그래서 마지막에 남은 3013 bytes에 해당하는 response body가 잘렸던 것입니다.</p>\n<h2>왜 사용하지않던 brotli Encoding이 들어갔을까?</h2>\n<p>spring boot 버전업을 진행하면서 httpclient가 4 → 5로 버전업되었습니다.</p>\n<p>그러면서 ContentCompression 로직에 broliSupported가 추가되었는데, 이게 true가 되면서 br이 포함되어서 내려가게 되었습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/55345dc5bcc2b006decfc53ce8d53fcf/c7591/image10.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.770833333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABCElEQVQY01WQSW7DMBAE9RAtJIe7KFGKbMBZkCD5/58qMOMY9qEwjTkUGt3puKBSwSyVtO7Mpwth3dHWM3rHmOIfMTDEgARPzpm5zIgIwzAwjuOdTmJheftk+/phe//mePsgpoBo1TBquuUJLxqtJozWTfQve8ydFksoG9ZHJi2IGFIKBGdxRmONwsn1aqKTJrdinlo9NTRG8KXi5wXtAiEG5jkRnW2NrrJgTRNlJ61d3/eMw0DfP9I3OhNmXC7kerQNbUyoklFrQeXEnDNlq/jThj8qLzWwLZHLkanFYYzCWnND6B43uA/8MPT1p7Xi2DOv58J5T2xrJqbIulf284lSEiE4YvT8AlVBq7rCUmFcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/55345dc5bcc2b006decfc53ce8d53fcf/a59e9/image10.webp 192w,\n/static/55345dc5bcc2b006decfc53ce8d53fcf/0ca9f/image10.webp 384w,\n/static/55345dc5bcc2b006decfc53ce8d53fcf/dc9b9/image10.webp 768w,\n/static/55345dc5bcc2b006decfc53ce8d53fcf/e2c2f/image10.webp 1152w,\n/static/55345dc5bcc2b006decfc53ce8d53fcf/f3efb/image10.webp 1536w,\n/static/55345dc5bcc2b006decfc53ce8d53fcf/5162c/image10.webp 1574w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/55345dc5bcc2b006decfc53ce8d53fcf/3b721/image10.png 192w,\n/static/55345dc5bcc2b006decfc53ce8d53fcf/66595/image10.png 384w,\n/static/55345dc5bcc2b006decfc53ce8d53fcf/fe486/image10.png 768w,\n/static/55345dc5bcc2b006decfc53ce8d53fcf/d2d74/image10.png 1152w,\n/static/55345dc5bcc2b006decfc53ce8d53fcf/e8464/image10.png 1536w,\n/static/55345dc5bcc2b006decfc53ce8d53fcf/c7591/image10.png 1574w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/55345dc5bcc2b006decfc53ce8d53fcf/fe486/image10.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>brotliSupported는 단순히 BrotliInputStream 클래스가 있으면 사용 가능하다고 보고 있었는데요, brotli 관련 라이브러리를 추가한 적이 없었습니다. 어디서 추가된걸까요?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8e481743b9614b3d55093c6bea0bba15/cc5fa/image11.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.8125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABEUlEQVQoz5WRS44bMQwF+xxx60eKkiz1x+mMg2CQ+1+rArczCAzMLLIoFPG4IfEmGQfad6TfiHUh9gOpneP74DgW3t42xhiIKpd5xjnH/AWP3RRyxfpKUCGJYGZkM6wYpRZyVjRFJMUXq7ySJZFSYnKXb/ispPudvt/49f6b236jt8a2rjQzVhOWB0UZJmzlyVqEW83sVdmboapMInK+a8uP075t+GvFrwPXG35cT9y4EnLGt3rObvQn/crcG6lkihlTjJHUVvJ2R5eDvP9El4VQC6HY6fiYWyGqErM+s1YIlonVTksW8seFIQR8FHyIhCQEH3CXC+5Rwgvuk+zfbp5nJuc93nucezb4Yf83/1/+AE7NxQ1GaqabAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8e481743b9614b3d55093c6bea0bba15/a59e9/image11.webp 192w,\n/static/8e481743b9614b3d55093c6bea0bba15/0ca9f/image11.webp 384w,\n/static/8e481743b9614b3d55093c6bea0bba15/dc9b9/image11.webp 768w,\n/static/8e481743b9614b3d55093c6bea0bba15/e2c2f/image11.webp 1152w,\n/static/8e481743b9614b3d55093c6bea0bba15/145c7/image11.webp 1188w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8e481743b9614b3d55093c6bea0bba15/3b721/image11.png 192w,\n/static/8e481743b9614b3d55093c6bea0bba15/66595/image11.png 384w,\n/static/8e481743b9614b3d55093c6bea0bba15/fe486/image11.png 768w,\n/static/8e481743b9614b3d55093c6bea0bba15/d2d74/image11.png 1152w,\n/static/8e481743b9614b3d55093c6bea0bba15/cc5fa/image11.png 1188w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8e481743b9614b3d55093c6bea0bba15/fe486/image11.png\"\n            alt=\"image.png\"\n            title=\"image.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>알고보니 <code class=\"language-text\">tika-parser</code>라는 라이브러리에 전이종속성으로 brotli 라이브러리가 포함되어서 들어온 것이었습니다.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","frontmatter":{"title":"response body가 잘리는 현상 (feat. brotli)","summary":"spring boot를 2에서 3으로 올리던 평화로운 어느 날이었습니다.","date":"2024.10.02.","categories":["etc"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3ElEQVQoz12Ty6tPURTHzzkh8kh5R3mUgZT4B74rjwEjIzOKpJTvGihykeIyIHldj0xMLroDlL7rlpSUmYlHBsaiDEhSxIz2/q0fJ7tWZ5211/nstb5rn8bDGpe1FBrK0qrfMpD+P/PI3MB0D5uSsb/7NcEHkNmUzadsAYUZBewD4JzBXolhYX48jQIoLKUwN2NTKSwakrdQ+ErhI2WfKbynsMwDqyjcorCbwmUKxymMUhincITCdQpjFI5ROErhfDPyeGsBvqXwgcIEhfsUvlN4QKFUe4nCbQonKWyg8I6BXR52gMJzCisoPKNwhsLaJumfKJymcI7CtfR/UdhPYS+FCwzcozBCYSeF9RSMwkEPW0xhB4WbFN4U4CsKryncoPCFwjcKJyj8KK3VoUXVbGUOo9ogbg2HT2FTOaxJ+m8Kh7PlK6nXz1Kdh52lsISB1Yw6iHkMbGZgIwOnEtz2p1ycJx5WoJNVj6gHlLbXedgjCncZGGfgKgN3GLjIwAQDY3lDCrArNpzyGgpPKXtB2UsKDynM9LDlVYrAHg/bR+GQh20vlTGwrXTlslnD9uuqF1iWmvS0yQvr6r2Xano5/+/XNSjZWg/rfBJttbCuB2xTozb/qC5hXR/KrPAPFINmy3qE2ZIAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/8315cb308b890c7087edfc088043f572/22925/spring-boot-logo.png","srcSet":"/static/8315cb308b890c7087edfc088043f572/97024/spring-boot-logo.png 150w,\n/static/8315cb308b890c7087edfc088043f572/387ef/spring-boot-logo.png 300w,\n/static/8315cb308b890c7087edfc088043f572/22925/spring-boot-logo.png 600w","sizes":"(min-width: 600px) 600px, 100vw"},"sources":[{"srcSet":"/static/8315cb308b890c7087edfc088043f572/50262/spring-boot-logo.webp 150w,\n/static/8315cb308b890c7087edfc088043f572/2fedb/spring-boot-logo.webp 300w,\n/static/8315cb308b890c7087edfc088043f572/4fcbd/spring-boot-logo.webp 600w","type":"image/webp","sizes":"(min-width: 600px) 600px, 100vw"}]},"width":600,"height":315}},"publicURL":"/static/8315cb308b890c7087edfc088043f572/spring-boot-logo.png"}}}}]}},"pageContext":{"slug":"/etc/2024-10-02-response body가 잘리는 현상/"}},"staticQueryHashes":["2518467932","429584967"]}